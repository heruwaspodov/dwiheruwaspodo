(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const cp=()=>{};var Vl={};const bu={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const D=function(n,e){if(!n)throw Rn(e)},Rn=function(n){return new Error("Firebase Database ("+bu.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Pu=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},up=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],a=n[t++],l=n[t++],u=((i&7)<<18|(r&63)<<12|(a&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const r=n[t++],a=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|a&63)}}return e.join("")},ko={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],a=i+1<n.length,l=a?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=r>>2,m=(r&3)<<4|l>>4;let y=(l&15)<<2|h>>6,S=h&63;u||(S=64,a||(y=64)),s.push(t[f],t[m],t[y],t[S])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Pu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):up(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const m=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||l==null||h==null||m==null)throw new hp;const y=r<<2|l>>4;if(s.push(y),h!==64){const S=l<<4&240|h>>2;if(s.push(S),m!==64){const b=h<<6&192|m;s.push(b)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class hp extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Nu=function(n){const e=Pu(n);return ko.encodeByteArray(e,!0)},gi=function(n){return Nu(n).replace(/\./g,"")},zr=function(n){try{return ko.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function dp(n){return Du(void 0,n)}function Du(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!fp(t)||(n[t]=Du(n[t],e[t]));return n}function fp(n){return n!=="__proto__"}function pp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const mp=()=>pp().__FIREBASE_DEFAULTS__,gp=()=>{if(typeof process>"u"||typeof Vl>"u")return;const n=Vl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},_p=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&zr(n[1]);return e&&JSON.parse(e)},Vo=()=>{try{return cp()||mp()||gp()||_p()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yp=n=>Vo()?.emulatorHosts?.[n],ku=n=>{const e=yp(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Vu=()=>Vo()?.config;class Oi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Ps(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function xu(n){return(await fetch(n,{credentials:"include"})).ok}function Ou(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[gi(JSON.stringify(t)),gi(JSON.stringify(a)),""].join(".")}const cs={};function Ep(){const n={prod:[],emulator:[]};for(const e of Object.keys(cs))cs[e]?n.emulator.push(e):n.prod.push(e);return n}function vp(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xl=!1;function Mu(n,e){if(typeof window>"u"||typeof document>"u"||!Ps(window.location.host)||cs[n]===e||cs[n]||xl)return;cs[n]=e;function t(y){return`__firebase__banner__${y}`}const s="__firebase__banner",r=Ep().prod.length>0;function a(){const y=document.getElementById(s);y&&y.remove()}function l(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,S){y.setAttribute("width","24"),y.setAttribute("id",S),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{xl=!0,a()},y}function f(y,S){y.setAttribute("id",S),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){const y=vp(s),S=t("text"),b=document.getElementById(S)||document.createElement("span"),x=t("learnmore"),k=document.getElementById(x)||document.createElement("a"),L=t("preprendIcon"),q=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const U=y.element;l(U),f(k,x);const Z=h();u(q,L),U.append(q,b,k,Z),document.body.appendChild(U)}r?(b.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Lu(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Fu(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Lu())}function Tp(){const n=Vo()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ip(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function wp(){return bu.NODE_ADMIN===!0}function Cp(){return!Tp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ap(){try{return typeof indexedDB=="object"}catch{return!1}}function Sp(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const Rp="FirebaseError";class bn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Rp,Object.setPrototypeOf(this,bn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Uu.prototype.create)}}class Uu{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?bp(r,s):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new bn(i,l,s)}}function bp(n,e){return n.replace(Pp,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Pp=/\{\$([^}]+)}/g;function ys(n){return JSON.parse(n)}function Ce(n){return JSON.stringify(n)}const Bu=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=ys(zr(r[0])||""),t=ys(zr(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},Np=function(n){const e=Bu(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Dp=function(n){const e=Bu(n).claims;return typeof e=="object"&&e.admin===!0};function lt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function gn(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ol(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function _i(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function Es(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],a=e[i];if(Ml(r)&&Ml(a)){if(!Es(r,a))return!1}else if(r!==a)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function Ml(n){return n!==null&&typeof n=="object"}function kp(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class Vp{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let m=0;m<16;m++)s[m]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let m=0;m<16;m++)s[m]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let m=16;m<80;m++){const y=s[m-3]^s[m-8]^s[m-14]^s[m-16];s[m]=(y<<1|y>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],a=this.chain_[2],l=this.chain_[3],u=this.chain_[4],h,f;for(let m=0;m<80;m++){m<40?m<20?(h=l^r&(a^l),f=1518500249):(h=r^a^l,f=1859775393):m<60?(h=r&a|l&(r|a),f=2400959708):(h=r^a^l,f=3395469782);const y=(i<<5|i>>>27)+h+u+f+s[m]&4294967295;u=l,l=a,a=(r<<30|r>>>2)&4294967295,r=i,i=y}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let a=this.inbuf_;for(;i<t;){if(a===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[a]=e.charCodeAt(i),++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}else for(;i<t;)if(r[a]=e[i],++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function xo(n,e){return`${n} failed: ${e} argument `}const xp=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,D(s<n.length,"Surrogate pair missing trail surrogate.");const a=n.charCodeAt(s)-56320;i=65536+(r<<10)+a}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Mi=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function xt(n){return n&&n._delegate?n._delegate:n}class _n{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const qt="[DEFAULT]";class Op{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Oi;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Lp(e))try{this.getOrInitializeService({instanceIdentifier:qt})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=qt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qt){return this.instances.has(e)}getOptions(e=qt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&a.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Mp(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=qt){return this.component?this.component.multipleInstances?e:qt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mp(n){return n===qt?void 0:n}function Lp(n){return n.instantiationMode==="EAGER"}class Fp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Op(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const Up={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Bp=H.INFO,qp={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},jp=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=qp[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Oo{constructor(e){this.name=e,this._logLevel=Bp,this._logHandler=jp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in H))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Up[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...e),this._logHandler(this,H.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...e),this._logHandler(this,H.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,H.INFO,...e),this._logHandler(this,H.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,H.WARN,...e),this._logHandler(this,H.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...e),this._logHandler(this,H.ERROR,...e)}}const $p=(n,e)=>e.some(t=>n instanceof t);let Ll,Fl;function Hp(){return Ll||(Ll=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zp(){return Fl||(Fl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qu=new WeakMap,Wr=new WeakMap,ju=new WeakMap,Rr=new WeakMap,Mo=new WeakMap;function Wp(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",a)},r=()=>{t(yt(n.result)),i()},a=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&qu.set(t,n)}).catch(()=>{}),Mo.set(e,n),e}function Gp(n){if(Wr.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",a),n.removeEventListener("abort",a)},r=()=>{t(),i()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",a),n.addEventListener("abort",a)});Wr.set(n,e)}let Gr={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Wr.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ju.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return yt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Kp(n){Gr=n(Gr)}function Qp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(br(this),e,...t);return ju.set(s,e.sort?e.sort():[e]),yt(s)}:zp().includes(n)?function(...e){return n.apply(br(this),e),yt(qu.get(this))}:function(...e){return yt(n.apply(br(this),e))}}function Yp(n){return typeof n=="function"?Qp(n):(n instanceof IDBTransaction&&Gp(n),$p(n,Hp())?new Proxy(n,Gr):n)}function yt(n){if(n instanceof IDBRequest)return Wp(n);if(Rr.has(n))return Rr.get(n);const e=Yp(n);return e!==n&&(Rr.set(n,e),Mo.set(e,n)),e}const br=n=>Mo.get(n);function Xp(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const a=indexedDB.open(n,e),l=yt(a);return s&&a.addEventListener("upgradeneeded",u=>{s(yt(a.result),u.oldVersion,u.newVersion,yt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{r&&u.addEventListener("close",()=>r()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const Jp=["get","getKey","getAll","getAllKeys","count"],Zp=["put","add","delete","clear"],Pr=new Map;function Ul(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Pr.get(e))return Pr.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=Zp.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Jp.includes(t)))return;const r=async function(a,...l){const u=this.transaction(a,i?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&u.done]))[0]};return Pr.set(e,r),r}Kp(n=>({...n,get:(e,t,s)=>Ul(e,t)||n.get(e,t,s),has:(e,t)=>!!Ul(e,t)||n.has(e,t)}));class em{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(tm(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function tm(n){return n.getComponent()?.type==="VERSION"}const Kr="@firebase/app",Bl="0.14.6";const it=new Oo("@firebase/app"),nm="@firebase/app-compat",sm="@firebase/analytics-compat",im="@firebase/analytics",rm="@firebase/app-check-compat",om="@firebase/app-check",am="@firebase/auth",lm="@firebase/auth-compat",cm="@firebase/database",um="@firebase/data-connect",hm="@firebase/database-compat",dm="@firebase/functions",fm="@firebase/functions-compat",pm="@firebase/installations",mm="@firebase/installations-compat",gm="@firebase/messaging",_m="@firebase/messaging-compat",ym="@firebase/performance",Em="@firebase/performance-compat",vm="@firebase/remote-config",Tm="@firebase/remote-config-compat",Im="@firebase/storage",wm="@firebase/storage-compat",Cm="@firebase/firestore",Am="@firebase/ai",Sm="@firebase/firestore-compat",Rm="firebase",bm="12.6.0";const Qr="[DEFAULT]",Pm={[Kr]:"fire-core",[nm]:"fire-core-compat",[im]:"fire-analytics",[sm]:"fire-analytics-compat",[om]:"fire-app-check",[rm]:"fire-app-check-compat",[am]:"fire-auth",[lm]:"fire-auth-compat",[cm]:"fire-rtdb",[um]:"fire-data-connect",[hm]:"fire-rtdb-compat",[dm]:"fire-fn",[fm]:"fire-fn-compat",[pm]:"fire-iid",[mm]:"fire-iid-compat",[gm]:"fire-fcm",[_m]:"fire-fcm-compat",[ym]:"fire-perf",[Em]:"fire-perf-compat",[vm]:"fire-rc",[Tm]:"fire-rc-compat",[Im]:"fire-gcs",[wm]:"fire-gcs-compat",[Cm]:"fire-fst",[Sm]:"fire-fst-compat",[Am]:"fire-vertex","fire-js":"fire-js",[Rm]:"fire-js-all"};const yi=new Map,Nm=new Map,Yr=new Map;function ql(n,e){try{n.container.addComponent(e)}catch(t){it.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function vs(n){const e=n.name;if(Yr.has(e))return it.debug(`There were multiple attempts to register component ${e}.`),!1;Yr.set(e,n);for(const t of yi.values())ql(t,n);for(const t of Nm.values())ql(t,n);return!0}function $u(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Hu(n){return n==null?!1:n.settings!==void 0}const Dm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Et=new Uu("app","Firebase",Dm);class km{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new _n("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Et.create("app-deleted",{appName:this._name})}}const zu=bm;function Wu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Qr,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw Et.create("bad-app-name",{appName:String(i)});if(t||(t=Vu()),!t)throw Et.create("no-options");const r=yi.get(i);if(r){if(Es(t,r.options)&&Es(s,r.config))return r;throw Et.create("duplicate-app",{appName:i})}const a=new Fp(i);for(const u of Yr.values())a.addComponent(u);const l=new km(t,s,a);return yi.set(i,l),l}function Gu(n=Qr){const e=yi.get(n);if(!e&&n===Qr&&Vu())return Wu();if(!e)throw Et.create("no-app",{appName:n});return e}function vt(n,e,t){let s=Pm[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&a.push("and"),r&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),it.warn(a.join(" "));return}vs(new _n(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Vm="firebase-heartbeat-database",xm=1,Ts="firebase-heartbeat-store";let Nr=null;function Ku(){return Nr||(Nr=Xp(Vm,xm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ts)}catch(t){console.warn(t)}}}}).catch(n=>{throw Et.create("idb-open",{originalErrorMessage:n.message})})),Nr}async function Om(n){try{const t=(await Ku()).transaction(Ts),s=await t.objectStore(Ts).get(Qu(n));return await t.done,s}catch(e){if(e instanceof bn)it.warn(e.message);else{const t=Et.create("idb-get",{originalErrorMessage:e?.message});it.warn(t.message)}}}async function jl(n,e){try{const s=(await Ku()).transaction(Ts,"readwrite");await s.objectStore(Ts).put(e,Qu(n)),await s.done}catch(t){if(t instanceof bn)it.warn(t.message);else{const s=Et.create("idb-set",{originalErrorMessage:t?.message});it.warn(s.message)}}}function Qu(n){return`${n.name}!${n.options.appId}`}const Mm=1024,Lm=30;class Fm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Bm(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=$l();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Lm){const i=qm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){it.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=$l(),{heartbeatsToSend:t,unsentEntries:s}=Um(this._heartbeatsCache.heartbeats),i=gi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return it.warn(e),""}}}function $l(){return new Date().toISOString().substring(0,10)}function Um(n,e=Mm){const t=[];let s=n.slice();for(const i of n){const r=t.find(a=>a.agent===i.agent);if(r){if(r.dates.push(i.date),Hl(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Hl(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Bm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ap()?Sp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Om(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return jl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return jl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Hl(n){return gi(JSON.stringify({version:2,heartbeats:n})).length}function qm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function jm(n){vs(new _n("platform-logger",e=>new em(e),"PRIVATE")),vs(new _n("heartbeat",e=>new Fm(e),"PRIVATE")),vt(Kr,Bl,n),vt(Kr,Bl,"esm2020"),vt("fire-js","")}jm("");var $m="firebase",Hm="12.6.0";vt($m,Hm,"app");var zl={};const Wl="@firebase/database",Gl="1.1.0";let Yu="";function zm(n){Yu=n}class Wm{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ce(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ys(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Gm{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return lt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Xu=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Wm(e)}}catch{}return new Gm},$t=Xu("localStorage"),Km=Xu("sessionStorage");const hn=new Oo("@firebase/database"),Qm=(function(){let n=1;return function(){return n++}})(),Ju=function(n){const e=xp(n),t=new Vp;t.update(e);const s=t.digest();return ko.encodeByteArray(s)},Ns=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Ns.apply(null,s):typeof s=="object"?e+=Ce(s):e+=s,e+=" "}return e};let us=null,Kl=!0;const Ym=function(n,e){D(!0,"Can't turn on custom loggers persistently."),hn.logLevel=H.VERBOSE,us=hn.log.bind(hn)},Pe=function(...n){if(Kl===!0&&(Kl=!1,us===null&&Km.get("logging_enabled")===!0&&Ym()),us){const e=Ns.apply(null,n);us(e)}},Ds=function(n){return function(...e){Pe(n,...e)}},Xr=function(...n){const e="FIREBASE INTERNAL ERROR: "+Ns(...n);hn.error(e)},rt=function(...n){const e=`FIREBASE FATAL ERROR: ${Ns(...n)}`;throw hn.error(e),new Error(e)},Fe=function(...n){const e="FIREBASE WARNING: "+Ns(...n);hn.warn(e)},Xm=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Fe("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Zu=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Jm=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},yn="[MIN_NAME]",Kt="[MAX_NAME]",Pn=function(n,e){if(n===e)return 0;if(n===yn||e===Kt)return-1;if(e===yn||n===Kt)return 1;{const t=Ql(n),s=Ql(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Zm=function(n,e){return n===e?0:n<e?-1:1},Zn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ce(e))},Lo=function(n){if(typeof n!="object"||n===null)return Ce(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Ce(e[s]),t+=":",t+=Lo(n[e[s]]);return t+="}",t},eh=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function je(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const th=function(n){D(!Zu(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,a,l,u;n===0?(r=0,a=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,a=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,a=Math.round(n/Math.pow(2,1-s-t))));const h=[];for(u=t;u;u-=1)h.push(a%2?1:0),a=Math.floor(a/2);for(u=e;u;u-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(i?1:0),h.reverse();const f=h.join("");let m="";for(u=0;u<64;u+=8){let y=parseInt(f.substr(u,8),2).toString(16);y.length===1&&(y="0"+y),m=m+y}return m.toLowerCase()},eg=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},tg=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},ng=new RegExp("^-?(0*)\\d{1,10}$"),sg=-2147483648,ig=2147483647,Ql=function(n){if(ng.test(n)){const e=Number(n);if(e>=sg&&e<=ig)return e}return null},Nn=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Fe("Exception was thrown by user callback.",t),e},Math.floor(0))}},rg=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},hs=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class og{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Hu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Fe(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ag{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Pe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Fe(e)}}class ci{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ci.OWNER="owner";const Fo="5",nh="v",sh="s",ih="r",rh="f",oh=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ah="ls",lh="p",Jr="ac",ch="websocket",uh="long_polling";class hh{constructor(e,t,s,i,r=!1,a="",l=!1,u=!1,h=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=u,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=$t.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&$t.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function lg(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function dh(n,e,t){D(typeof e=="string","typeof type must == string"),D(typeof t=="object","typeof params must == object");let s;if(e===ch)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===uh)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);lg(n)&&(t.ns=n.namespace);const i=[];return je(t,(r,a)=>{i.push(r+"="+a)}),s+i.join("&")}class cg{constructor(){this.counters_={}}incrementCounter(e,t=1){lt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return dp(this.counters_)}}const Dr={},kr={};function Uo(n){const e=n.toString();return Dr[e]||(Dr[e]=new cg),Dr[e]}function ug(n,e){const t=n.toString();return kr[t]||(kr[t]=e()),kr[t]}class hg{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Nn(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Yl="start",dg="close",fg="pLPCommand",pg="pRTLPCB",fh="id",ph="pw",mh="ser",mg="cb",gg="seg",_g="ts",yg="d",Eg="dframe",gh=1870,_h=30,vg=gh-_h,Tg=25e3,Ig=3e4;class un{constructor(e,t,s,i,r,a,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ds(e),this.stats_=Uo(t),this.urlFn=u=>(this.appCheckToken&&(u[Jr]=this.appCheckToken),dh(t,uh,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new hg(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Ig)),Jm(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bo((...r)=>{const[a,l,u,h,f]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===Yl)this.id=l,this.password=u;else if(a===dg)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...r)=>{const[a,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[Yl]="t",s[mh]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[mg]=this.scriptTagHolder.uniqueCallbackIdentifier),s[nh]=Fo,this.transportSessionId&&(s[sh]=this.transportSessionId),this.lastSessionId&&(s[ah]=this.lastSessionId),this.applicationId&&(s[lh]=this.applicationId),this.appCheckToken&&(s[Jr]=this.appCheckToken),typeof location<"u"&&location.hostname&&oh.test(location.hostname)&&(s[ih]=rh);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){un.forceAllow_=!0}static forceDisallow(){un.forceDisallow_=!0}static isAvailable(){return un.forceAllow_?!0:!un.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!eg()&&!tg()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Nu(t),i=eh(s,vg);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[Eg]="t",s[fh]=e,s[ph]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ce(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Bo{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Qm(),window[fg+this.uniqueCallbackIdentifier]=e,window[pg+this.uniqueCallbackIdentifier]=t,this.myIFrame=Bo.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){Pe("frame writing exception"),l.stack&&Pe(l.stack),Pe(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Pe("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[fh]=this.myID,e[ph]=this.myPW,e[mh]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+_h+s.length<=gh;){const a=this.pendingSegs.shift();s=s+"&"+gg+i+"="+a.seg+"&"+_g+i+"="+a.ts+"&"+yg+i+"="+a.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(Tg)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{Pe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const wg=16384,Cg=45e3;let Ei=null;typeof MozWebSocket<"u"?Ei=MozWebSocket:typeof WebSocket<"u"&&(Ei=WebSocket);class $e{constructor(e,t,s,i,r,a,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ds(this.connId),this.stats_=Uo(t),this.connURL=$e.connectionURL_(t,a,l,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const a={};return a[nh]=Fo,typeof location<"u"&&location.hostname&&oh.test(location.hostname)&&(a[ih]=rh),t&&(a[sh]=t),s&&(a[ah]=s),i&&(a[Jr]=i),r&&(a[lh]=r),dh(e,ch,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,$t.set("previous_websocket_failure",!0);try{let s;wp(),this.mySock=new Ei(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){$e.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Ei!==null&&!$e.forceDisallow_}static previouslyFailed(){return $t.isInMemoryStorage||$t.get("previous_websocket_failure")===!0}markConnectionHealthy(){$t.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=ys(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(D(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=eh(t,wg);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Cg))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}$e.responsesRequiredToBeHealthy=2;$e.healthyTimeout=3e4;class Is{static get ALL_TRANSPORTS(){return[un,$e]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=$e&&$e.isAvailable();let s=t&&!$e.previouslyFailed();if(e.webSocketOnly&&(t||Fe("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[$e];else{const i=this.transports_=[];for(const r of Is.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Is.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Is.globalTransportInitialized_=!1;const Ag=6e4,Sg=5e3,Rg=10*1024,bg=100*1024,Vr="t",Xl="d",Pg="s",Jl="r",Ng="e",Zl="o",ec="a",tc="n",nc="p",Dg="h";class kg{constructor(e,t,s,i,r,a,l,u,h,f){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=u,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ds("c:"+this.id+":"),this.transportManager_=new Is(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=hs(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>bg?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Rg?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Vr in e){const t=e[Vr];t===ec?this.upgradeIfSecondaryHealthy_():t===Jl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Zl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Zn("t",e),s=Zn("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:nc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ec,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:tc,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Zn("t",e),s=Zn("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Zn(Vr,e);if(Xl in e){const s=e[Xl];if(t===Dg){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===tc){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Pg?this.onConnectionShutdown_(s):t===Jl?this.onReset_(s):t===Ng?Xr("Server Error: "+s):t===Zl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Xr("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Fo!==s&&Fe("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),hs(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ag))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):hs(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Sg))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:nc,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&($t.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class yh{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class Eh{constructor(e){this.allowedEvents_=e,this.listeners_={},D(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){D(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class vi extends Eh{static getInstance(){return new vi}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Fu()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return D(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const sc=32,ic=768;class re{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function J(){return new re("")}function $(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Rt(n){return n.pieces_.length-n.pieceNum_}function se(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new re(n.pieces_,e)}function vh(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Vg(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Th(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Ih(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new re(e,0)}function ge(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof re)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new re(t,0)}function z(n){return n.pieceNum_>=n.pieces_.length}function qe(n,e){const t=$(n),s=$(e);if(t===null)return e;if(t===s)return qe(se(n),se(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function wh(n,e){if(Rt(n)!==Rt(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function He(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Rt(n)>Rt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class xg{constructor(e,t){this.errorPrefix_=t,this.parts_=Th(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Mi(this.parts_[s]);Ch(this)}}function Og(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Mi(e),Ch(n)}function Mg(n){const e=n.parts_.pop();n.byteLength_-=Mi(e),n.parts_.length>0&&(n.byteLength_-=1)}function Ch(n){if(n.byteLength_>ic)throw new Error(n.errorPrefix_+"has a key path longer than "+ic+" bytes ("+n.byteLength_+").");if(n.parts_.length>sc)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+sc+") or object contains a cycle "+jt(n))}function jt(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class qo extends Eh{static getInstance(){return new qo}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return D(e==="visible","Unknown event type: "+e),[this.visible_]}}const es=1e3,Lg=300*1e3,rc=30*1e3,Fg=1.3,Ug=3e4,Bg="server_kill",oc=3;class st extends yh{constructor(e,t,s,i,r,a,l,u){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=u,this.id=st.nextPersistentConnectionId_++,this.log_=Ds("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=es,this.maxReconnectDelay_=Lg,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");qo.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&vi.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Ce(r)),D(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new Oi,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+r),this.listens.has(a)||this.listens.set(a,new Map),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),D(!this.listens.get(a).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(a).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},a="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(a,r,l=>{const u=l.d,h=l.s;st.warnOnListenWarnings_(u,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(h,u))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&lt(e,"w")){const s=gn(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();Fe(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Dp(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=rc)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Np(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,a=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},a="n";i&&(r.q=s,r.t=i),this.sendRequest(a,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,a=>{i&&setTimeout(()=>{i(a.s,a.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const a={p:t,d:s};r!==void 0&&(a.h=r),this.outstandingPuts_.push({action:e,request:a,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ce(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Xr("Unrecognized action received from server: "+Ce(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){D(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=es,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=es,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Ug&&(this.reconnectDelay_=es),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Fg)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+st.nextConnectionId_++,r=this.lastSessionId;let a=!1,l=null;const u=function(){l?l.close():(a=!0,s())},h=function(m){D(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(m)};this.realtime_={close:u,sendRequest:h};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[m,y]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?Pe("getToken() completed but was canceled"):(Pe("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=y&&y.token,l=new kg(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,S=>{Fe(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(Bg)},r))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Fe(m),u())}}}interrupt(e){Pe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Pe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ol(this.interruptReasons_)&&(this.reconnectDelay_=es,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>Lo(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new re(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){Pe("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=oc&&(this.reconnectDelay_=rc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Pe("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=oc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Yu.replace(/\./g,"-")]=1,Fu()?e["framework.cordova"]=1:Ip()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=vi.getInstance().currentlyOnline();return Ol(this.interruptReasons_)&&e}}st.nextPersistentConnectionId_=0;st.nextConnectionId_=0;class K{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new K(e,t)}}class Li{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new K(yn,e),i=new K(yn,t);return this.compare(s,i)!==0}minPost(){return K.MIN}}let ei;class Ah extends Li{static get __EMPTY_NODE(){return ei}static set __EMPTY_NODE(e){ei=e}compare(e,t){return Pn(e.name,t.name)}isDefinedOn(e){throw Rn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return K.MIN}maxPost(){return new K(Kt,ei)}makePost(e,t){return D(typeof e=="string","KeyIndex indexValue must always be a string."),new K(e,ei)}toString(){return".key"}}const dn=new Ah;let ti=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?s(e.key,t):1,i&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Be=class ss{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??ss.RED,this.left=i??Xe.EMPTY_NODE,this.right=r??Xe.EMPTY_NODE}copy(e,t,s,i,r){return new ss(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Xe.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return Xe.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ss.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ss.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Be.RED=!0;Be.BLACK=!1;class qg{copy(e,t,s,i,r){return this}insert(e,t,s){return new Be(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Xe=class ui{constructor(e,t=ui.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ui(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Be.BLACK,null,null))}remove(e){return new ui(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Be.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ti(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ti(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ti(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ti(this.root_,null,this.comparator_,!0,e)}};Xe.EMPTY_NODE=new qg;function jg(n,e){return Pn(n.name,e.name)}function jo(n,e){return Pn(n,e)}let Zr;function $g(n){Zr=n}const Sh=function(n){return typeof n=="number"?"number:"+th(n):"string:"+n},Rh=function(n){if(n.isLeafNode()){const e=n.val();D(typeof e=="string"||typeof e=="number"||typeof e=="object"&&lt(e,".sv"),"Priority must be a string or number.")}else D(n===Zr||n.isEmpty(),"priority of unexpected type.");D(n===Zr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ac;class ve{static set __childrenNodeConstructor(e){ac=e}static get __childrenNodeConstructor(){return ac}constructor(e,t=ve.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,D(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Rh(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ve(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ve.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return z(e)?this:$(e)===".priority"?this.priorityNode_:ve.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:ve.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=$(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(D(s!==".priority"||Rt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,ve.__childrenNodeConstructor.EMPTY_NODE.updateChild(se(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Sh(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=th(this.value_):e+=this.value_,this.lazyHash_=Ju(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ve.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ve.__childrenNodeConstructor?-1:(D(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=ve.VALUE_TYPE_ORDER.indexOf(t),r=ve.VALUE_TYPE_ORDER.indexOf(s);return D(i>=0,"Unknown leaf type: "+t),D(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}ve.VALUE_TYPE_ORDER=["object","boolean","number","string"];let bh,Ph;function Hg(n){bh=n}function zg(n){Ph=n}class Wg extends Li{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Pn(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return K.MIN}maxPost(){return new K(Kt,new ve("[PRIORITY-POST]",Ph))}makePost(e,t){const s=bh(e);return new K(t,new ve("[PRIORITY-POST]",s))}toString(){return".priority"}}const De=new Wg;const Gg=Math.log(2);class Kg{constructor(e){const t=r=>parseInt(Math.log(r)/Gg,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ti=function(n,e,t,s){n.sort(e);const i=function(u,h){const f=h-u;let m,y;if(f===0)return null;if(f===1)return m=n[u],y=t?t(m):m,new Be(y,m.node,Be.BLACK,null,null);{const S=parseInt(f/2,10)+u,b=i(u,S),x=i(S+1,h);return m=n[S],y=t?t(m):m,new Be(y,m.node,Be.BLACK,b,x)}},r=function(u){let h=null,f=null,m=n.length;const y=function(b,x){const k=m-b,L=m;m-=b;const q=i(k+1,L),U=n[k],Z=t?t(U):U;S(new Be(Z,U.node,x,null,q))},S=function(b){h?(h.left=b,h=b):(f=b,h=b)};for(let b=0;b<u.count;++b){const x=u.nextBitIsOne(),k=Math.pow(2,u.count-(b+1));x?y(k,Be.BLACK):(y(k,Be.BLACK),y(k,Be.RED))}return f},a=new Kg(n.length),l=r(a);return new Xe(s||e,l)};let xr;const rn={};class nt{static get Default(){return D(rn&&De,"ChildrenNode.ts has not been loaded"),xr=xr||new nt({".priority":rn},{".priority":De}),xr}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=gn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Xe?t:null}hasIndex(e){return lt(this.indexSet_,e.toString())}addIndex(e,t){D(e!==dn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(K.Wrap);let a=r.getNext();for(;a;)i=i||e.isDefinedOn(a.node),s.push(a),a=r.getNext();let l;i?l=Ti(s,e.getCompare()):l=rn;const u=e.toString(),h={...this.indexSet_};h[u]=e;const f={...this.indexes_};return f[u]=l,new nt(f,h)}addToIndexes(e,t){const s=_i(this.indexes_,(i,r)=>{const a=gn(this.indexSet_,r);if(D(a,"Missing index implementation for "+r),i===rn)if(a.isDefinedOn(e.node)){const l=[],u=t.getIterator(K.Wrap);let h=u.getNext();for(;h;)h.name!==e.name&&l.push(h),h=u.getNext();return l.push(e),Ti(l,a.getCompare())}else return rn;else{const l=t.get(e.name);let u=i;return l&&(u=u.remove(new K(e.name,l))),u.insert(e,e.node)}});return new nt(s,this.indexSet_)}removeFromIndexes(e,t){const s=_i(this.indexes_,i=>{if(i===rn)return i;{const r=t.get(e.name);return r?i.remove(new K(e.name,r)):i}});return new nt(s,this.indexSet_)}}let ts;class X{static get EMPTY_NODE(){return ts||(ts=new X(new Xe(jo),null,nt.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Rh(this.priorityNode_),this.children_.isEmpty()&&D(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ts}updatePriority(e){return this.children_.isEmpty()?this:new X(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ts:t}}getChild(e){const t=$(e);return t===null?this:this.getImmediateChild(t).getChild(se(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(D(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new K(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const a=i.isEmpty()?ts:this.priorityNode_;return new X(i,a,r)}}updateChild(e,t){const s=$(e);if(s===null)return t;{D($(e)!==".priority"||Rt(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(se(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(De,(a,l)=>{t[a]=l.val(e),s++,r&&X.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):r=!1}),!e&&r&&i<2*s){const a=[];for(const l in t)a[l]=t[l];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Sh(this.getPriority().val())+":"),this.forEachChild(De,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Ju(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new K(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new K(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new K(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,K.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,K.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ks?-1:0}withIndex(e){if(e===dn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new X(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===dn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(De),i=t.getIterator(De);let r=s.getNext(),a=i.getNext();for(;r&&a;){if(r.name!==a.name||!r.node.equals(a.node))return!1;r=s.getNext(),a=i.getNext()}return r===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===dn?null:this.indexMap_.get(e.toString())}}X.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Qg extends X{constructor(){super(new Xe(jo),X.EMPTY_NODE,nt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return X.EMPTY_NODE}isEmpty(){return!1}}const ks=new Qg;Object.defineProperties(K,{MIN:{value:new K(yn,X.EMPTY_NODE)},MAX:{value:new K(Kt,ks)}});Ah.__EMPTY_NODE=X.EMPTY_NODE;ve.__childrenNodeConstructor=X;$g(ks);zg(ks);const Yg=!0;function we(n,e=null){if(n===null)return X.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),D(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new ve(t,we(e))}if(!(n instanceof Array)&&Yg){const t=[];let s=!1;if(je(n,(a,l)=>{if(a.substring(0,1)!=="."){const u=we(l);u.isEmpty()||(s=s||!u.getPriority().isEmpty(),t.push(new K(a,u)))}}),t.length===0)return X.EMPTY_NODE;const r=Ti(t,jg,a=>a.name,jo);if(s){const a=Ti(t,De.getCompare());return new X(r,we(e),new nt({".priority":a},{".priority":De}))}else return new X(r,we(e),nt.Default)}else{let t=X.EMPTY_NODE;return je(n,(s,i)=>{if(lt(n,s)&&s.substring(0,1)!=="."){const r=we(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(we(e))}}Hg(we);class Xg extends Li{constructor(e){super(),this.indexPath_=e,D(!z(e)&&$(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Pn(e.name,t.name):r}makePost(e,t){const s=we(e),i=X.EMPTY_NODE.updateChild(this.indexPath_,s);return new K(t,i)}maxPost(){const e=X.EMPTY_NODE.updateChild(this.indexPath_,ks);return new K(Kt,e)}toString(){return Th(this.indexPath_,0).join("/")}}class Jg extends Li{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Pn(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return K.MIN}maxPost(){return K.MAX}makePost(e,t){const s=we(e);return new K(t,s)}toString(){return".value"}}const Zg=new Jg;function e_(n){return{type:"value",snapshotNode:n}}function t_(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function n_(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function lc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function s_(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class $o{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=De}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return D(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return D(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:yn}hasEnd(){return this.endSet_}getIndexEndValue(){return D(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return D(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Kt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return D(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===De}copy(){const e=new $o;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function cc(n){const e={};if(n.isDefault())return e;let t;if(n.index_===De?t="$priority":n.index_===Zg?t="$value":n.index_===dn?t="$key":(D(n.index_ instanceof Xg,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ce(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Ce(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Ce(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Ce(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Ce(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function uc(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==De&&(e.i=n.index_.toString()),e}class Ii extends yh{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(D(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Ds("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const a=Ii.getListenId_(e,s),l={};this.listens_[a]=l;const u=cc(e._queryParams);this.restRequest_(r+".json",u,(h,f)=>{let m=f;if(h===404&&(m=null,h=null),h===null&&this.onDataUpdate_(r,m,!1,s),gn(this.listens_,a)===l){let y;h?h===401?y="permission_denied":y="rest_error:"+h:y="ok",i(y,null)}})}unlisten(e,t){const s=Ii.getListenId_(e,t);delete this.listens_[s]}get(e){const t=cc(e._queryParams),s=e._path.toString(),i=new Oi;return this.restRequest_(s+".json",t,(r,a)=>{let l=a;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+kp(t);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let u=null;if(l.status>=200&&l.status<300){try{u=ys(l.responseText)}catch{Fe("Failed to parse JSON response for "+a+": "+l.responseText)}s(null,u)}else l.status!==401&&l.status!==404&&Fe("Got unsuccessful REST response for "+a+" Status: "+l.status),s(l.status);s=null}},l.open("GET",a,!0),l.send()})}}class i_{constructor(){this.rootNode_=X.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function wi(){return{value:null,children:new Map}}function Nh(n,e,t){if(z(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=$(e);n.children.has(s)||n.children.set(s,wi());const i=n.children.get(s);e=se(e),Nh(i,e,t)}}function eo(n,e,t){n.value!==null?t(e,n.value):r_(n,(s,i)=>{const r=new re(e.toString()+"/"+s);eo(i,r,t)})}function r_(n,e){n.children.forEach((t,s)=>{e(s,t)})}class o_{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&je(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const hc=10*1e3,a_=30*1e3,l_=300*1e3;class c_{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new o_(e);const s=hc+(a_-hc)*Math.random();hs(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;je(e,(i,r)=>{r>0&&lt(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),hs(this.reportStats_.bind(this),Math.floor(Math.random()*2*l_))}}var Je;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Je||(Je={}));function Dh(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function kh(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Vh(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Ci{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Je.ACK_USER_WRITE,this.source=Dh()}operationForChild(e){if(z(this.path)){if(this.affectedTree.value!=null)return D(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new re(e));return new Ci(J(),t,this.revert)}}else return D($(this.path)===e,"operationForChild called for unrelated child."),new Ci(se(this.path),this.affectedTree,this.revert)}}class Qt{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Je.OVERWRITE}operationForChild(e){return z(this.path)?new Qt(this.source,J(),this.snap.getImmediateChild(e)):new Qt(this.source,se(this.path),this.snap)}}class ws{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Je.MERGE}operationForChild(e){if(z(this.path)){const t=this.children.subtree(new re(e));return t.isEmpty()?null:t.value?new Qt(this.source,J(),t.value):new ws(this.source,J(),t)}else return D($(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ws(this.source,se(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ho{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(z(e))return this.isFullyInitialized()&&!this.filtered_;const t=$(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function u_(n,e,t,s){const i=[],r=[];return e.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&r.push(s_(a.childName,a.snapshotNode))}),ns(n,i,"child_removed",e,s,t),ns(n,i,"child_added",e,s,t),ns(n,i,"child_moved",r,s,t),ns(n,i,"child_changed",e,s,t),ns(n,i,"value",e,s,t),i}function ns(n,e,t,s,i,r){const a=s.filter(l=>l.type===t);a.sort((l,u)=>d_(n,l,u)),a.forEach(l=>{const u=h_(n,l,r);i.forEach(h=>{h.respondsTo(l.type)&&e.push(h.createEvent(u,n.query_))})})}function h_(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function d_(n,e,t){if(e.childName==null||t.childName==null)throw Rn("Should only compare child_ events.");const s=new K(e.childName,e.snapshotNode),i=new K(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function xh(n,e){return{eventCache:n,serverCache:e}}function ds(n,e,t,s){return xh(new Ho(e,t,s),n.serverCache)}function Oh(n,e,t,s){return xh(n.eventCache,new Ho(e,t,s))}function to(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Yt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Or;const f_=()=>(Or||(Or=new Xe(Zm)),Or);class ne{static fromObject(e){let t=new ne(null);return je(e,(s,i)=>{t=t.set(new re(s),i)}),t}constructor(e,t=f_()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:J(),value:this.value};if(z(e))return null;{const s=$(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(se(e),t);return r!=null?{path:ge(new re(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(z(e))return this;{const t=$(e),s=this.children.get(t);return s!==null?s.subtree(se(e)):new ne(null)}}set(e,t){if(z(e))return new ne(t,this.children);{const s=$(e),r=(this.children.get(s)||new ne(null)).set(se(e),t),a=this.children.insert(s,r);return new ne(this.value,a)}}remove(e){if(z(e))return this.children.isEmpty()?new ne(null):new ne(null,this.children);{const t=$(e),s=this.children.get(t);if(s){const i=s.remove(se(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new ne(null):new ne(this.value,r)}else return this}}get(e){if(z(e))return this.value;{const t=$(e),s=this.children.get(t);return s?s.get(se(e)):null}}setTree(e,t){if(z(e))return t;{const s=$(e),r=(this.children.get(s)||new ne(null)).setTree(se(e),t);let a;return r.isEmpty()?a=this.children.remove(s):a=this.children.insert(s,r),new ne(this.value,a)}}fold(e){return this.fold_(J(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(ge(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,J(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(z(e))return null;{const r=$(e),a=this.children.get(r);return a?a.findOnPath_(se(e),ge(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,J(),t)}foreachOnPath_(e,t,s){if(z(e))return this;{this.value&&s(t,this.value);const i=$(e),r=this.children.get(i);return r?r.foreachOnPath_(se(e),ge(t,i),s):new ne(null)}}foreach(e){this.foreach_(J(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(ge(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class ze{constructor(e){this.writeTree_=e}static empty(){return new ze(new ne(null))}}function fs(n,e,t){if(z(e))return new ze(new ne(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const a=qe(i,e);return r=r.updateChild(a,t),new ze(n.writeTree_.set(i,r))}else{const i=new ne(t),r=n.writeTree_.setTree(e,i);return new ze(r)}}}function dc(n,e,t){let s=n;return je(t,(i,r)=>{s=fs(s,ge(e,i),r)}),s}function fc(n,e){if(z(e))return ze.empty();{const t=n.writeTree_.setTree(e,new ne(null));return new ze(t)}}function no(n,e){return Jt(n,e)!=null}function Jt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(qe(t.path,e)):null}function pc(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(De,(s,i)=>{e.push(new K(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new K(s,i.value))}),e}function Tt(n,e){if(z(e))return n;{const t=Jt(n,e);return t!=null?new ze(new ne(t)):new ze(n.writeTree_.subtree(e))}}function so(n){return n.writeTree_.isEmpty()}function En(n,e){return Mh(J(),n.writeTree_,e)}function Mh(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(D(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=Mh(ge(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(ge(n,".priority"),s)),t}}function Lh(n,e){return jh(e,n)}function p_(n,e,t,s,i){D(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=fs(n.visibleWrites,e,t)),n.lastWriteId=s}function m_(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function g_(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);D(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,a=n.allWrites.length-1;for(;i&&a>=0;){const l=n.allWrites[a];l.visible&&(a>=t&&__(l,s.path)?i=!1:He(s.path,l.path)&&(r=!0)),a--}if(i){if(r)return y_(n),!0;if(s.snap)n.visibleWrites=fc(n.visibleWrites,s.path);else{const l=s.children;je(l,u=>{n.visibleWrites=fc(n.visibleWrites,ge(s.path,u))})}return!0}else return!1}function __(n,e){if(n.snap)return He(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&He(ge(n.path,t),e))return!0;return!1}function y_(n){n.visibleWrites=Fh(n.allWrites,E_,J()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function E_(n){return n.visible}function Fh(n,e,t){let s=ze.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const a=r.path;let l;if(r.snap)He(t,a)?(l=qe(t,a),s=fs(s,l,r.snap)):He(a,t)&&(l=qe(a,t),s=fs(s,J(),r.snap.getChild(l)));else if(r.children){if(He(t,a))l=qe(t,a),s=dc(s,l,r.children);else if(He(a,t))if(l=qe(a,t),z(l))s=dc(s,J(),r.children);else{const u=gn(r.children,$(l));if(u){const h=u.getChild(se(l));s=fs(s,J(),h)}}}else throw Rn("WriteRecord should have .snap or .children")}}return s}function Uh(n,e,t,s,i){if(!s&&!i){const r=Jt(n.visibleWrites,e);if(r!=null)return r;{const a=Tt(n.visibleWrites,e);if(so(a))return t;if(t==null&&!no(a,J()))return null;{const l=t||X.EMPTY_NODE;return En(a,l)}}}else{const r=Tt(n.visibleWrites,e);if(!i&&so(r))return t;if(!i&&t==null&&!no(r,J()))return null;{const a=function(h){return(h.visible||i)&&(!s||!~s.indexOf(h.writeId))&&(He(h.path,e)||He(e,h.path))},l=Fh(n.allWrites,a,e),u=t||X.EMPTY_NODE;return En(l,u)}}}function v_(n,e,t){let s=X.EMPTY_NODE;const i=Jt(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(De,(r,a)=>{s=s.updateImmediateChild(r,a)}),s;if(t){const r=Tt(n.visibleWrites,e);return t.forEachChild(De,(a,l)=>{const u=En(Tt(r,new re(a)),l);s=s.updateImmediateChild(a,u)}),pc(r).forEach(a=>{s=s.updateImmediateChild(a.name,a.node)}),s}else{const r=Tt(n.visibleWrites,e);return pc(r).forEach(a=>{s=s.updateImmediateChild(a.name,a.node)}),s}}function T_(n,e,t,s,i){D(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=ge(e,t);if(no(n.visibleWrites,r))return null;{const a=Tt(n.visibleWrites,r);return so(a)?i.getChild(t):En(a,i.getChild(t))}}function I_(n,e,t,s){const i=ge(e,t),r=Jt(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const a=Tt(n.visibleWrites,i);return En(a,s.getNode().getImmediateChild(t))}else return null}function w_(n,e){return Jt(n.visibleWrites,e)}function C_(n,e,t,s,i,r,a){let l;const u=Tt(n.visibleWrites,e),h=Jt(u,J());if(h!=null)l=h;else if(t!=null)l=En(u,t);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const f=[],m=a.getCompare(),y=r?l.getReverseIteratorFrom(s,a):l.getIteratorFrom(s,a);let S=y.getNext();for(;S&&f.length<i;)m(S,s)!==0&&f.push(S),S=y.getNext();return f}else return[]}function A_(){return{visibleWrites:ze.empty(),allWrites:[],lastWriteId:-1}}function io(n,e,t,s){return Uh(n.writeTree,n.treePath,e,t,s)}function Bh(n,e){return v_(n.writeTree,n.treePath,e)}function mc(n,e,t,s){return T_(n.writeTree,n.treePath,e,t,s)}function Ai(n,e){return w_(n.writeTree,ge(n.treePath,e))}function S_(n,e,t,s,i,r){return C_(n.writeTree,n.treePath,e,t,s,i,r)}function zo(n,e,t){return I_(n.writeTree,n.treePath,e,t)}function qh(n,e){return jh(ge(n.treePath,e),n.writeTree)}function jh(n,e){return{treePath:n,writeTree:e}}class R_{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;D(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),D(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,lc(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,n_(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,t_(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,lc(s,e.snapshotNode,i.oldSnap));else throw Rn("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class b_{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const $h=new b_;class Wo{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Ho(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return zo(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Yt(this.viewCache_),r=S_(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function P_(n,e){D(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),D(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function N_(n,e,t,s,i){const r=new R_;let a,l;if(t.type===Je.OVERWRITE){const h=t;h.source.fromUser?a=ro(n,e,h.path,h.snap,s,i,r):(D(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered()&&!z(h.path),a=Si(n,e,h.path,h.snap,s,i,l,r))}else if(t.type===Je.MERGE){const h=t;h.source.fromUser?a=k_(n,e,h.path,h.children,s,i,r):(D(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered(),a=oo(n,e,h.path,h.children,s,i,l,r))}else if(t.type===Je.ACK_USER_WRITE){const h=t;h.revert?a=O_(n,e,h.path,s,i,r):a=V_(n,e,h.path,h.affectedTree,s,i,r)}else if(t.type===Je.LISTEN_COMPLETE)a=x_(n,e,t.path,s,r);else throw Rn("Unknown operation type: "+t.type);const u=r.getChanges();return D_(e,a,u),{viewCache:a,changes:u}}function D_(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=to(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(e_(to(e)))}}function Hh(n,e,t,s,i,r){const a=e.eventCache;if(Ai(s,t)!=null)return e;{let l,u;if(z(t))if(D(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=Yt(e),f=h instanceof X?h:X.EMPTY_NODE,m=Bh(s,f);l=n.filter.updateFullNode(e.eventCache.getNode(),m,r)}else{const h=io(s,Yt(e));l=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const h=$(t);if(h===".priority"){D(Rt(t)===1,"Can't have a priority with additional path components");const f=a.getNode();u=e.serverCache.getNode();const m=mc(s,t,f,u);m!=null?l=n.filter.updatePriority(f,m):l=a.getNode()}else{const f=se(t);let m;if(a.isCompleteForChild(h)){u=e.serverCache.getNode();const y=mc(s,t,a.getNode(),u);y!=null?m=a.getNode().getImmediateChild(h).updateChild(f,y):m=a.getNode().getImmediateChild(h)}else m=zo(s,h,e.serverCache);m!=null?l=n.filter.updateChild(a.getNode(),h,m,f,i,r):l=a.getNode()}}return ds(e,l,a.isFullyInitialized()||z(t),n.filter.filtersNodes())}}function Si(n,e,t,s,i,r,a,l){const u=e.serverCache;let h;const f=a?n.filter:n.filter.getIndexedFilter();if(z(t))h=f.updateFullNode(u.getNode(),s,null);else if(f.filtersNodes()&&!u.isFiltered()){const S=u.getNode().updateChild(t,s);h=f.updateFullNode(u.getNode(),S,null)}else{const S=$(t);if(!u.isCompleteForPath(t)&&Rt(t)>1)return e;const b=se(t),k=u.getNode().getImmediateChild(S).updateChild(b,s);S===".priority"?h=f.updatePriority(u.getNode(),k):h=f.updateChild(u.getNode(),S,k,b,$h,null)}const m=Oh(e,h,u.isFullyInitialized()||z(t),f.filtersNodes()),y=new Wo(i,m,r);return Hh(n,m,t,i,y,l)}function ro(n,e,t,s,i,r,a){const l=e.eventCache;let u,h;const f=new Wo(i,e,r);if(z(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,a),u=ds(e,h,!0,n.filter.filtersNodes());else{const m=$(t);if(m===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),s),u=ds(e,h,l.isFullyInitialized(),l.isFiltered());else{const y=se(t),S=l.getNode().getImmediateChild(m);let b;if(z(y))b=s;else{const x=f.getCompleteChild(m);x!=null?vh(y)===".priority"&&x.getChild(Ih(y)).isEmpty()?b=x:b=x.updateChild(y,s):b=X.EMPTY_NODE}if(S.equals(b))u=e;else{const x=n.filter.updateChild(l.getNode(),m,b,y,f,a);u=ds(e,x,l.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function gc(n,e){return n.eventCache.isCompleteForChild(e)}function k_(n,e,t,s,i,r,a){let l=e;return s.foreach((u,h)=>{const f=ge(t,u);gc(e,$(f))&&(l=ro(n,l,f,h,i,r,a))}),s.foreach((u,h)=>{const f=ge(t,u);gc(e,$(f))||(l=ro(n,l,f,h,i,r,a))}),l}function _c(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function oo(n,e,t,s,i,r,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,h;z(t)?h=s:h=new ne(null).setTree(t,s);const f=e.serverCache.getNode();return h.children.inorderTraversal((m,y)=>{if(f.hasChild(m)){const S=e.serverCache.getNode().getImmediateChild(m),b=_c(n,S,y);u=Si(n,u,new re(m),b,i,r,a,l)}}),h.children.inorderTraversal((m,y)=>{const S=!e.serverCache.isCompleteForChild(m)&&y.value===null;if(!f.hasChild(m)&&!S){const b=e.serverCache.getNode().getImmediateChild(m),x=_c(n,b,y);u=Si(n,u,new re(m),x,i,r,a,l)}}),u}function V_(n,e,t,s,i,r,a){if(Ai(i,t)!=null)return e;const l=e.serverCache.isFiltered(),u=e.serverCache;if(s.value!=null){if(z(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Si(n,e,t,u.getNode().getChild(t),i,r,l,a);if(z(t)){let h=new ne(null);return u.getNode().forEachChild(dn,(f,m)=>{h=h.set(new re(f),m)}),oo(n,e,t,h,i,r,l,a)}else return e}else{let h=new ne(null);return s.foreach((f,m)=>{const y=ge(t,f);u.isCompleteForPath(y)&&(h=h.set(f,u.getNode().getChild(y)))}),oo(n,e,t,h,i,r,l,a)}}function x_(n,e,t,s,i){const r=e.serverCache,a=Oh(e,r.getNode(),r.isFullyInitialized()||z(t),r.isFiltered());return Hh(n,a,t,s,$h,i)}function O_(n,e,t,s,i,r){let a;if(Ai(s,t)!=null)return e;{const l=new Wo(s,e,i),u=e.eventCache.getNode();let h;if(z(t)||$(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=io(s,Yt(e));else{const m=e.serverCache.getNode();D(m instanceof X,"serverChildren would be complete if leaf node"),f=Bh(s,m)}f=f,h=n.filter.updateFullNode(u,f,r)}else{const f=$(t);let m=zo(s,f,e.serverCache);m==null&&e.serverCache.isCompleteForChild(f)&&(m=u.getImmediateChild(f)),m!=null?h=n.filter.updateChild(u,f,m,se(t),l,r):e.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(u,f,X.EMPTY_NODE,se(t),l,r):h=u,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=io(s,Yt(e)),a.isLeafNode()&&(h=n.filter.updateFullNode(h,a,r)))}return a=e.serverCache.isFullyInitialized()||Ai(s,J())!=null,ds(e,h,a,n.filter.filtersNodes())}}function M_(n,e){const t=Yt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!z(e)&&!t.getImmediateChild($(e)).isEmpty())?t.getChild(e):null}function yc(n,e,t,s){e.type===Je.MERGE&&e.source.queryId!==null&&(D(Yt(n.viewCache_),"We should always have a full cache before handling merges"),D(to(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=N_(n.processor_,i,e,t,s);return P_(n.processor_,r.viewCache),D(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,L_(n,r.changes,r.viewCache.eventCache.getNode())}function L_(n,e,t,s){const i=n.eventRegistrations_;return u_(n.eventGenerator_,e,t,i)}let Ec;function F_(n){D(!Ec,"__referenceConstructor has already been defined"),Ec=n}function Go(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return D(r!=null,"SyncTree gave us an op for an invalid query."),yc(r,e,t,s)}else{let r=[];for(const a of n.views.values())r=r.concat(yc(a,e,t,s));return r}}function Ko(n,e){let t=null;for(const s of n.views.values())t=t||M_(s,e);return t}let vc;function U_(n){D(!vc,"__referenceConstructor has already been defined"),vc=n}class Tc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ne(null),this.pendingWriteTree_=A_(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function zh(n,e,t,s,i){return p_(n.pendingWriteTree_,e,t,s,i),i?Ui(n,new Qt(Dh(),e,t)):[]}function Ht(n,e,t=!1){const s=m_(n.pendingWriteTree_,e);if(g_(n.pendingWriteTree_,e)){let r=new ne(null);return s.snap!=null?r=r.set(J(),!0):je(s.children,a=>{r=r.set(new re(a),!0)}),Ui(n,new Ci(s.path,r,t))}else return[]}function Fi(n,e,t){return Ui(n,new Qt(kh(),e,t))}function B_(n,e,t){const s=ne.fromObject(t);return Ui(n,new ws(kh(),e,s))}function q_(n,e,t,s){const i=Kh(n,s);if(i!=null){const r=Qh(i),a=r.path,l=r.queryId,u=qe(a,e),h=new Qt(Vh(l),u,t);return Yh(n,a,h)}else return[]}function j_(n,e,t,s){const i=Kh(n,s);if(i){const r=Qh(i),a=r.path,l=r.queryId,u=qe(a,e),h=ne.fromObject(t),f=new ws(Vh(l),u,h);return Yh(n,a,f)}else return[]}function Qo(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(a,l)=>{const u=qe(a,e),h=Ko(l,u);if(h)return h});return Uh(i,e,r,t,!0)}function Ui(n,e){return Wh(e,n.syncPointTree_,null,Lh(n.pendingWriteTree_,J()))}function Wh(n,e,t,s){if(z(n.path))return Gh(n,e,t,s);{const i=e.get(J());t==null&&i!=null&&(t=Ko(i,J()));let r=[];const a=$(n.path),l=n.operationForChild(a),u=e.children.get(a);if(u&&l){const h=t?t.getImmediateChild(a):null,f=qh(s,a);r=r.concat(Wh(l,u,h,f))}return i&&(r=r.concat(Go(i,n,s,t))),r}}function Gh(n,e,t,s){const i=e.get(J());t==null&&i!=null&&(t=Ko(i,J()));let r=[];return e.children.inorderTraversal((a,l)=>{const u=t?t.getImmediateChild(a):null,h=qh(s,a),f=n.operationForChild(a);f&&(r=r.concat(Gh(f,l,u,h)))}),i&&(r=r.concat(Go(i,n,s,t))),r}function Kh(n,e){return n.tagToQueryMap.get(e)}function Qh(n){const e=n.indexOf("$");return D(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new re(n.substr(0,e))}}function Yh(n,e,t){const s=n.syncPointTree_.get(e);D(s,"Missing sync point for query tag that we're tracking");const i=Lh(n.pendingWriteTree_,e);return Go(s,t,i,null)}class Yo{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Yo(t)}node(){return this.node_}}class Xo{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ge(this.path_,e);return new Xo(this.syncTree_,t)}node(){return Qo(this.syncTree_,this.path_)}}const $_=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ic=function(n,e,t){if(!n||typeof n!="object")return n;if(D(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return H_(n[".sv"],e,t);if(typeof n[".sv"]=="object")return z_(n[".sv"],e);D(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},H_=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:D(!1,"Unexpected server value: "+n)}},z_=function(n,e,t){n.hasOwnProperty("increment")||D(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&D(!1,"Unexpected increment value: "+s);const i=e.node();if(D(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const a=i.getValue();return typeof a!="number"?s:a+s},W_=function(n,e,t,s){return Jo(e,new Xo(t,n),s)},Xh=function(n,e,t){return Jo(n,new Yo(e),t)};function Jo(n,e,t){const s=n.getPriority().val(),i=Ic(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const a=n,l=Ic(a.getValue(),e,t);return l!==a.getValue()||i!==a.getPriority().val()?new ve(l,we(i)):n}else{const a=n;return r=a,i!==a.getPriority().val()&&(r=r.updatePriority(new ve(i))),a.forEachChild(De,(l,u)=>{const h=Jo(u,e.getImmediateChild(l),t);h!==u&&(r=r.updateImmediateChild(l,h))}),r}}class Zo{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function ea(n,e){let t=e instanceof re?e:new re(e),s=n,i=$(t);for(;i!==null;){const r=gn(s.node.children,i)||{children:{},childCount:0};s=new Zo(i,s,r),t=se(t),i=$(t)}return s}function Dn(n){return n.node.value}function Jh(n,e){n.node.value=e,ao(n)}function Zh(n){return n.node.childCount>0}function G_(n){return Dn(n)===void 0&&!Zh(n)}function Bi(n,e){je(n.node.children,(t,s)=>{e(new Zo(t,n,s))})}function ed(n,e,t,s){t&&e(n),Bi(n,i=>{ed(i,e,!0)})}function K_(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Vs(n){return new re(n.parent===null?n.name:Vs(n.parent)+"/"+n.name)}function ao(n){n.parent!==null&&Q_(n.parent,n.name,n)}function Q_(n,e,t){const s=G_(t),i=lt(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,ao(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,ao(n))}const Y_=/[\[\].#$\/\u0000-\u001F\u007F]/,X_=/[\[\].#$\u0000-\u001F\u007F]/,Mr=10*1024*1024,td=function(n){return typeof n=="string"&&n.length!==0&&!Y_.test(n)},nd=function(n){return typeof n=="string"&&n.length!==0&&!X_.test(n)},J_=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),nd(n)},sd=function(n,e,t,s){s&&e===void 0||ta(xo(n,"value"),e,t)},ta=function(n,e,t){const s=t instanceof re?new xg(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+jt(s));if(typeof e=="function")throw new Error(n+"contains a function "+jt(s)+" with contents = "+e.toString());if(Zu(e))throw new Error(n+"contains "+e.toString()+" "+jt(s));if(typeof e=="string"&&e.length>Mr/3&&Mi(e)>Mr)throw new Error(n+"contains a string greater than "+Mr+" utf8 bytes "+jt(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(je(e,(a,l)=>{if(a===".value")i=!0;else if(a!==".priority"&&a!==".sv"&&(r=!0,!td(a)))throw new Error(n+" contains an invalid key ("+a+") "+jt(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Og(s,a),ta(n,l,s),Mg(s)}),i&&r)throw new Error(n+' contains ".value" child '+jt(s)+" in addition to actual children.")}},id=function(n,e,t,s){if(!nd(t))throw new Error(xo(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Z_=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),id(n,e,t)},rd=function(n,e){if($(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},ey=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!td(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!J_(t))throw new Error(xo(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class ty{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function od(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!wh(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function ot(n,e,t){od(n,t),ny(n,s=>He(s,e)||He(e,s))}function ny(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(sy(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function sy(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();us&&Pe("event: "+t.toString()),Nn(s)}}}const iy="repo_interrupt",ry=25;class oy{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ty,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=wi(),this.transactionQueueTree_=new Zo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ay(n,e,t){if(n.stats_=Uo(n.repoInfo_),n.forceRestClient_||rg())n.server_=new Ii(n.repoInfo_,(s,i,r,a)=>{wc(n,s,i,r,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Cc(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ce(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new st(n.repoInfo_,e,(s,i,r,a)=>{wc(n,s,i,r,a)},s=>{Cc(n,s)},s=>{ly(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=ug(n.repoInfo_,()=>new c_(n.stats_,n.server_)),n.infoData_=new i_,n.infoSyncTree_=new Tc({startListening:(s,i,r,a)=>{let l=[];const u=n.infoData_.getNode(s._path);return u.isEmpty()||(l=Fi(n.infoSyncTree_,s._path,u),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),sa(n,"connected",!1),n.serverSyncTree_=new Tc({startListening:(s,i,r,a)=>(n.server_.listen(s,r,i,(l,u)=>{const h=a(l,u);ot(n.eventQueue_,s._path,h)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function ad(n){const t=n.infoData_.getNode(new re(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function na(n){return $_({timestamp:ad(n)})}function wc(n,e,t,s,i){n.dataUpdateCount++;const r=new re(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(i)if(s){const u=_i(t,h=>we(h));a=j_(n.serverSyncTree_,r,u,i)}else{const u=we(t);a=q_(n.serverSyncTree_,r,u,i)}else if(s){const u=_i(t,h=>we(h));a=B_(n.serverSyncTree_,r,u)}else{const u=we(t);a=Fi(n.serverSyncTree_,r,u)}let l=r;a.length>0&&(l=qi(n,r)),ot(n.eventQueue_,l,a)}function Cc(n,e){sa(n,"connected",e),e===!1&&uy(n)}function ly(n,e){je(e,(t,s)=>{sa(n,t,s)})}function sa(n,e,t){const s=new re("/.info/"+e),i=we(t);n.infoData_.updateSnapshot(s,i);const r=Fi(n.infoSyncTree_,s,i);ot(n.eventQueue_,s,r)}function ld(n){return n.nextWriteId_++}function cy(n,e,t,s,i){ia(n,"set",{path:e.toString(),value:t,priority:s});const r=na(n),a=we(t,s),l=Qo(n.serverSyncTree_,e),u=Xh(a,l,r),h=ld(n),f=zh(n.serverSyncTree_,e,u,h,!0);od(n.eventQueue_,f),n.server_.put(e.toString(),a.val(!0),(y,S)=>{const b=y==="ok";b||Fe("set at "+e+" failed: "+y);const x=Ht(n.serverSyncTree_,h,!b);ot(n.eventQueue_,e,x),dy(n,i,y,S)});const m=fd(n,e);qi(n,m),ot(n.eventQueue_,m,[])}function uy(n){ia(n,"onDisconnectEvents");const e=na(n),t=wi();eo(n.onDisconnect_,J(),(i,r)=>{const a=W_(i,r,n.serverSyncTree_,e);Nh(t,i,a)});let s=[];eo(t,J(),(i,r)=>{s=s.concat(Fi(n.serverSyncTree_,i,r));const a=fd(n,i);qi(n,a)}),n.onDisconnect_=wi(),ot(n.eventQueue_,J(),s)}function hy(n){n.persistentConnection_&&n.persistentConnection_.interrupt(iy)}function ia(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Pe(t,...e)}function dy(n,e,t,s){e&&Nn(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const a=new Error(r);a.code=i,e(a)}})}function cd(n,e,t){return Qo(n.serverSyncTree_,e,t)||X.EMPTY_NODE}function ra(n,e=n.transactionQueueTree_){if(e||ji(n,e),Dn(e)){const t=hd(n,e);D(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&fy(n,Vs(e),t)}else Zh(e)&&Bi(e,t=>{ra(n,t)})}function fy(n,e,t){const s=t.map(h=>h.currentWriteId),i=cd(n,e,s);let r=i;const a=i.hash();for(let h=0;h<t.length;h++){const f=t[h];D(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const m=qe(e,f.path);r=r.updateChild(m,f.currentOutputSnapshotRaw)}const l=r.val(!0),u=e;n.server_.put(u.toString(),l,h=>{ia(n,"transaction put response",{path:u.toString(),status:h});let f=[];if(h==="ok"){const m=[];for(let y=0;y<t.length;y++)t[y].status=2,f=f.concat(Ht(n.serverSyncTree_,t[y].currentWriteId)),t[y].onComplete&&m.push(()=>t[y].onComplete(null,!0,t[y].currentOutputSnapshotResolved)),t[y].unwatcher();ji(n,ea(n.transactionQueueTree_,e)),ra(n,n.transactionQueueTree_),ot(n.eventQueue_,e,f);for(let y=0;y<m.length;y++)Nn(m[y])}else{if(h==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{Fe("transaction at "+u.toString()+" failed: "+h);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=h}qi(n,e)}},a)}function qi(n,e){const t=ud(n,e),s=Vs(t),i=hd(n,t);return py(n,i,s),s}function py(n,e,t){if(e.length===0)return;const s=[];let i=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const u=e[l],h=qe(t,u.path);let f=!1,m;if(D(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)f=!0,m=u.abortReason,i=i.concat(Ht(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=ry)f=!0,m="maxretry",i=i.concat(Ht(n.serverSyncTree_,u.currentWriteId,!0));else{const y=cd(n,u.path,a);u.currentInputSnapshot=y;const S=e[l].update(y.val());if(S!==void 0){ta("transaction failed: Data returned ",S,u.path);let b=we(S);typeof S=="object"&&S!=null&&lt(S,".priority")||(b=b.updatePriority(y.getPriority()));const k=u.currentWriteId,L=na(n),q=Xh(b,y,L);u.currentOutputSnapshotRaw=b,u.currentOutputSnapshotResolved=q,u.currentWriteId=ld(n),a.splice(a.indexOf(k),1),i=i.concat(zh(n.serverSyncTree_,u.path,q,u.currentWriteId,u.applyLocally)),i=i.concat(Ht(n.serverSyncTree_,k,!0))}else f=!0,m="nodata",i=i.concat(Ht(n.serverSyncTree_,u.currentWriteId,!0))}ot(n.eventQueue_,t,i),i=[],f&&(e[l].status=2,(function(y){setTimeout(y,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(m==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(m),!1,null))))}ji(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)Nn(s[l]);ra(n,n.transactionQueueTree_)}function ud(n,e){let t,s=n.transactionQueueTree_;for(t=$(e);t!==null&&Dn(s)===void 0;)s=ea(s,t),e=se(e),t=$(e);return s}function hd(n,e){const t=[];return dd(n,e,t),t.sort((s,i)=>s.order-i.order),t}function dd(n,e,t){const s=Dn(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Bi(e,i=>{dd(n,i,t)})}function ji(n,e){const t=Dn(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Jh(e,t.length>0?t:void 0)}Bi(e,s=>{ji(n,s)})}function fd(n,e){const t=Vs(ud(n,e)),s=ea(n.transactionQueueTree_,e);return K_(s,i=>{Lr(n,i)}),Lr(n,s),ed(s,i=>{Lr(n,i)}),t}function Lr(n,e){const t=Dn(e);if(t){const s=[];let i=[],r=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(D(r===a-1,"All SENT items should be at beginning of queue."),r=a,t[a].status=3,t[a].abortReason="set"):(D(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),i=i.concat(Ht(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&s.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Jh(e,void 0):t.length=r+1,ot(n.eventQueue_,Vs(e),i);for(let a=0;a<s.length;a++)Nn(s[a])}}function my(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function gy(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Fe(`Invalid query segment '${t}' in query '${n}'`)}return e}const Ac=function(n,e){const t=_y(n),s=t.namespace;t.domain==="firebase.com"&&rt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&rt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Xm();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new hh(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new re(t.pathString)}},_y=function(n){let e="",t="",s="",i="",r="",a=!0,l="https",u=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let m=n.indexOf("?");m===-1&&(m=n.length),e=n.substring(0,Math.min(f,m)),f<m&&(i=my(n.substring(f,m)));const y=gy(n.substring(Math.min(n.length,m)));h=e.indexOf(":"),h>=0?(a=l==="https"||l==="wss",u=parseInt(e.substring(h+1),10)):h=e.length;const S=e.slice(0,h);if(S.toLowerCase()==="localhost")t="localhost";else if(S.split(".").length<=2)t=S;else{const b=e.indexOf(".");s=e.substring(0,b).toLowerCase(),t=e.substring(b+1),r=s}"ns"in y&&(r=y.ns)}return{host:e,port:u,domain:t,subdomain:s,secure:a,scheme:l,pathString:i,namespace:r}};const Sc="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",yy=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=Sc.charAt(t%64),t=Math.floor(t/64);D(t===0,"Cannot push at time == 0");let a=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)a+=Sc.charAt(e[i]);return D(a.length===20,"nextPushId: Length should be 20."),a}})();class oa{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return z(this._path)?null:vh(this._path)}get ref(){return new Zt(this._repo,this._path)}get _queryIdentifier(){const e=uc(this._queryParams),t=Lo(e);return t==="{}"?"default":t}get _queryObject(){return uc(this._queryParams)}isEqual(e){if(e=xt(e),!(e instanceof oa))return!1;const t=this._repo===e._repo,s=wh(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Vg(this._path)}}class Zt extends oa{constructor(e,t){super(e,t,new $o,!1)}get parent(){const e=Ih(this._path);return e===null?null:new Zt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}function Ey(n,e){return n=xt(n),n._checkNotDeleted("ref"),lo(n._root,e)}function lo(n,e){return n=xt(n),$(n._path)===null?Z_("child","path",e):id("child","path",e),new Zt(n._repo,ge(n._path,e))}function vy(n,e){n=xt(n),rd("push",n._path),sd("push",e,n._path,!0);const t=ad(n._repo),s=yy(t),i=lo(n,s),r=lo(n,s);let a;return e!=null?a=Ty(r,e).then(()=>r):a=Promise.resolve(r),i.then=a.then.bind(a),i.catch=a.then.bind(a,void 0),i}function Ty(n,e){n=xt(n),rd("set",n._path),sd("set",e,n._path,!1);const t=new Oi;return cy(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}F_(Zt);U_(Zt);const Iy="FIREBASE_DATABASE_EMULATOR_HOST",co={};let wy=!1;function Cy(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),a=Ps(r);n.repoInfo_=new hh(e,a,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function Ay(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||rt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Pe("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=Ac(r,i),l=a.repoInfo,u;typeof process<"u"&&zl&&(u=zl[Iy]),u?(r=`http://${u}?ns=${l.namespace}`,a=Ac(r,i),l=a.repoInfo):a.repoInfo.secure;const h=new ag(n.name,n.options,e);ey("Invalid Firebase Database URL",a),z(a.path)||rt("Database URL must point to the root of a Firebase Database (not including a child path).");const f=Ry(l,n,h,new og(n,t));return new by(f,n)}function Sy(n,e){const t=co[e];(!t||t[n.key]!==n)&&rt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),hy(n),delete t[n.key]}function Ry(n,e,t,s){let i=co[e.name];i||(i={},co[e.name]=i);let r=i[n.toURLString()];return r&&rt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new oy(n,wy,t,s),i[n.toURLString()]=r,r}class by{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ay(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zt(this._repo,J())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Sy(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&rt("Cannot call "+e+" on a deleted database.")}}function Py(n=Gu(),e){const t=$u(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=ku("database");s&&Ny(t,...s)}return t}function Ny(n,e,t,s={}){n=xt(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&Es(s,r.repoInfo_.emulatorOptions))return;rt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&rt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new ci(ci.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:Ou(s.mockUserToken,n.app.options.projectId);a=new ci(l)}Ps(e)&&(xu(e),Mu("Database",!0)),Cy(r,i,s,a)}function Dy(n){zm(zu),vs(new _n("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Ay(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),vt(Wl,Gl,n),vt(Wl,Gl,"esm2020")}st.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};st.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Dy();var Rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var It,pd;(function(){var n;function e(T,g){function E(){}E.prototype=g.prototype,T.F=g.prototype,T.prototype=new E,T.prototype.constructor=T,T.D=function(I,v,C){for(var _=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)_[Me-2]=arguments[Me];return g.prototype[v].apply(I,_)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,E){E||(E=0);const I=Array(16);if(typeof g=="string")for(var v=0;v<16;++v)I[v]=g.charCodeAt(E++)|g.charCodeAt(E++)<<8|g.charCodeAt(E++)<<16|g.charCodeAt(E++)<<24;else for(v=0;v<16;++v)I[v]=g[E++]|g[E++]<<8|g[E++]<<16|g[E++]<<24;g=T.g[0],E=T.g[1],v=T.g[2];let C=T.g[3],_;_=g+(C^E&(v^C))+I[0]+3614090360&4294967295,g=E+(_<<7&4294967295|_>>>25),_=C+(v^g&(E^v))+I[1]+3905402710&4294967295,C=g+(_<<12&4294967295|_>>>20),_=v+(E^C&(g^E))+I[2]+606105819&4294967295,v=C+(_<<17&4294967295|_>>>15),_=E+(g^v&(C^g))+I[3]+3250441966&4294967295,E=v+(_<<22&4294967295|_>>>10),_=g+(C^E&(v^C))+I[4]+4118548399&4294967295,g=E+(_<<7&4294967295|_>>>25),_=C+(v^g&(E^v))+I[5]+1200080426&4294967295,C=g+(_<<12&4294967295|_>>>20),_=v+(E^C&(g^E))+I[6]+2821735955&4294967295,v=C+(_<<17&4294967295|_>>>15),_=E+(g^v&(C^g))+I[7]+4249261313&4294967295,E=v+(_<<22&4294967295|_>>>10),_=g+(C^E&(v^C))+I[8]+1770035416&4294967295,g=E+(_<<7&4294967295|_>>>25),_=C+(v^g&(E^v))+I[9]+2336552879&4294967295,C=g+(_<<12&4294967295|_>>>20),_=v+(E^C&(g^E))+I[10]+4294925233&4294967295,v=C+(_<<17&4294967295|_>>>15),_=E+(g^v&(C^g))+I[11]+2304563134&4294967295,E=v+(_<<22&4294967295|_>>>10),_=g+(C^E&(v^C))+I[12]+1804603682&4294967295,g=E+(_<<7&4294967295|_>>>25),_=C+(v^g&(E^v))+I[13]+4254626195&4294967295,C=g+(_<<12&4294967295|_>>>20),_=v+(E^C&(g^E))+I[14]+2792965006&4294967295,v=C+(_<<17&4294967295|_>>>15),_=E+(g^v&(C^g))+I[15]+1236535329&4294967295,E=v+(_<<22&4294967295|_>>>10),_=g+(v^C&(E^v))+I[1]+4129170786&4294967295,g=E+(_<<5&4294967295|_>>>27),_=C+(E^v&(g^E))+I[6]+3225465664&4294967295,C=g+(_<<9&4294967295|_>>>23),_=v+(g^E&(C^g))+I[11]+643717713&4294967295,v=C+(_<<14&4294967295|_>>>18),_=E+(C^g&(v^C))+I[0]+3921069994&4294967295,E=v+(_<<20&4294967295|_>>>12),_=g+(v^C&(E^v))+I[5]+3593408605&4294967295,g=E+(_<<5&4294967295|_>>>27),_=C+(E^v&(g^E))+I[10]+38016083&4294967295,C=g+(_<<9&4294967295|_>>>23),_=v+(g^E&(C^g))+I[15]+3634488961&4294967295,v=C+(_<<14&4294967295|_>>>18),_=E+(C^g&(v^C))+I[4]+3889429448&4294967295,E=v+(_<<20&4294967295|_>>>12),_=g+(v^C&(E^v))+I[9]+568446438&4294967295,g=E+(_<<5&4294967295|_>>>27),_=C+(E^v&(g^E))+I[14]+3275163606&4294967295,C=g+(_<<9&4294967295|_>>>23),_=v+(g^E&(C^g))+I[3]+4107603335&4294967295,v=C+(_<<14&4294967295|_>>>18),_=E+(C^g&(v^C))+I[8]+1163531501&4294967295,E=v+(_<<20&4294967295|_>>>12),_=g+(v^C&(E^v))+I[13]+2850285829&4294967295,g=E+(_<<5&4294967295|_>>>27),_=C+(E^v&(g^E))+I[2]+4243563512&4294967295,C=g+(_<<9&4294967295|_>>>23),_=v+(g^E&(C^g))+I[7]+1735328473&4294967295,v=C+(_<<14&4294967295|_>>>18),_=E+(C^g&(v^C))+I[12]+2368359562&4294967295,E=v+(_<<20&4294967295|_>>>12),_=g+(E^v^C)+I[5]+4294588738&4294967295,g=E+(_<<4&4294967295|_>>>28),_=C+(g^E^v)+I[8]+2272392833&4294967295,C=g+(_<<11&4294967295|_>>>21),_=v+(C^g^E)+I[11]+1839030562&4294967295,v=C+(_<<16&4294967295|_>>>16),_=E+(v^C^g)+I[14]+4259657740&4294967295,E=v+(_<<23&4294967295|_>>>9),_=g+(E^v^C)+I[1]+2763975236&4294967295,g=E+(_<<4&4294967295|_>>>28),_=C+(g^E^v)+I[4]+1272893353&4294967295,C=g+(_<<11&4294967295|_>>>21),_=v+(C^g^E)+I[7]+4139469664&4294967295,v=C+(_<<16&4294967295|_>>>16),_=E+(v^C^g)+I[10]+3200236656&4294967295,E=v+(_<<23&4294967295|_>>>9),_=g+(E^v^C)+I[13]+681279174&4294967295,g=E+(_<<4&4294967295|_>>>28),_=C+(g^E^v)+I[0]+3936430074&4294967295,C=g+(_<<11&4294967295|_>>>21),_=v+(C^g^E)+I[3]+3572445317&4294967295,v=C+(_<<16&4294967295|_>>>16),_=E+(v^C^g)+I[6]+76029189&4294967295,E=v+(_<<23&4294967295|_>>>9),_=g+(E^v^C)+I[9]+3654602809&4294967295,g=E+(_<<4&4294967295|_>>>28),_=C+(g^E^v)+I[12]+3873151461&4294967295,C=g+(_<<11&4294967295|_>>>21),_=v+(C^g^E)+I[15]+530742520&4294967295,v=C+(_<<16&4294967295|_>>>16),_=E+(v^C^g)+I[2]+3299628645&4294967295,E=v+(_<<23&4294967295|_>>>9),_=g+(v^(E|~C))+I[0]+4096336452&4294967295,g=E+(_<<6&4294967295|_>>>26),_=C+(E^(g|~v))+I[7]+1126891415&4294967295,C=g+(_<<10&4294967295|_>>>22),_=v+(g^(C|~E))+I[14]+2878612391&4294967295,v=C+(_<<15&4294967295|_>>>17),_=E+(C^(v|~g))+I[5]+4237533241&4294967295,E=v+(_<<21&4294967295|_>>>11),_=g+(v^(E|~C))+I[12]+1700485571&4294967295,g=E+(_<<6&4294967295|_>>>26),_=C+(E^(g|~v))+I[3]+2399980690&4294967295,C=g+(_<<10&4294967295|_>>>22),_=v+(g^(C|~E))+I[10]+4293915773&4294967295,v=C+(_<<15&4294967295|_>>>17),_=E+(C^(v|~g))+I[1]+2240044497&4294967295,E=v+(_<<21&4294967295|_>>>11),_=g+(v^(E|~C))+I[8]+1873313359&4294967295,g=E+(_<<6&4294967295|_>>>26),_=C+(E^(g|~v))+I[15]+4264355552&4294967295,C=g+(_<<10&4294967295|_>>>22),_=v+(g^(C|~E))+I[6]+2734768916&4294967295,v=C+(_<<15&4294967295|_>>>17),_=E+(C^(v|~g))+I[13]+1309151649&4294967295,E=v+(_<<21&4294967295|_>>>11),_=g+(v^(E|~C))+I[4]+4149444226&4294967295,g=E+(_<<6&4294967295|_>>>26),_=C+(E^(g|~v))+I[11]+3174756917&4294967295,C=g+(_<<10&4294967295|_>>>22),_=v+(g^(C|~E))+I[2]+718787259&4294967295,v=C+(_<<15&4294967295|_>>>17),_=E+(C^(v|~g))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(v+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+C&4294967295}s.prototype.v=function(T,g){g===void 0&&(g=T.length);const E=g-this.blockSize,I=this.C;let v=this.h,C=0;for(;C<g;){if(v==0)for(;C<=E;)i(this,T,C),C+=this.blockSize;if(typeof T=="string"){for(;C<g;)if(I[v++]=T.charCodeAt(C++),v==this.blockSize){i(this,I),v=0;break}}else for(;C<g;)if(I[v++]=T[C++],v==this.blockSize){i(this,I),v=0;break}}this.h=v,this.o+=g},s.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;g=this.o*8;for(var E=T.length-8;E<T.length;++E)T[E]=g&255,g/=256;for(this.v(T),T=Array(16),g=0,E=0;E<4;++E)for(let I=0;I<32;I+=8)T[g++]=this.g[E]>>>I&255;return T};function r(T,g){var E=l;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=g(T)}function a(T,g){this.h=g;const E=[];let I=!0;for(let v=T.length-1;v>=0;v--){const C=T[v]|0;I&&C==g||(E[v]=C,I=!1)}this.g=E}var l={};function u(T){return-128<=T&&T<128?r(T,function(g){return new a([g|0],g<0?-1:0)}):new a([T|0],T<0?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(T<0)return k(h(-T));const g=[];let E=1;for(let I=0;T>=E;I++)g[I]=T/E|0,E*=4294967296;return new a(g,0)}function f(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return k(f(T.substring(1),g));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=h(Math.pow(g,8));let I=m;for(let C=0;C<T.length;C+=8){var v=Math.min(8,T.length-C);const _=parseInt(T.substring(C,C+v),g);v<8?(v=h(Math.pow(g,v)),I=I.j(v).add(h(_))):(I=I.j(E),I=I.add(h(_)))}return I}var m=u(0),y=u(1),S=u(16777216);n=a.prototype,n.m=function(){if(x(this))return-k(this).m();let T=0,g=1;for(let E=0;E<this.g.length;E++){const I=this.i(E);T+=(I>=0?I:4294967296+I)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(x(this))return"-"+k(this).toString(T);const g=h(Math.pow(T,6));var E=this;let I="";for(;;){const v=Z(E,g).g;E=L(E,v.j(g));let C=((E.g.length>0?E.g[0]:E.h)>>>0).toString(T);if(E=v,b(E))return C+I;for(;C.length<6;)C="0"+C;I=C+I}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function b(T){if(T.h!=0)return!1;for(let g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=L(this,T),x(T)?-1:b(T)?0:1};function k(T){const g=T.g.length,E=[];for(let I=0;I<g;I++)E[I]=~T.g[I];return new a(E,~T.h).add(y)}n.abs=function(){return x(this)?k(this):this},n.add=function(T){const g=Math.max(this.g.length,T.g.length),E=[];let I=0;for(let v=0;v<=g;v++){let C=I+(this.i(v)&65535)+(T.i(v)&65535),_=(C>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);I=_>>>16,C&=65535,_&=65535,E[v]=_<<16|C}return new a(E,E[E.length-1]&-2147483648?-1:0)};function L(T,g){return T.add(k(g))}n.j=function(T){if(b(this)||b(T))return m;if(x(this))return x(T)?k(this).j(k(T)):k(k(this).j(T));if(x(T))return k(this.j(k(T)));if(this.l(S)<0&&T.l(S)<0)return h(this.m()*T.m());const g=this.g.length+T.g.length,E=[];for(var I=0;I<2*g;I++)E[I]=0;for(I=0;I<this.g.length;I++)for(let v=0;v<T.g.length;v++){const C=this.i(I)>>>16,_=this.i(I)&65535,Me=T.i(v)>>>16,Ot=T.i(v)&65535;E[2*I+2*v]+=_*Ot,q(E,2*I+2*v),E[2*I+2*v+1]+=C*Ot,q(E,2*I+2*v+1),E[2*I+2*v+1]+=_*Me,q(E,2*I+2*v+1),E[2*I+2*v+2]+=C*Me,q(E,2*I+2*v+2)}for(T=0;T<g;T++)E[T]=E[2*T+1]<<16|E[2*T];for(T=g;T<2*g;T++)E[T]=0;return new a(E,0)};function q(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function U(T,g){this.g=T,this.h=g}function Z(T,g){if(b(g))throw Error("division by zero");if(b(T))return new U(m,m);if(x(T))return g=Z(k(T),g),new U(k(g.g),k(g.h));if(x(g))return g=Z(T,k(g)),new U(k(g.g),g.h);if(T.g.length>30){if(x(T)||x(g))throw Error("slowDivide_ only works with positive integers.");for(var E=y,I=g;I.l(T)<=0;)E=he(E),I=he(I);var v=oe(E,1),C=oe(I,1);for(I=oe(I,2),E=oe(E,2);!b(I);){var _=C.add(I);_.l(T)<=0&&(v=v.add(E),C=_),I=oe(I,1),E=oe(E,1)}return g=L(T,v.j(g)),new U(v,g)}for(v=m;T.l(g)>=0;){for(E=Math.max(1,Math.floor(T.m()/g.m())),I=Math.ceil(Math.log(E)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),C=h(E),_=C.j(g);x(_)||_.l(T)>0;)E-=I,C=h(E),_=C.j(g);b(C)&&(C=y),v=v.add(C),T=L(T,_)}return new U(v,T)}n.B=function(T){return Z(this,T).h},n.and=function(T){const g=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<g;I++)E[I]=this.i(I)&T.i(I);return new a(E,this.h&T.h)},n.or=function(T){const g=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<g;I++)E[I]=this.i(I)|T.i(I);return new a(E,this.h|T.h)},n.xor=function(T){const g=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<g;I++)E[I]=this.i(I)^T.i(I);return new a(E,this.h^T.h)};function he(T){const g=T.g.length+1,E=[];for(let I=0;I<g;I++)E[I]=T.i(I)<<1|T.i(I-1)>>>31;return new a(E,T.h)}function oe(T,g){const E=g>>5;g%=32;const I=T.g.length-E,v=[];for(let C=0;C<I;C++)v[C]=g>0?T.i(C+E)>>>g|T.i(C+E+1)<<32-g:T.i(C+E);return new a(v,T.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,pd=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,It=a}).apply(typeof Rc<"u"?Rc:typeof self<"u"?self:typeof window<"u"?window:{});var ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var md,is,gd,hi,uo,_d,yd,Ed;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ni=="object"&&ni];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function i(o,c){if(c)e:{var d=s;o=o.split(".");for(var p=0;p<o.length-1;p++){var w=o[p];if(!(w in d))break e;d=d[w]}o=o[o.length-1],p=d[o],c=c(p),c!=p&&c!=null&&e(d,o,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(o){return o||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});var r=r||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,d){return o.call.apply(o.bind,arguments)}function h(o,c,d){return h=u,h.apply(null,arguments)}function f(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,c){function d(){}d.prototype=c.prototype,o.Z=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(p,w,A){for(var N=Array(arguments.length-2),j=2;j<arguments.length;j++)N[j-2]=arguments[j];return c.prototype[w].apply(p,N)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function S(o){const c=o.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=o[p];return d}return[]}function b(o,c){for(let p=1;p<arguments.length;p++){const w=arguments[p];var d=typeof w;if(d=d!="object"?d:w?Array.isArray(w)?"array":d:"null",d=="array"||d=="object"&&typeof w.length=="number"){d=o.length||0;const A=w.length||0;o.length=d+A;for(let N=0;N<A;N++)o[d+N]=w[N]}else o.push(w)}}class x{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function k(o){a.setTimeout(()=>{throw o},0)}function L(){var o=T;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class q{constructor(){this.h=this.g=null}add(c,d){const p=U.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var U=new x(()=>new Z,o=>o.reset());class Z{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let he,oe=!1,T=new q,g=()=>{const o=Promise.resolve(void 0);he=()=>{o.then(E)}};function E(){for(var o;o=L();){try{o.h.call(o.g)}catch(d){k(d)}var c=U;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}oe=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var C=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function Me(o,c){v.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}m(Me,v),Me.prototype.init=function(o,c){const d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(d=="mouseover"?c=o.fromElement:d=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Me.Z.h.call(this)},Me.prototype.h=function(){Me.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ot="closure_listenable_"+(Math.random()*1e6|0),Df=0;function kf(o,c,d,p,w){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=w,this.key=++Df,this.da=this.fa=!1}function Us(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Bs(o,c,d){for(const p in o)c.call(d,o[p],p,o)}function Vf(o,c){for(const d in o)c.call(void 0,o[d],d,o)}function ka(o){const c={};for(const d in o)c[d]=o[d];return c}const Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xa(o,c){let d,p;for(let w=1;w<arguments.length;w++){p=arguments[w];for(d in p)o[d]=p[d];for(let A=0;A<Va.length;A++)d=Va[A],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function qs(o){this.src=o,this.g={},this.h=0}qs.prototype.add=function(o,c,d,p,w){const A=o.toString();o=this.g[A],o||(o=this.g[A]=[],this.h++);const N=ir(o,c,p,w);return N>-1?(c=o[N],d||(c.fa=!1)):(c=new kf(c,this.src,A,!!p,w),c.fa=d,o.push(c)),c};function sr(o,c){const d=c.type;if(d in o.g){var p=o.g[d],w=Array.prototype.indexOf.call(p,c,void 0),A;(A=w>=0)&&Array.prototype.splice.call(p,w,1),A&&(Us(c),o.g[d].length==0&&(delete o.g[d],o.h--))}}function ir(o,c,d,p){for(let w=0;w<o.length;++w){const A=o[w];if(!A.da&&A.listener==c&&A.capture==!!d&&A.ha==p)return w}return-1}var rr="closure_lm_"+(Math.random()*1e6|0),or={};function Oa(o,c,d,p,w){if(Array.isArray(c)){for(let A=0;A<c.length;A++)Oa(o,c[A],d,p,w);return null}return d=Fa(d),o&&o[Ot]?o.J(c,d,l(p)?!!p.capture:!1,w):xf(o,c,d,!1,p,w)}function xf(o,c,d,p,w,A){if(!c)throw Error("Invalid event type");const N=l(w)?!!w.capture:!!w;let j=lr(o);if(j||(o[rr]=j=new qs(o)),d=j.add(c,d,p,N,A),d.proxy)return d;if(p=Of(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)C||(w=N),w===void 0&&(w=!1),o.addEventListener(c.toString(),p,w);else if(o.attachEvent)o.attachEvent(La(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Of(){function o(d){return c.call(o.src,o.listener,d)}const c=Mf;return o}function Ma(o,c,d,p,w){if(Array.isArray(c))for(var A=0;A<c.length;A++)Ma(o,c[A],d,p,w);else p=l(p)?!!p.capture:!!p,d=Fa(d),o&&o[Ot]?(o=o.i,A=String(c).toString(),A in o.g&&(c=o.g[A],d=ir(c,d,p,w),d>-1&&(Us(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete o.g[A],o.h--)))):o&&(o=lr(o))&&(c=o.g[c.toString()],o=-1,c&&(o=ir(c,d,p,w)),(d=o>-1?c[o]:null)&&ar(d))}function ar(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Ot])sr(c.i,o);else{var d=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(d,p,o.capture):c.detachEvent?c.detachEvent(La(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=lr(c))?(sr(d,o),d.h==0&&(d.src=null,c[rr]=null)):Us(o)}}}function La(o){return o in or?or[o]:or[o]="on"+o}function Mf(o,c){if(o.da)o=!0;else{c=new Me(c,this);const d=o.listener,p=o.ha||o.src;o.fa&&ar(o),o=d.call(p,c)}return o}function lr(o){return o=o[rr],o instanceof qs?o:null}var cr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Fa(o){return typeof o=="function"?o:(o[cr]||(o[cr]=function(c){return o.handleEvent(c)}),o[cr])}function Se(){I.call(this),this.i=new qs(this),this.M=this,this.G=null}m(Se,I),Se.prototype[Ot]=!0,Se.prototype.removeEventListener=function(o,c,d,p){Ma(this,o,c,d,p)};function Ve(o,c){var d,p=o.G;if(p)for(d=[];p;p=p.G)d.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new v(c,o);else if(c instanceof v)c.target=c.target||o;else{var w=c;c=new v(p,o),xa(c,w)}w=!0;let A,N;if(d)for(N=d.length-1;N>=0;N--)A=c.g=d[N],w=js(A,p,!0,c)&&w;if(A=c.g=o,w=js(A,p,!0,c)&&w,w=js(A,p,!1,c)&&w,d)for(N=0;N<d.length;N++)A=c.g=d[N],w=js(A,p,!1,c)&&w}Se.prototype.N=function(){if(Se.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const d=o.g[c];for(let p=0;p<d.length;p++)Us(d[p]);delete o.g[c],o.h--}}this.G=null},Se.prototype.J=function(o,c,d,p){return this.i.add(String(o),c,!1,d,p)},Se.prototype.K=function(o,c,d,p){return this.i.add(String(o),c,!0,d,p)};function js(o,c,d,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let A=0;A<c.length;++A){const N=c[A];if(N&&!N.da&&N.capture==d){const j=N.listener,me=N.ha||N.src;N.fa&&sr(o.i,N),w=j.call(me,p)!==!1&&w}}return w&&!p.defaultPrevented}function Lf(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Ua(o){o.g=Lf(()=>{o.g=null,o.i&&(o.i=!1,Ua(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class Ff extends I{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ua(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(o){I.call(this),this.h=o,this.g={}}m(Ln,I);var Ba=[];function qa(o){Bs(o.g,function(c,d){this.g.hasOwnProperty(d)&&ar(c)},o),o.g={}}Ln.prototype.N=function(){Ln.Z.N.call(this),qa(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ur=a.JSON.stringify,Uf=a.JSON.parse,Bf=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function ja(){}function $a(){}var Fn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function hr(){v.call(this,"d")}m(hr,v);function dr(){v.call(this,"c")}m(dr,v);var Mt={},Ha=null;function $s(){return Ha=Ha||new Se}Mt.Ia="serverreachability";function za(o){v.call(this,Mt.Ia,o)}m(za,v);function Un(o){const c=$s();Ve(c,new za(c))}Mt.STAT_EVENT="statevent";function Wa(o,c){v.call(this,Mt.STAT_EVENT,o),this.stat=c}m(Wa,v);function xe(o){const c=$s();Ve(c,new Wa(c,o))}Mt.Ja="timingevent";function Ga(o,c){v.call(this,Mt.Ja,o),this.size=c}m(Ga,v);function Bn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function qn(){this.g=!0}qn.prototype.ua=function(){this.g=!1};function qf(o,c,d,p,w,A){o.info(function(){if(o.g)if(A){var N="",j=A.split("&");for(let ee=0;ee<j.length;ee++){var me=j[ee].split("=");if(me.length>1){const Ee=me[0];me=me[1];const Ge=Ee.split("_");N=Ge.length>=2&&Ge[1]=="type"?N+(Ee+"="+me+"&"):N+(Ee+"=redacted&")}}}else N=null;else N=A;return"XMLHTTP REQ ("+p+") [attempt "+w+"]: "+c+`
`+d+`
`+N})}function jf(o,c,d,p,w,A,N){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+w+"]: "+c+`
`+d+`
`+A+" "+N})}function tn(o,c,d,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Hf(o,d)+(p?" "+p:"")})}function $f(o,c){o.info(function(){return"TIMEOUT: "+c})}qn.prototype.info=function(){};function Hf(o,c){if(!o.g)return c;if(!c)return null;try{const A=JSON.parse(c);if(A){for(o=0;o<A.length;o++)if(Array.isArray(A[o])){var d=A[o];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var w=p[0];if(w!="noop"&&w!="stop"&&w!="close")for(let N=1;N<p.length;N++)p[N]=""}}}}return ur(A)}catch{return c}}var Hs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ka={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Qa;function fr(){}m(fr,ja),fr.prototype.g=function(){return new XMLHttpRequest},Qa=new fr;function jn(o){return encodeURIComponent(String(o))}function zf(o){var c=1;o=o.split(":");const d=[];for(;c>0&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function ut(o,c,d,p){this.j=o,this.i=c,this.l=d,this.S=p||1,this.V=new Ln(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ya}function Ya(){this.i=null,this.g="",this.h=!1}var Xa={},pr={};function mr(o,c,d){o.M=1,o.A=Ws(We(c)),o.u=d,o.R=!0,Ja(o,null)}function Ja(o,c){o.F=Date.now(),zs(o),o.B=We(o.A);var d=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),hl(d.i,"t",p),o.C=0,d=o.j.L,o.h=new Ya,o.g=Pl(o.j,d?c:null,!o.u),o.P>0&&(o.O=new Ff(h(o.Y,o,o.g),o.P)),c=o.V,d=o.g,p=o.ba;var w="readystatechange";Array.isArray(w)||(w&&(Ba[0]=w.toString()),w=Ba);for(let A=0;A<w.length;A++){const N=Oa(d,w[A],p||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.J?ka(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Un(),qf(o.i,o.v,o.B,o.l,o.S,o.u)}ut.prototype.ba=function(o){o=o.target;const c=this.O;c&&ft(o)==3?c.j():this.Y(o)},ut.prototype.Y=function(o){try{if(o==this.g)e:{const j=ft(this.g),me=this.g.ya(),ee=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||yl(this.g)))){this.K||j!=4||me==7||(me==8||ee<=0?Un(3):Un(2)),gr(this);var c=this.g.ca();this.X=c;var d=Wf(this);if(this.o=c==200,jf(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,w=this.g;if((p=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(p)){var A=p;break t}}A=null}if(o=A)tn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,_r(this,o);else{this.o=!1,this.m=3,xe(12),Lt(this),$n(this);break e}}if(this.R){o=!0;let Ee;for(;!this.K&&this.C<d.length;)if(Ee=Gf(this,d),Ee==pr){j==4&&(this.m=4,xe(14),o=!1),tn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ee==Xa){this.m=4,xe(15),tn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else tn(this.i,this.l,Ee,null),_r(this,Ee);if(Za(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||d.length!=0||this.h.h||(this.m=1,xe(16),o=!1),this.o=this.o&&o,!o)tn(this.i,this.l,d,"[Invalid Chunked Response]"),Lt(this),$n(this);else if(d.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Ar(N),N.P=!0,xe(11))}}else tn(this.i,this.l,d,null),_r(this,d);j==4&&Lt(this),this.o&&!this.K&&(j==4?Al(this.j,this):(this.o=!1,zs(this)))}else ap(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,xe(12)):(this.m=0,xe(13)),Lt(this),$n(this)}}}catch{}finally{}};function Wf(o){if(!Za(o))return o.g.la();const c=yl(o.g);if(c==="")return"";let d="";const p=c.length,w=ft(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Lt(o),$n(o),"";o.h.i=new a.TextDecoder}for(let A=0;A<p;A++)o.h.h=!0,d+=o.h.i.decode(c[A],{stream:!(w&&A==p-1)});return c.length=0,o.h.g+=d,o.C=0,o.h.g}function Za(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Gf(o,c){var d=o.C,p=c.indexOf(`
`,d);return p==-1?pr:(d=Number(c.substring(d,p)),isNaN(d)?Xa:(p+=1,p+d>c.length?pr:(c=c.slice(p,p+d),o.C=p+d,c)))}ut.prototype.cancel=function(){this.K=!0,Lt(this)};function zs(o){o.T=Date.now()+o.H,el(o,o.H)}function el(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Bn(h(o.aa,o),c)}function gr(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ut.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?($f(this.i,this.B),this.M!=2&&(Un(),xe(17)),Lt(this),this.m=2,$n(this)):el(this,this.T-o)};function $n(o){o.j.I==0||o.K||Al(o.j,o)}function Lt(o){gr(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,qa(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function _r(o,c){try{var d=o.j;if(d.I!=0&&(d.g==o||yr(d.h,o))){if(!o.L&&yr(d.h,o)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var w=p;if(w[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)Xs(d),Qs(d);else break e;Cr(d),xe(18)}}else d.xa=w[1],0<d.xa-d.K&&w[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=Bn(h(d.Va,d),6e3));sl(d.h)<=1&&d.ta&&(d.ta=void 0)}else Ut(d,11)}else if((o.L||d.g==o)&&Xs(d),!_(c))for(w=d.Ba.g.parse(c),c=0;c<w.length;c++){let ee=w[c];const Ee=ee[0];if(!(Ee<=d.K))if(d.K=Ee,ee=ee[1],d.I==2)if(ee[0]=="c"){d.M=ee[1],d.ba=ee[2];const Ge=ee[3];Ge!=null&&(d.ka=Ge,d.j.info("VER="+d.ka));const Bt=ee[4];Bt!=null&&(d.za=Bt,d.j.info("SVER="+d.za));const pt=ee[5];pt!=null&&typeof pt=="number"&&pt>0&&(p=1.5*pt,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const mt=o.g;if(mt){const Zs=mt.g?mt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Zs){var A=p.h;A.g||Zs.indexOf("spdy")==-1&&Zs.indexOf("quic")==-1&&Zs.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(Er(A,A.h),A.h=null))}if(p.G){const Sr=mt.g?mt.g.getResponseHeader("X-HTTP-Session-Id"):null;Sr&&(p.wa=Sr,te(p.J,p.G,Sr))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var N=o;if(p.na=bl(p,p.L?p.ba:null,p.W),N.L){il(p.h,N);var j=N,me=p.O;me&&(j.H=me),j.D&&(gr(j),zs(j)),p.g=N}else wl(p);d.i.length>0&&Ys(d)}else ee[0]!="stop"&&ee[0]!="close"||Ut(d,7);else d.I==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?Ut(d,7):wr(d):ee[0]!="noop"&&d.l&&d.l.qa(ee),d.A=0)}}Un(4)}catch{}}var Kf=class{constructor(o,c){this.g=o,this.map=c}};function tl(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function nl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function sl(o){return o.h?1:o.g?o.g.size:0}function yr(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Er(o,c){o.g?o.g.add(c):o.h=c}function il(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}tl.prototype.cancel=function(){if(this.i=rl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function rl(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const d of o.g.values())c=c.concat(d.G);return c}return S(o.i)}var ol=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qf(o,c){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const p=o[d].indexOf("=");let w,A=null;p>=0?(w=o[d].substring(0,p),A=o[d].substring(p+1)):w=o[d],c(w,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function ht(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof ht?(this.l=o.l,Hn(this,o.j),this.o=o.o,this.g=o.g,zn(this,o.u),this.h=o.h,vr(this,dl(o.i)),this.m=o.m):o&&(c=String(o).match(ol))?(this.l=!1,Hn(this,c[1]||"",!0),this.o=Wn(c[2]||""),this.g=Wn(c[3]||"",!0),zn(this,c[4]),this.h=Wn(c[5]||"",!0),vr(this,c[6]||"",!0),this.m=Wn(c[7]||"")):(this.l=!1,this.i=new Kn(null,this.l))}ht.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Gn(c,al,!0),":");var d=this.g;return(d||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Gn(c,al,!0),"@"),o.push(jn(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Gn(d,d.charAt(0)=="/"?Jf:Xf,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Gn(d,ep)),o.join("")},ht.prototype.resolve=function(o){const c=We(this);let d=!!o.j;d?Hn(c,o.j):d=!!o.o,d?c.o=o.o:d=!!o.g,d?c.g=o.g:d=o.u!=null;var p=o.h;if(d)zn(c,o.u);else if(d=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var w=c.h.lastIndexOf("/");w!=-1&&(p=c.h.slice(0,w+1)+p)}if(w=p,w==".."||w==".")p="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){p=w.lastIndexOf("/",0)==0,w=w.split("/");const A=[];for(let N=0;N<w.length;){const j=w[N++];j=="."?p&&N==w.length&&A.push(""):j==".."?((A.length>1||A.length==1&&A[0]!="")&&A.pop(),p&&N==w.length&&A.push("")):(A.push(j),p=!0)}p=A.join("/")}else p=w}return d?c.h=p:d=o.i.toString()!=="",d?vr(c,dl(o.i)):d=!!o.m,d&&(c.m=o.m),c};function We(o){return new ht(o)}function Hn(o,c,d){o.j=d?Wn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function zn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function vr(o,c,d){c instanceof Kn?(o.i=c,tp(o.i,o.l)):(d||(c=Gn(c,Zf)),o.i=new Kn(c,o.l))}function te(o,c,d){o.i.set(c,d)}function Ws(o){return te(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Wn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Gn(o,c,d){return typeof o=="string"?(o=encodeURI(o).replace(c,Yf),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Yf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var al=/[#\/\?@]/g,Xf=/[#\?:]/g,Jf=/[#\?]/g,Zf=/[#\?@]/g,ep=/#/g;function Kn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ft(o){o.g||(o.g=new Map,o.h=0,o.i&&Qf(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=Kn.prototype,n.add=function(o,c){Ft(this),this.i=null,o=nn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this};function ll(o,c){Ft(o),c=nn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function cl(o,c){return Ft(o),c=nn(o,c),o.g.has(c)}n.forEach=function(o,c){Ft(this),this.g.forEach(function(d,p){d.forEach(function(w){o.call(c,w,p,this)},this)},this)};function ul(o,c){Ft(o);let d=[];if(typeof c=="string")cl(o,c)&&(d=d.concat(o.g.get(nn(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)d=d.concat(o[c]);return d}n.set=function(o,c){return Ft(this),this.i=null,o=nn(this,o),cl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=ul(this,o),o.length>0?String(o[0]):c):c};function hl(o,c,d){ll(o,c),d.length>0&&(o.i=null,o.g.set(nn(o,c),S(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const w=jn(d);d=ul(this,d);for(let A=0;A<d.length;A++){let N=w;d[A]!==""&&(N+="="+jn(d[A])),o.push(N)}}return this.i=o.join("&")};function dl(o){const c=new Kn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function nn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function tp(o,c){c&&!o.j&&(Ft(o),o.i=null,o.g.forEach(function(d,p){const w=p.toLowerCase();p!=w&&(ll(this,p),hl(this,w,d))},o)),o.j=c}function np(o,c){const d=new qn;if(a.Image){const p=new Image;p.onload=f(dt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=f(dt,d,"TestLoadImage: error",!1,c,p),p.onabort=f(dt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(dt,d,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function sp(o,c){const d=new qn,p=new AbortController,w=setTimeout(()=>{p.abort(),dt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(A=>{clearTimeout(w),A.ok?dt(d,"TestPingServer: ok",!0,c):dt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),dt(d,"TestPingServer: error",!1,c)})}function dt(o,c,d,p,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),p(d)}catch{}}function ip(){this.g=new Bf}function Tr(o){this.i=o.Sb||null,this.h=o.ab||!1}m(Tr,ja),Tr.prototype.g=function(){return new Gs(this.i,this.h)};function Gs(o,c){Se.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Gs,Se),n=Gs.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Yn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Qn(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Yn(this)),this.g&&(this.readyState=3,Yn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;fl(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function fl(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Qn(this):Yn(this),this.readyState==3&&fl(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Qn(this))},n.Na=function(o){this.g&&(this.response=o,Qn(this))},n.ga=function(){this.g&&Qn(this)};function Qn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Yn(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=c.next();return o.join(`\r
`)};function Yn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Gs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function pl(o){let c="";return Bs(o,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function Ir(o,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=pl(d),typeof o=="string"?d!=null&&jn(d):te(o,c,d))}function le(o){Se.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(le,Se);var rp=/^https?$/i,op=["POST","PUT"];n=le.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Qa.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(A){ml(this,A);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var w in p)d.set(w,p[w]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const A of p.keys())d.set(A,p.get(A));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(A=>A.toLowerCase()=="content-type"),w=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(op,c,void 0)>=0)||p||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[A,N]of d)this.g.setRequestHeader(A,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(A){ml(this,A)}};function ml(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,gl(o),Ks(o)}function gl(o){o.A||(o.A=!0,Ve(o,"complete"),Ve(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Ve(this,"complete"),Ve(this,"abort"),Ks(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ks(this,!0)),le.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?_l(this):this.Xa())},n.Xa=function(){_l(this)};function _l(o){if(o.h&&typeof r<"u"){if(o.v&&ft(o)==4)setTimeout(o.Ca.bind(o),0);else if(Ve(o,"readystatechange"),ft(o)==4){o.h=!1;try{const A=o.ca();e:switch(A){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=A===0){let N=String(o.D).match(ol)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),p=!rp.test(N?N.toLowerCase():"")}d=p}if(d)Ve(o,"complete"),Ve(o,"success");else{o.o=6;try{var w=ft(o)>2?o.g.statusText:""}catch{w=""}o.l=w+" ["+o.ca()+"]",gl(o)}}finally{Ks(o)}}}}function Ks(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,c||Ve(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ft(o){return o.g?o.g.readyState:0}n.ca=function(){try{return ft(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Uf(c)}};function yl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ap(o){const c={};o=(o.g&&ft(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(_(o[p]))continue;var d=zf(o[p]);const w=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const A=c[w]||[];c[w]=A,A.push(d)}Vf(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xn(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function El(o){this.za=0,this.i=[],this.j=new qn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xn("baseRetryDelayMs",5e3,o),this.Za=Xn("retryDelaySeedMs",1e4,o),this.Ta=Xn("forwardChannelMaxRetries",2,o),this.va=Xn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new tl(o&&o.concurrentRequestLimit),this.Ba=new ip,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=El.prototype,n.ka=8,n.I=1,n.connect=function(o,c,d,p){xe(0),this.W=o,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=bl(this,null,this.W),Ys(this)};function wr(o){if(vl(o),o.I==3){var c=o.V++,d=We(o.J);if(te(d,"SID",o.M),te(d,"RID",c),te(d,"TYPE","terminate"),Jn(o,d),c=new ut(o,o.j,c),c.M=2,c.A=Ws(We(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=c.A,d=!0),d||(c.g=Pl(c.j,null),c.g.ea(c.A)),c.F=Date.now(),zs(c)}Rl(o)}function Qs(o){o.g&&(Ar(o),o.g.cancel(),o.g=null)}function vl(o){Qs(o),o.v&&(a.clearTimeout(o.v),o.v=null),Xs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function Ys(o){if(!nl(o.h)&&!o.m){o.m=!0;var c=o.Ea;he||g(),oe||(he(),oe=!0),T.add(c,o),o.D=0}}function lp(o,c){return sl(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Bn(h(o.Ea,o,c),Sl(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const w=new ut(this,this.j,o);let A=this.o;if(this.U&&(A?(A=ka(A),xa(A,this.U)):A=this.U),this.u!==null||this.R||(w.J=A,A=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=Il(this,w,c),d=We(this.J),te(d,"RID",o),te(d,"CVER",22),this.G&&te(d,"X-HTTP-Session-Id",this.G),Jn(this,d),A&&(this.R?c="headers="+jn(pl(A))+"&"+c:this.u&&Ir(d,this.u,A)),Er(this.h,w),this.Ra&&te(d,"TYPE","init"),this.S?(te(d,"$req",c),te(d,"SID","null"),w.U=!0,mr(w,d,null)):mr(w,d,c),this.I=2}}else this.I==3&&(o?Tl(this,o):this.i.length==0||nl(this.h)||Tl(this))};function Tl(o,c){var d;c?d=c.l:d=o.V++;const p=We(o.J);te(p,"SID",o.M),te(p,"RID",d),te(p,"AID",o.K),Jn(o,p),o.u&&o.o&&Ir(p,o.u,o.o),d=new ut(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),c&&(o.i=c.G.concat(o.i)),c=Il(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Er(o.h,d),mr(d,p,c)}function Jn(o,c){o.H&&Bs(o.H,function(d,p){te(c,p,d)}),o.l&&Bs({},function(d,p){te(c,p,d)})}function Il(o,c,d){d=Math.min(o.i.length,d);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var w=o.i;let j=-1;for(;;){const me=["count="+d];j==-1?d>0?(j=w[0].g,me.push("ofs="+j)):j=0:me.push("ofs="+j);let ee=!0;for(let Ee=0;Ee<d;Ee++){var A=w[Ee].g;const Ge=w[Ee].map;if(A-=j,A<0)j=Math.max(0,w[Ee].g-100),ee=!1;else try{A="req"+A+"_"||"";try{var N=Ge instanceof Map?Ge:Object.entries(Ge);for(const[Bt,pt]of N){let mt=pt;l(pt)&&(mt=ur(pt)),me.push(A+Bt+"="+encodeURIComponent(mt))}}catch(Bt){throw me.push(A+"type="+encodeURIComponent("_badmap")),Bt}}catch{p&&p(Ge)}}if(ee){N=me.join("&");break e}}N=void 0}return o=o.i.splice(0,d),c.G=o,N}function wl(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;he||g(),oe||(he(),oe=!0),T.add(c,o),o.A=0}}function Cr(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Bn(h(o.Da,o),Sl(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Cl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Bn(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,xe(10),Qs(this),Cl(this))};function Ar(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Cl(o){o.g=new ut(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=We(o.na);te(c,"RID","rpc"),te(c,"SID",o.M),te(c,"AID",o.K),te(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&te(c,"TO",o.ia),te(c,"TYPE","xmlhttp"),Jn(o,c),o.u&&o.o&&Ir(c,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=Ws(We(c)),d.u=null,d.R=!0,Ja(d,o)}n.Va=function(){this.C!=null&&(this.C=null,Qs(this),Cr(this),xe(19))};function Xs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function Al(o,c){var d=null;if(o.g==c){Xs(o),Ar(o),o.g=null;var p=2}else if(yr(o.h,c))d=c.G,il(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var w=o.D;p=$s(),Ve(p,new Ga(p,d)),Ys(o)}else wl(o);else if(w=c.m,w==3||w==0&&c.X>0||!(p==1&&lp(o,c)||p==2&&Cr(o)))switch(d&&d.length>0&&(c=o.h,c.i=c.i.concat(d)),w){case 1:Ut(o,5);break;case 4:Ut(o,10);break;case 3:Ut(o,6);break;default:Ut(o,2)}}}function Sl(o,c){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*c}function Ut(o,c){if(o.j.info("Error code "+c),c==2){var d=h(o.bb,o),p=o.Ua;const w=!p;p=new ht(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Hn(p,"https"),Ws(p),w?np(p.toString(),d):sp(p.toString(),d)}else xe(2);o.I=0,o.l&&o.l.pa(c),Rl(o),vl(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))};function Rl(o){if(o.I=0,o.ja=[],o.l){const c=rl(o.h);(c.length!=0||o.i.length!=0)&&(b(o.ja,c),b(o.ja,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.oa()}}function bl(o,c,d){var p=d instanceof ht?We(d):new ht(d);if(p.g!="")c&&(p.g=c+"."+p.g),zn(p,p.u);else{var w=a.location;p=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const A=new ht(null);p&&Hn(A,p),c&&(A.g=c),w&&zn(A,w),d&&(A.h=d),p=A}return d=o.G,c=o.wa,d&&c&&te(p,d,c),te(p,"VER",o.ka),Jn(o,p),p}function Pl(o,c,d){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new le(new Tr({ab:d})):new le(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Nl(){}n=Nl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Js(){}Js.prototype.g=function(o,c){return new Ue(o,c)};function Ue(o,c){Se.call(this),this.g=new El(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new sn(this)}m(Ue,Se),Ue.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ue.prototype.close=function(){wr(this.g)},Ue.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=ur(o),o=d);c.i.push(new Kf(c.Ya++,o)),c.I==3&&Ys(c)},Ue.prototype.N=function(){this.g.l=null,delete this.j,wr(this.g),delete this.g,Ue.Z.N.call(this)};function Dl(o){hr.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const d in c){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}m(Dl,hr);function kl(){dr.call(this),this.status=1}m(kl,dr);function sn(o){this.g=o}m(sn,Nl),sn.prototype.ra=function(){Ve(this.g,"a")},sn.prototype.qa=function(o){Ve(this.g,new Dl(o))},sn.prototype.pa=function(o){Ve(this.g,new kl)},sn.prototype.oa=function(){Ve(this.g,"b")},Js.prototype.createWebChannel=Js.prototype.g,Ue.prototype.send=Ue.prototype.o,Ue.prototype.open=Ue.prototype.m,Ue.prototype.close=Ue.prototype.close,Ed=function(){return new Js},yd=function(){return $s()},_d=Mt,uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Hs.NO_ERROR=0,Hs.TIMEOUT=8,Hs.HTTP_ERROR=6,hi=Hs,Ka.COMPLETE="complete",gd=Ka,$a.EventType=Fn,Fn.OPEN="a",Fn.CLOSE="b",Fn.ERROR="c",Fn.MESSAGE="d",Se.prototype.listen=Se.prototype.J,is=$a,le.prototype.listenOnce=le.prototype.K,le.prototype.getLastError=le.prototype.Ha,le.prototype.getLastErrorCode=le.prototype.ya,le.prototype.getStatus=le.prototype.ca,le.prototype.getResponseJson=le.prototype.La,le.prototype.getResponseText=le.prototype.la,le.prototype.send=le.prototype.ea,le.prototype.setWithCredentials=le.prototype.Fa,md=le}).apply(typeof ni<"u"?ni:typeof self<"u"?self:typeof window<"u"?window:{});const bc="@firebase/firestore",Pc="4.9.2";class be{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}be.UNAUTHENTICATED=new be(null),be.GOOGLE_CREDENTIALS=new be("google-credentials-uid"),be.FIRST_PARTY=new be("first-party-uid"),be.MOCK_USER=new be("mock-user");let kn="12.3.0";const Xt=new Oo("@firebase/firestore");function on(){return Xt.logLevel}function V(n,...e){if(Xt.logLevel<=H.DEBUG){const t=e.map(aa);Xt.debug(`Firestore (${kn}): ${n}`,...t)}}function at(n,...e){if(Xt.logLevel<=H.ERROR){const t=e.map(aa);Xt.error(`Firestore (${kn}): ${n}`,...t)}}function vn(n,...e){if(Xt.logLevel<=H.WARN){const t=e.map(aa);Xt.warn(`Firestore (${kn}): ${n}`,...t)}}function aa(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function B(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,vd(n,s,t)}function vd(n,e,t){let s=`FIRESTORE (${kn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw at(s),new Error(s)}function ae(n,e,t,s){let i="Unexpected state";typeof t=="string"?i=t:s=t,n||vd(e,i,s)}function Q(n,e){return n}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends bn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class wt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Td{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ky{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(be.UNAUTHENTICATED)))}shutdown(){}}class Vy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class xy{constructor(e){this.t=e,this.currentUser=be.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ae(this.o===void 0,42304);let s=this.i;const i=u=>this.i!==s?(s=this.i,t(u)):Promise.resolve();let r=new wt;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new wt,e.enqueueRetryable((()=>i(this.currentUser)))};const a=()=>{const u=r;e.enqueueRetryable((async()=>{await u.promise,await i(this.currentUser)}))},l=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new wt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ae(typeof s.accessToken=="string",31837,{l:s}),new Td(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ae(e===null||typeof e=="string",2055,{h:e}),new be(e)}}class Oy{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=be.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class My{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new Oy(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(be.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Nc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ly{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Hu(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ae(this.o===void 0,3512);const s=r=>{r.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const a=r.token!==this.m;return this.m=r.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable((()=>s(r)))};const i=r=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>i(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Nc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ae(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Nc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Fy(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class la{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=Fy(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<t&&(s+=e.charAt(i[r]%62))}return s}}function W(n,e){return n<e?-1:n>e?1:0}function ho(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const i=n.charAt(s),r=e.charAt(s);if(i!==r)return Fr(i)===Fr(r)?W(i,r):Fr(i)?1:-1}return W(n.length,e.length)}const Uy=55296,By=57343;function Fr(n){const e=n.charCodeAt(0);return e>=Uy&&e<=By}function Tn(n,e,t){return n.length===e.length&&n.every(((s,i)=>t(s,e[i])))}const Dc="__name__";class Ke{constructor(e,t,s){t===void 0?t=0:t>e.length&&B(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&B(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Ke.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ke?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let i=0;i<s;i++){const r=Ke.compareSegments(e.get(i),t.get(i));if(r!==0)return r}return W(e.length,t.length)}static compareSegments(e,t){const s=Ke.isNumericId(e),i=Ke.isNumericId(t);return s&&!i?-1:!s&&i?1:s&&i?Ke.extractNumericId(e).compare(Ke.extractNumericId(t)):ho(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return It.fromString(e.substring(4,e.length-2))}}class ie extends Ke{construct(e,t,s){return new ie(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((i=>i.length>0)))}return new ie(t)}static emptyPath(){return new ie([])}}const qy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oe extends Ke{construct(e,t,s){return new Oe(e,t,s)}static isValidIdentifier(e){return qy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Dc}static keyField(){return new Oe([Dc])}static fromServerFormat(e){const t=[];let s="",i=0;const r=()=>{if(s.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(s+=l,i++):(r(),i++)}if(r(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Oe(t)}static emptyPath(){return new Oe([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(ie.fromString(e))}static fromName(e){return new M(ie.fromString(e).popFirst(5))}static empty(){return new M(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new ie(e.slice()))}}function Id(n,e,t){if(!t)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function jy(n,e,t,s){if(e===!0&&s===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function kc(n){if(!M.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Vc(n){if(M.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $y(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Hy(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B(12329,{type:typeof n})}function Cs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Hy(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function pe(n,e){const t={typeString:n};return e&&(t.value=e),t}function xs(n,e){if(!$y(n))throw new O(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const a=n[s];if(i&&typeof a!==i){t=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&a!==r.value){t=`Expected '${s}' field to equal '${r.value}'`;break}}if(t)throw new O(P.INVALID_ARGUMENT,t);return!0}const xc=-62135596800,Oc=1e6;class fe{static now(){return fe.fromMillis(Date.now())}static fromDate(e){return fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Oc);return new fe(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xc)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Oc}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:fe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(xs(e,fe._jsonSchema))return new fe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-xc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}fe._jsonSchemaVersion="firestore/timestamp/1.0",fe._jsonSchema={type:pe("string",fe._jsonSchemaVersion),seconds:pe("number"),nanoseconds:pe("number")};class F{static fromTimestamp(e){return new F(e)}static min(){return new F(new fe(0,0))}static max(){return new F(new fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const As=-1;function zy(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,i=F.fromTimestamp(s===1e9?new fe(t+1,0):new fe(t,s));return new bt(i,M.empty(),e)}function Wy(n){return new bt(n.readTime,n.key,As)}class bt{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new bt(F.min(),M.empty(),As)}static max(){return new bt(F.max(),M.empty(),As)}}function Gy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:W(n.largestBatchId,e.largestBatchId))}const Ky="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function $i(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Ky)throw n;V("LocalStore","Unexpectedly lost primary lease")}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R(((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(t,r).next(s,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):R.reject(t)}static resolve(e){return new R(((t,s)=>{t(e)}))}static reject(e){return new R(((t,s)=>{s(e)}))}static waitFor(e){return new R(((t,s)=>{let i=0,r=0,a=!1;e.forEach((l=>{++i,l.next((()=>{++r,a&&r===i&&t()}),(u=>s(u)))})),a=!0,r===i&&t()}))}static or(e){let t=R.resolve(!1);for(const s of e)t=t.next((i=>i?R.resolve(i):s()));return t}static forEach(e,t){const s=[];return e.forEach(((i,r)=>{s.push(t.call(this,i,r))})),this.waitFor(s)}static mapArray(e,t){return new R(((s,i)=>{const r=e.length,a=new Array(r);let l=0;for(let u=0;u<r;u++){const h=u;t(e[h]).next((f=>{a[h]=f,++l,l===r&&s(a)}),(f=>i(f)))}}))}static doWhile(e,t){return new R(((s,i)=>{const r=()=>{e()===!0?t().next((()=>{r()}),i):s()};r()}))}}function Yy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Vn(n){return n.name==="IndexedDbTransactionError"}class Hi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Hi.ce=-1;const Xy=-1;function zi(n){return n==null}function fo(n){return n===0&&1/n==-1/0}const wd="";function Jy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Mc(e)),e=Zy(n.get(t),e);return Mc(e)}function Zy(n,e){let t=e;const s=n.length;for(let i=0;i<s;i++){const r=n.charAt(i);switch(r){case"\0":t+="";break;case wd:t+="";break;default:t+=r}}return t}function Mc(n){return n+wd+""}function Lc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Os(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function eE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ue{constructor(e,t){this.comparator=e,this.root=t||Ie.EMPTY}insert(e,t){return new ue(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ie.BLACK,null,null))}remove(e){return new ue(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ie.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return t+s.left.size;i<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new si(this.root,e,this.comparator,!1)}getReverseIterator(){return new si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new si(this.root,e,this.comparator,!0)}}class si{constructor(e,t,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ie{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Ie.RED,this.left=i??Ie.EMPTY,this.right=r??Ie.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,i,r){return new Ie(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ie.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ie.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ie.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ie.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw B(27949);return e+(this.isRed()?0:1)}}Ie.EMPTY=null,Ie.RED=!0,Ie.BLACK=!1;Ie.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,s,i,r){return this}insert(e,t,s){return new Ie(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ye{constructor(e){this.comparator=e,this.data=new ue(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fc(this.data.getIterator())}getIteratorFrom(e){return new Fc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof ye)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ye(this.comparator);return t.data=e,t}}class Fc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class gt{constructor(e){this.fields=e,e.sort(Oe.comparator)}static empty(){return new gt([])}unionWith(e){let t=new ye(Oe.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new gt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class Cd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Cd("Invalid base64 string: "+r):r}})(e);return new Ae(t)}static fromUint8Array(e){const t=(function(i){let r="";for(let a=0;a<i.length;++a)r+=String.fromCharCode(i[a]);return r})(e);return new Ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ae.EMPTY_BYTE_STRING=new Ae("");const tE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(n){if(ae(!!n,39018),typeof n=="string"){let e=0;const t=tE.exec(n);if(ae(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ce(n.seconds),nanos:ce(n.nanos)}}function ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Nt(n){return typeof n=="string"?Ae.fromBase64String(n):Ae.fromUint8Array(n)}const Ad="server_timestamp",Sd="__type__",Rd="__previous_value__",bd="__local_write_time__";function ca(n){return(n?.mapValue?.fields||{})[Sd]?.stringValue===Ad}function Wi(n){const e=n.mapValue.fields[Rd];return ca(e)?Wi(e):e}function Ss(n){const e=Pt(n.mapValue.fields[bd].timestampValue);return new fe(e.seconds,e.nanos)}class nE{constructor(e,t,s,i,r,a,l,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}}const Ri="(default)";class Rs{constructor(e,t){this.projectId=e,this.database=t||Ri}static empty(){return new Rs("","")}get isDefaultDatabase(){return this.database===Ri}isEqual(e){return e instanceof Rs&&e.projectId===this.projectId&&e.database===this.database}}const sE="__type__",iE="__max__",ii={mapValue:{}},rE="__vector__",po="value";function Dt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ca(n)?4:aE(n)?9007199254740991:oE(n)?10:11:B(28295,{value:n})}function et(n,e){if(n===e)return!0;const t=Dt(n);if(t!==Dt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ss(n).isEqual(Ss(e));case 3:return(function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const a=Pt(i.timestampValue),l=Pt(r.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,r){return Nt(i.bytesValue).isEqual(Nt(r.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,r){return ce(i.geoPointValue.latitude)===ce(r.geoPointValue.latitude)&&ce(i.geoPointValue.longitude)===ce(r.geoPointValue.longitude)})(n,e);case 2:return(function(i,r){if("integerValue"in i&&"integerValue"in r)return ce(i.integerValue)===ce(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const a=ce(i.doubleValue),l=ce(r.doubleValue);return a===l?fo(a)===fo(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return Tn(n.arrayValue.values||[],e.arrayValue.values||[],et);case 10:case 11:return(function(i,r){const a=i.mapValue.fields||{},l=r.mapValue.fields||{};if(Lc(a)!==Lc(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!et(a[u],l[u])))return!1;return!0})(n,e);default:return B(52216,{left:n})}}function bs(n,e){return(n.values||[]).find((t=>et(t,e)))!==void 0}function In(n,e){if(n===e)return 0;const t=Dt(n),s=Dt(e);if(t!==s)return W(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return(function(r,a){const l=ce(r.integerValue||r.doubleValue),u=ce(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return Uc(n.timestampValue,e.timestampValue);case 4:return Uc(Ss(n),Ss(e));case 5:return ho(n.stringValue,e.stringValue);case 6:return(function(r,a){const l=Nt(r),u=Nt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(r,a){const l=r.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){const f=W(l[h],u[h]);if(f!==0)return f}return W(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(r,a){const l=W(ce(r.latitude),ce(a.latitude));return l!==0?l:W(ce(r.longitude),ce(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Bc(n.arrayValue,e.arrayValue);case 10:return(function(r,a){const l=r.fields||{},u=a.fields||{},h=l[po]?.arrayValue,f=u[po]?.arrayValue,m=W(h?.values?.length||0,f?.values?.length||0);return m!==0?m:Bc(h,f)})(n.mapValue,e.mapValue);case 11:return(function(r,a){if(r===ii.mapValue&&a===ii.mapValue)return 0;if(r===ii.mapValue)return 1;if(a===ii.mapValue)return-1;const l=r.fields||{},u=Object.keys(l),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const y=ho(u[m],f[m]);if(y!==0)return y;const S=In(l[u[m]],h[f[m]]);if(S!==0)return S}return W(u.length,f.length)})(n.mapValue,e.mapValue);default:throw B(23264,{he:t})}}function Uc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);const t=Pt(n),s=Pt(e),i=W(t.seconds,s.seconds);return i!==0?i:W(t.nanos,s.nanos)}function Bc(n,e){const t=n.values||[],s=e.values||[];for(let i=0;i<t.length&&i<s.length;++i){const r=In(t[i],s[i]);if(r)return r}return W(t.length,s.length)}function wn(n){return mo(n)}function mo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Pt(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Nt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return M.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",i=!0;for(const r of t.values||[])i?i=!1:s+=",",s+=mo(r);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const a of s)r?r=!1:i+=",",i+=`${a}:${mo(t.fields[a])}`;return i+"}"})(n.mapValue):B(61005,{value:n})}function di(n){switch(Dt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Wi(n);return e?16+di(e):16;case 5:return 2*n.stringValue.length;case 6:return Nt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((i,r)=>i+di(r)),0)})(n.arrayValue);case 10:case 11:return(function(s){let i=0;return Os(s.fields,((r,a)=>{i+=r.length+di(a)})),i})(n.mapValue);default:throw B(13486,{value:n})}}function go(n){return!!n&&"integerValue"in n}function ua(n){return!!n&&"arrayValue"in n}function qc(n){return!!n&&"nullValue"in n}function jc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ur(n){return!!n&&"mapValue"in n}function oE(n){return(n?.mapValue?.fields||{})[sE]?.stringValue===rE}function ps(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Os(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=ps(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ps(n.arrayValue.values[t]);return e}return{...n}}function aE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===iE}class Qe{constructor(e){this.value=e}static empty(){return new Qe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Ur(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ps(t)}setAll(e){let t=Oe.emptyPath(),s={},i=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,s,i),s={},i=[],t=l.popLast()}a?s[l.lastSegment()]=ps(a):i.push(l.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,s,i)}delete(e){const t=this.field(e.popLast());Ur(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=t.mapValue.fields[e.get(s)];Ur(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,s){Os(t,((i,r)=>e[i]=r));for(const i of s)delete e[i]}clone(){return new Qe(ps(this.value))}}class Ne{constructor(e,t,s,i,r,a,l){this.key=e,this.documentType=t,this.version=s,this.readTime=i,this.createTime=r,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ne(e,0,F.min(),F.min(),F.min(),Qe.empty(),0)}static newFoundDocument(e,t,s,i){return new Ne(e,1,t,F.min(),s,i,0)}static newNoDocument(e,t){return new Ne(e,2,t,F.min(),F.min(),Qe.empty(),0)}static newUnknownDocument(e,t){return new Ne(e,3,t,F.min(),F.min(),Qe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bi{constructor(e,t){this.position=e,this.inclusive=t}}function $c(n,e,t){let s=0;for(let i=0;i<n.position.length;i++){const r=e[i],a=n.position[i];if(r.field.isKeyField()?s=M.comparator(M.fromName(a.referenceValue),t.key):s=In(a,t.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function Hc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!et(n.position[t],e.position[t]))return!1;return!0}class Pi{constructor(e,t="asc"){this.field=e,this.dir=t}}function lE(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Pd{}class _e extends Pd{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new uE(e,t,s):t==="array-contains"?new fE(e,s):t==="in"?new pE(e,s):t==="not-in"?new mE(e,s):t==="array-contains-any"?new gE(e,s):new _e(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new hE(e,s):new dE(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(In(t,this.value)):t!==null&&Dt(this.value)===Dt(t)&&this.matchesComparison(In(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tt extends Pd{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new tt(e,t)}matches(e){return Nd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Nd(n){return n.op==="and"}function Dd(n){return cE(n)&&Nd(n)}function cE(n){for(const e of n.filters)if(e instanceof tt)return!1;return!0}function _o(n){if(n instanceof _e)return n.field.canonicalString()+n.op.toString()+wn(n.value);if(Dd(n))return n.filters.map((e=>_o(e))).join(",");{const e=n.filters.map((t=>_o(t))).join(",");return`${n.op}(${e})`}}function kd(n,e){return n instanceof _e?(function(s,i){return i instanceof _e&&s.op===i.op&&s.field.isEqual(i.field)&&et(s.value,i.value)})(n,e):n instanceof tt?(function(s,i){return i instanceof tt&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce(((r,a,l)=>r&&kd(a,i.filters[l])),!0):!1})(n,e):void B(19439)}function Vd(n){return n instanceof _e?(function(t){return`${t.field.canonicalString()} ${t.op} ${wn(t.value)}`})(n):n instanceof tt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Vd).join(" ,")+"}"})(n):"Filter"}class uE extends _e{constructor(e,t,s){super(e,t,s),this.key=M.fromName(s.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class hE extends _e{constructor(e,t){super(e,"in",t),this.keys=xd("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class dE extends _e{constructor(e,t){super(e,"not-in",t),this.keys=xd("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function xd(n,e){return(e.arrayValue?.values||[]).map((t=>M.fromName(t.referenceValue)))}class fE extends _e{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ua(t)&&bs(t.arrayValue,this.value)}}class pE extends _e{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&bs(this.value.arrayValue,t)}}class mE extends _e{constructor(e,t){super(e,"not-in",t)}matches(e){if(bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!bs(this.value.arrayValue,t)}}class gE extends _e{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ua(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>bs(this.value.arrayValue,s)))}}class _E{constructor(e,t=null,s=[],i=[],r=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=a,this.endAt=l,this.Te=null}}function zc(n,e=null,t=[],s=[],i=null,r=null,a=null){return new _E(n,e,t,s,i,r,a)}function ha(n){const e=Q(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>_o(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(r){return r.field.canonicalString()+r.dir})(s))).join(","),zi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>wn(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>wn(s))).join(",")),e.Te=t}return e.Te}function da(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!lE(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!kd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Hc(n.startAt,e.startAt)&&Hc(n.endAt,e.endAt)}function yo(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Gi{constructor(e,t=null,s=[],i=[],r=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function yE(n,e,t,s,i,r,a,l){return new Gi(n,e,t,s,i,r,a,l)}function fa(n){return new Gi(n)}function Wc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function EE(n){return n.collectionGroup!==null}function ms(n){const e=Q(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ye(Oe.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new Pi(r,s))})),t.has(Oe.keyField().canonicalString())||e.Ie.push(new Pi(Oe.keyField(),s))}return e.Ie}function Ze(n){const e=Q(n);return e.Ee||(e.Ee=vE(e,ms(n))),e.Ee}function vE(n,e){if(n.limitType==="F")return zc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const r=i.dir==="desc"?"asc":"desc";return new Pi(i.field,r)}));const t=n.endAt?new bi(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new bi(n.startAt.position,n.startAt.inclusive):null;return zc(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Eo(n,e,t){return new Gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ki(n,e){return da(Ze(n),Ze(e))&&n.limitType===e.limitType}function Od(n){return`${ha(Ze(n))}|lt:${n.limitType}`}function an(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((i=>Vd(i))).join(", ")}]`),zi(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((i=>wn(i))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((i=>wn(i))).join(",")),`Target(${s})`})(Ze(n))}; limitType=${n.limitType})`}function Qi(n,e){return e.isFoundDocument()&&(function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):M.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)})(n,e)&&(function(s,i){for(const r of ms(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0})(n,e)&&(function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0})(n,e)&&(function(s,i){return!(s.startAt&&!(function(a,l,u){const h=$c(a,l,u);return a.inclusive?h<=0:h<0})(s.startAt,ms(s),i)||s.endAt&&!(function(a,l,u){const h=$c(a,l,u);return a.inclusive?h>=0:h>0})(s.endAt,ms(s),i))})(n,e)}function TE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Md(n){return(e,t)=>{let s=!1;for(const i of ms(n)){const r=IE(i,e,t);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function IE(n,e,t){const s=n.field.isKeyField()?M.comparator(e.key,t.key):(function(r,a,l){const u=a.data.field(r),h=l.data.field(r);return u!==null&&h!==null?In(u,h):B(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return B(19790,{direction:n.dir})}}class en{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[t]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Os(this.inner,((t,s)=>{for(const[i,r]of s)e(i,r)}))}isEmpty(){return eE(this.inner)}size(){return this.innerSize}}const wE=new ue(M.comparator);function kt(){return wE}const Ld=new ue(M.comparator);function rs(...n){let e=Ld;for(const t of n)e=e.insert(t.key,t);return e}function CE(n){let e=Ld;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function zt(){return gs()}function Fd(){return gs()}function gs(){return new en((n=>n.toString()),((n,e)=>n.isEqual(e)))}const AE=new ye(M.comparator);function Y(...n){let e=AE;for(const t of n)e=e.add(t);return e}const SE=new ye(W);function RE(){return SE}function bE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fo(e)?"-0":e}}function PE(n){return{integerValue:""+n}}class Yi{constructor(){this._=void 0}}function NE(n,e,t){return n instanceof vo?(function(i,r){const a={fields:{[Sd]:{stringValue:Ad},[bd]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&ca(r)&&(r=Wi(r)),r&&(a.fields[Rd]=r),{mapValue:a}})(t,e):n instanceof Ni?Ud(n,e):n instanceof Di?Bd(n,e):(function(i,r){const a=kE(i,r),l=Gc(a)+Gc(i.Ae);return go(a)&&go(i.Ae)?PE(l):bE(i.serializer,l)})(n,e)}function DE(n,e,t){return n instanceof Ni?Ud(n,e):n instanceof Di?Bd(n,e):t}function kE(n,e){return n instanceof To?(function(s){return go(s)||(function(r){return!!r&&"doubleValue"in r})(s)})(e)?e:{integerValue:0}:null}class vo extends Yi{}class Ni extends Yi{constructor(e){super(),this.elements=e}}function Ud(n,e){const t=qd(e);for(const s of n.elements)t.some((i=>et(i,s)))||t.push(s);return{arrayValue:{values:t}}}class Di extends Yi{constructor(e){super(),this.elements=e}}function Bd(n,e){let t=qd(e);for(const s of n.elements)t=t.filter((i=>!et(i,s)));return{arrayValue:{values:t}}}class To extends Yi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Gc(n){return ce(n.integerValue||n.doubleValue)}function qd(n){return ua(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function VE(n,e){return n.field.isEqual(e.field)&&(function(s,i){return s instanceof Ni&&i instanceof Ni||s instanceof Di&&i instanceof Di?Tn(s.elements,i.elements,et):s instanceof To&&i instanceof To?et(s.Ae,i.Ae):s instanceof vo&&i instanceof vo})(n.transform,e.transform)}class Wt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Wt}static exists(e){return new Wt(void 0,e)}static updateTime(e){return new Wt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class pa{}function jd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new OE(n.key,Wt.none()):new ma(n.key,n.data,Wt.none());{const t=n.data,s=Qe.empty();let i=new ye(Oe.comparator);for(let r of e.fields)if(!i.has(r)){let a=t.field(r);a===null&&r.length>1&&(r=r.popLast(),a=t.field(r)),a===null?s.delete(r):s.set(r,a),i=i.add(r)}return new Xi(n.key,s,new gt(i.toArray()),Wt.none())}}function xE(n,e,t){n instanceof ma?(function(i,r,a){const l=i.value.clone(),u=Qc(i.fieldTransforms,r,a.transformResults);l.setAll(u),r.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Xi?(function(i,r,a){if(!fi(i.precondition,r))return void r.convertToUnknownDocument(a.version);const l=Qc(i.fieldTransforms,r,a.transformResults),u=r.data;u.setAll($d(i)),u.setAll(l),r.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(i,r,a){r.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function _s(n,e,t,s){return n instanceof ma?(function(r,a,l,u){if(!fi(r.precondition,a))return l;const h=r.value.clone(),f=Yc(r.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,s):n instanceof Xi?(function(r,a,l,u){if(!fi(r.precondition,a))return l;const h=Yc(r.fieldTransforms,u,a),f=a.data;return f.setAll($d(r)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((m=>m.field)))})(n,e,t,s):(function(r,a,l){return fi(r.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Kc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Tn(s,i,((r,a)=>VE(r,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ma extends pa{constructor(e,t,s,i=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Xi extends pa{constructor(e,t,s,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function $d(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Qc(n,e,t){const s=new Map;ae(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const r=n[i],a=r.transform,l=e.data.field(r.field);s.set(r.field,DE(a,l,t[i]))}return s}function Yc(n,e,t){const s=new Map;for(const i of n){const r=i.transform,a=t.data.field(i.field);s.set(i.field,NE(r,a,e))}return s}class OE extends pa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ME{constructor(e,t,s,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&xE(r,e,s[i])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=_s(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=_s(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Fd();return this.mutations.forEach((i=>{const r=e.get(i.key),a=r.overlayedDocument;let l=this.applyToLocalView(a,r.mutatedFields);l=t.has(i.key)?null:l;const u=jd(a,l);u!==null&&s.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(F.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Y())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,((t,s)=>Kc(t,s)))&&Tn(this.baseMutations,e.baseMutations,((t,s)=>Kc(t,s)))}}class LE{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class FE{constructor(e,t){this.count=e,this.unchangedNames=t}}var de,G;function Hd(n){if(n===void 0)return at("GRPC error has no .code"),P.UNKNOWN;switch(n){case de.OK:return P.OK;case de.CANCELLED:return P.CANCELLED;case de.UNKNOWN:return P.UNKNOWN;case de.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case de.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case de.INTERNAL:return P.INTERNAL;case de.UNAVAILABLE:return P.UNAVAILABLE;case de.UNAUTHENTICATED:return P.UNAUTHENTICATED;case de.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case de.NOT_FOUND:return P.NOT_FOUND;case de.ALREADY_EXISTS:return P.ALREADY_EXISTS;case de.PERMISSION_DENIED:return P.PERMISSION_DENIED;case de.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case de.ABORTED:return P.ABORTED;case de.OUT_OF_RANGE:return P.OUT_OF_RANGE;case de.UNIMPLEMENTED:return P.UNIMPLEMENTED;case de.DATA_LOSS:return P.DATA_LOSS;default:return B(39323,{code:n})}}(G=de||(de={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";function UE(){return new TextEncoder}const BE=new It([4294967295,4294967295],0);function Xc(n){const e=UE().encode(n),t=new pd;return t.update(e),new Uint8Array(t.digest())}function Jc(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new It([t,s],0),new It([i,r],0)]}class ga{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new os(`Invalid padding: ${t}`);if(s<0)throw new os(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new os(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new os(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=It.fromNumber(this.ge)}ye(e,t,s){let i=e.add(t.multiply(It.fromNumber(s)));return i.compare(BE)===1&&(i=new It([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Xc(e),[s,i]=Jc(t);for(let r=0;r<this.hashCount;r++){const a=this.ye(s,i,r);if(!this.we(a))return!1}return!0}static create(e,t,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),a=new ga(r,i,t);return s.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Xc(e),[s,i]=Jc(t);for(let r=0;r<this.hashCount;r++){const a=this.ye(s,i,r);this.Se(a)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class os extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ji{constructor(e,t,s,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const i=new Map;return i.set(e,Ms.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ji(F.min(),i,new ue(W),kt(),Y())}}class Ms{constructor(e,t,s,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Ms(s,t,Y(),Y(),Y())}}class pi{constructor(e,t,s,i){this.be=e,this.removedTargetIds=t,this.key=s,this.De=i}}class zd{constructor(e,t){this.targetId=e,this.Ce=t}}class Wd{constructor(e,t,s=Ae.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=i}}class Zc{constructor(){this.ve=0,this.Fe=eu(),this.Me=Ae.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Y(),t=Y(),s=Y();return this.Fe.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:s=s.add(i);break;default:B(38017,{changeType:r})}})),new Ms(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=eu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ae(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class qE{constructor(e){this.Ge=e,this.ze=new Map,this.je=kt(),this.Je=ri(),this.He=ri(),this.Ye=new ue(W)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:B(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,s=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(yo(r))if(s===0){const a=new M(r.path);this.et(t,a,Ne.newNoDocument(a,F.min()))}else ae(s===1,20013,{expectedCount:s});else{const a=this._t(t);if(a!==s){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=t;let a,l;try{a=Nt(s).toUint8Array()}catch(u){if(u instanceof Cd)return vn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new ga(a,i,r)}catch(u){return vn(u instanceof os?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let i=0;return s.forEach((r=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${r.path.canonicalString()}`;e.mightContain(l)||(this.et(t,r,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((r,a)=>{const l=this.ot(a);if(l){if(r.current&&yo(l.target)){const u=new M(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Ne.newNoDocument(u,e))}r.Be&&(t.set(a,r.ke()),r.qe())}}));let s=Y();this.He.forEach(((r,a)=>{let l=!0;a.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(s=s.add(r))})),this.je.forEach(((r,a)=>a.setReadTime(e)));const i=new Ji(e,t,this.Ye,this.je,s);return this.je=kt(),this.Je=ri(),this.He=ri(),this.Ye=new ue(W),i}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Zc,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ye(W),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ye(W),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Zc),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ri(){return new ue(M.comparator)}function eu(){return new ue(M.comparator)}const jE={asc:"ASCENDING",desc:"DESCENDING"},$E={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HE={and:"AND",or:"OR"};class zE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Io(n,e){return n.useProto3Json||zi(e)?e:{value:e}}function WE(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function GE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function fn(n){return ae(!!n,49232),F.fromTimestamp((function(t){const s=Pt(t);return new fe(s.seconds,s.nanos)})(n))}function KE(n,e){return wo(n,e).canonicalString()}function wo(n,e){const t=(function(i){return new ie(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Gd(n){const e=ie.fromString(n);return ae(Jd(e),10190,{key:e.toString()}),e}function Br(n,e){const t=Gd(e);if(t.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(Qd(t))}function Kd(n,e){return KE(n.databaseId,e)}function QE(n){const e=Gd(n);return e.length===4?ie.emptyPath():Qd(e)}function tu(n){return new ie(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Qd(n){return ae(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function YE(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:B(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=(function(h,f){return h.useProto3Json?(ae(f===void 0||typeof f=="string",58123),Ae.fromBase64String(f||"")):(ae(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ae.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(h){const f=h.code===void 0?P.UNKNOWN:Hd(h.code);return new O(f,h.message||"")})(a);t=new Wd(s,i,r,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Br(n,s.document.name),r=fn(s.document.updateTime),a=s.document.createTime?fn(s.document.createTime):F.min(),l=new Qe({mapValue:{fields:s.document.fields}}),u=Ne.newFoundDocument(i,r,a,l),h=s.targetIds||[],f=s.removedTargetIds||[];t=new pi(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Br(n,s.document),r=s.readTime?fn(s.readTime):F.min(),a=Ne.newNoDocument(i,r),l=s.removedTargetIds||[];t=new pi([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Br(n,s.document),r=s.removedTargetIds||[];t=new pi([],r,i,null)}else{if(!("filter"in e))return B(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,a=new FE(i,r),l=s.targetId;t=new zd(l,a)}}return t}function XE(n,e){return{documents:[Kd(n,e.path)]}}function JE(n,e){const t={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Kd(n,i);const r=(function(h){if(h.length!==0)return Xd(tt.create(h,"and"))})(e.filters);r&&(t.structuredQuery.where=r);const a=(function(h){if(h.length!==0)return h.map((f=>(function(y){return{field:ln(y.field),direction:tv(y.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Io(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function ZE(n){let e=QE(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let i=null;if(s>0){ae(s===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let r=[];t.where&&(r=(function(m){const y=Yd(m);return y instanceof tt&&Dd(y)?y.getFilters():[y]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((y=>(function(b){return new Pi(cn(b.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(y)))})(t.orderBy));let l=null;t.limit&&(l=(function(m){let y;return y=typeof m=="object"?m.value:m,zi(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(m){const y=!!m.before,S=m.values||[];return new bi(S,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){const y=!m.before,S=m.values||[];return new bi(S,y)})(t.endAt)),yE(e,i,a,r,l,"F",u,h)}function ev(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Yd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=cn(t.unaryFilter.field);return _e.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=cn(t.unaryFilter.field);return _e.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=cn(t.unaryFilter.field);return _e.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=cn(t.unaryFilter.field);return _e.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}})(n):n.fieldFilter!==void 0?(function(t){return _e.create(cn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return tt.create(t.compositeFilter.filters.map((s=>Yd(s))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B(1026)}})(t.compositeFilter.op))})(n):B(30097,{filter:n})}function tv(n){return jE[n]}function nv(n){return $E[n]}function sv(n){return HE[n]}function ln(n){return{fieldPath:n.canonicalString()}}function cn(n){return Oe.fromServerFormat(n.fieldPath)}function Xd(n){return n instanceof _e?(function(t){if(t.op==="=="){if(jc(t.value))return{unaryFilter:{field:ln(t.field),op:"IS_NAN"}};if(qc(t.value))return{unaryFilter:{field:ln(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jc(t.value))return{unaryFilter:{field:ln(t.field),op:"IS_NOT_NAN"}};if(qc(t.value))return{unaryFilter:{field:ln(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ln(t.field),op:nv(t.op),value:t.value}}})(n):n instanceof tt?(function(t){const s=t.getFilters().map((i=>Xd(i)));return s.length===1?s[0]:{compositeFilter:{op:sv(t.op),filters:s}}})(n):B(54877,{filter:n})}function Jd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class _t{constructor(e,t,s,i,r=F.min(),a=F.min(),l=Ae.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new _t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new _t(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iv{constructor(e){this.yt=e}}function rv(n){const e=ZE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Eo(e,e.limit,"L"):e}class ov{constructor(){this.Cn=new av}addToCollectionParentIndex(e,t){return this.Cn.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(bt.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(bt.min())}updateCollectionGroup(e,t,s){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class av{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t]||new ye(ie.comparator),r=!i.has(s);return this.index[t]=i.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t];return i&&i.has(s)}getEntries(e){return(this.index[e]||new ye(ie.comparator)).toArray()}}const nu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zd=41943040;class Le{static withCacheSize(e){return new Le(e,Le.DEFAULT_COLLECTION_PERCENTILE,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}Le.DEFAULT_COLLECTION_PERCENTILE=10,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Le.DEFAULT=new Le(Zd,Le.DEFAULT_COLLECTION_PERCENTILE,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Le.DISABLED=new Le(-1,0,0);class Cn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Cn(0)}static cr(){return new Cn(-1)}}const su="LruGarbageCollector",lv=1048576;function iu([n,e],[t,s]){const i=W(n,t);return i===0?W(e,s):i}class cv{constructor(e){this.Ir=e,this.buffer=new ye(iu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();iu(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uv{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){V(su,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Vn(t)?V(su,"Ignoring IndexedDB error during garbage collection: ",t):await $i(t)}await this.Vr(3e5)}))}}class hv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Hi.ce);const s=new cv(t);return this.mr.forEachTarget(e,(i=>s.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>s.Ar(i))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(nu)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nu):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,i,r,a,l,u,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i)))).next((m=>(s=m,l=Date.now(),this.removeTargets(e,s,t)))).next((m=>(r=m,u=Date.now(),this.removeOrphanedDocuments(e,s)))).next((m=>(h=Date.now(),on()<=H.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${r} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:m}))))}}function dv(n,e){return new hv(n,e)}class fv{constructor(){this.changes=new en((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?R.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class pv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mv{constructor(e,t,s,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(s=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(s!==null&&_s(s.mutation,i,gt.empty(),fe.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Y()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Y()){const i=zt();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,s).next((r=>{let a=rs();return r.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const s=zt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Y())))}populateOverlays(e,t,s){const i=[];return s.forEach((r=>{t.has(r)||i.push(r)})),this.documentOverlayCache.getOverlays(e,i).next((r=>{r.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,s,i){let r=kt();const a=gs(),l=(function(){return gs()})();return t.forEach(((u,h)=>{const f=s.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Xi)?r=r.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),_s(f.mutation,h,f.mutation.getFieldMask(),fe.now())):a.set(h.key,gt.empty())})),this.recalculateAndSaveOverlays(e,r).next((u=>(u.forEach(((h,f)=>a.set(h,f))),t.forEach(((h,f)=>l.set(h,new pv(f,a.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const s=gs();let i=new ue(((a,l)=>a-l)),r=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let f=s.get(u)||gt.empty();f=l.applyToLocalView(h,f),s.set(u,f);const m=(i.get(l.batchId)||Y()).add(u);i=i.insert(l.batchId,m)}))})).next((()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,f=u.value,m=Fd();f.forEach((y=>{if(!r.has(y)){const S=jd(t.get(y),s.get(y));S!==null&&m.set(y,S),r=r.add(y)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return R.waitFor(a)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,i){return(function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):EE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,i):this.getDocumentsMatchingCollectionQuery(e,t,s,i)}getNextDocuments(e,t,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,i).next((r=>{const a=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,i-r.size):R.resolve(zt());let l=As,u=r;return a.next((h=>R.forEach(h,((f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),r.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next((y=>{u=u.insert(f,y)}))))).next((()=>this.populateOverlays(e,h,r))).next((()=>this.computeViews(e,u,h,Y()))).next((f=>({batchId:l,changes:CE(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next((s=>{let i=rs();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,i){const r=t.collectionGroup;let a=rs();return this.indexManager.getCollectionParents(e,r).next((l=>R.forEach(l,(u=>{const h=(function(m,y){return new Gi(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next((f=>{f.forEach(((m,y)=>{a=a.insert(m,y)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((a=>(r=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,i)))).next((a=>{r.forEach(((u,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Ne.newInvalidDocument(f)))}));let l=rs();return a.forEach(((u,h)=>{const f=r.get(u);f!==void 0&&_s(f.mutation,h,gt.empty(),fe.now()),Qi(t,h)&&(l=l.insert(u,h))})),l}))}}class gv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return R.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:fn(i.createTime)}})(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:rv(i.bundledQuery),readTime:fn(i.readTime)}})(t)),R.resolve()}}class _v{constructor(){this.overlays=new ue(M.comparator),this.qr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const s=zt();return R.forEach(t,(i=>this.getOverlay(e,i).next((r=>{r!==null&&s.set(i,r)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((i,r)=>{this.St(e,t,r)})),R.resolve()}removeOverlaysForBatchId(e,t,s){const i=this.qr.get(s);return i!==void 0&&(i.forEach((r=>this.overlays=this.overlays.remove(r))),this.qr.delete(s)),R.resolve()}getOverlaysForCollection(e,t,s){const i=zt(),r=t.length+1,a=new M(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===r&&u.largestBatchId>s&&i.set(u.getKey(),u)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,s,i){let r=new ue(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=r.get(h.largestBatchId);f===null&&(f=zt(),r=r.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=zt(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=i)););return R.resolve(l)}St(e,t,s){const i=this.overlays.get(s.key);if(i!==null){const a=this.qr.get(i.largestBatchId).delete(s.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new LE(t,s));let r=this.qr.get(t);r===void 0&&(r=Y(),this.qr.set(t,r)),this.qr.set(t,r.add(s.key))}}class yv{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class _a{constructor(){this.Qr=new ye(Te.$r),this.Ur=new ye(Te.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Te(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new Te(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new M(new ie([])),s=new Te(t,e),i=new Te(t,e+1),r=[];return this.Ur.forEachInRange([s,i],(a=>{this.Gr(a),r.push(a.key)})),r}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new M(new ie([])),s=new Te(t,e),i=new Te(t,e+1);let r=Y();return this.Ur.forEachInRange([s,i],(a=>{r=r.add(a.key)})),r}containsKey(e){const t=new Te(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Te{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return M.comparator(e.key,t.key)||W(e.Yr,t.Yr)}static Kr(e,t){return W(e.Yr,t.Yr)||M.comparator(e.key,t.key)}}class Ev{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ye(Te.$r)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,i){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new ME(r,t,s,i);this.mutationQueue.push(a);for(const l of i)this.Zr=this.Zr.add(new Te(l.key,r)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=this.ei(s),r=i<0?0:i;return R.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Xy:this.tr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Te(t,0),i=new Te(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([s,i],(a=>{const l=this.Xr(a.Yr);r.push(l)})),R.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new ye(W);return t.forEach((i=>{const r=new Te(i,0),a=new Te(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([r,a],(l=>{s=s.add(l.Yr)}))})),R.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1;let r=s;M.isDocumentKey(r)||(r=r.child(""));const a=new Te(new M(r),0);let l=new ye(W);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(l=l.add(u.Yr)),!0)}),a),R.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((s=>{const i=this.Xr(s);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){ae(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return R.forEach(t.mutations,(i=>{const r=new Te(i.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new Te(t,0),i=this.Zr.firstAfterOrEqual(s);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class vv{constructor(e){this.ri=e,this.docs=(function(){return new ue(M.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,i=this.docs.get(s),r=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return R.resolve(s?s.document.mutableCopy():Ne.newInvalidDocument(t))}getEntries(e,t){let s=kt();return t.forEach((i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():Ne.newInvalidDocument(i))})),R.resolve(s)}getDocumentsMatchingQuery(e,t,s,i){let r=kt();const a=t.path,l=new M(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Gy(Wy(f),s)<=0||(i.has(f.key)||Qi(t,f))&&(r=r.insert(f.key,f.mutableCopy()))}return R.resolve(r)}getAllFromCollectionGroup(e,t,s,i){B(9500)}ii(e,t){return R.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Tv(this)}getSize(e){return R.resolve(this.size)}}class Tv extends fv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(s)})),R.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Iv{constructor(e){this.persistence=e,this.si=new en((t=>ha(t)),da),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.oi=0,this._i=new _a,this.targetCount=0,this.ai=Cn.ur()}forEachTarget(e,t){return this.si.forEach(((s,i)=>t(i))),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),R.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Cn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Pr(t),R.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,s){let i=0;const r=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.si.delete(a),r.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),R.waitFor(r).next((()=>i))}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return R.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),R.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((a=>{r.push(i.markPotentiallyOrphaned(e,a))})),R.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return R.resolve(s)}containsKey(e,t){return R.resolve(this._i.containsKey(t))}}class ef{constructor(e,t){this.ui={},this.overlays={},this.ci=new Hi(0),this.li=!1,this.li=!0,this.hi=new yv,this.referenceDelegate=e(this),this.Pi=new Iv(this),this.indexManager=new ov,this.remoteDocumentCache=(function(i){return new vv(i)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new iv(t),this.Ii=new gv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _v,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Ev(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){V("MemoryPersistence","Starting transaction:",e);const i=new wv(this.ci.next());return this.referenceDelegate.Ei(),s(i).next((r=>this.referenceDelegate.di(i).next((()=>r)))).toPromise().then((r=>(i.raiseOnCommittedEvent(),r)))}Ai(e,t){return R.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class wv extends Qy{constructor(e){super(),this.currentSequenceNumber=e}}class ya{constructor(e){this.persistence=e,this.Ri=new _a,this.Vi=null}static mi(e){return new ya(e)}get fi(){if(this.Vi)return this.Vi;throw B(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),R.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),R.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((r=>this.fi.add(r.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.fi,(s=>{const i=M.fromPath(s);return this.gi(e,i).next((r=>{r||t.removeEntry(i,F.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return R.or([()=>R.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class ki{constructor(e,t){this.persistence=e,this.pi=new en((s=>Jy(s.path)),((s,i)=>s.isEqual(i))),this.garbageCollector=dv(this,t)}static mi(e,t){return new ki(e,t)}Ei(){}di(e){return R.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((i=>s+i))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return R.forEach(this.pi,((s,i)=>this.br(e,s,i).next((r=>r?R.resolve():t(i)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ii(e,(a=>this.br(e,a,t).next((l=>{l||(s++,r.removeEntry(a,F.min()))})))).next((()=>r.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),R.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),R.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),R.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),R.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=di(e.data.value)),t}br(e,t,s){return R.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return R.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ea{constructor(e,t,s,i){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=i}static As(e,t){let s=Y(),i=Y();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new Ea(e,t.fromCache,s,i)}}class Cv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Av{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Cp()?8:Yy(Lu())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,i){const r={result:null};return this.ys(e,t).next((a=>{r.result=a})).next((()=>{if(!r.result)return this.ws(e,t,i,s).next((a=>{r.result=a}))})).next((()=>{if(r.result)return;const a=new Cv;return this.Ss(e,t,a).next((l=>{if(r.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>r.result))}bs(e,t,s,i){return s.documentReadCount<this.fs?(on()<=H.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",an(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),R.resolve()):(on()<=H.DEBUG&&V("QueryEngine","Query:",an(t),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.gs*i?(on()<=H.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",an(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):R.resolve())}ys(e,t){if(Wc(t))return R.resolve(null);let s=Ze(t);return this.indexManager.getIndexType(e,s).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Eo(t,null,"F"),s=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((r=>{const a=Y(...r);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,s).next((u=>{const h=this.Ds(t,l);return this.Cs(t,h,a,u.readTime)?this.ys(e,Eo(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,s,i){return Wc(t)||i.isEqual(F.min())?R.resolve(null):this.ps.getDocuments(e,s).next((r=>{const a=this.Ds(t,r);return this.Cs(t,a,s,i)?R.resolve(null):(on()<=H.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),an(t)),this.vs(e,a,t,zy(i,As)).next((l=>l)))}))}Ds(e,t){let s=new ye(Md(e));return t.forEach(((i,r)=>{Qi(e,r)&&(s=s.add(r))})),s}Cs(e,t,s,i){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ss(e,t,s){return on()<=H.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",an(t)),this.ps.getDocumentsMatchingQuery(e,t,bt.min(),s)}vs(e,t,s,i){return this.ps.getDocumentsMatchingQuery(e,s,i).next((r=>(t.forEach((a=>{r=r.insert(a.key,a)})),r)))}}const va="LocalStore",Sv=3e8;class Rv{constructor(e,t,s,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new ue(W),this.xs=new en((r=>ha(r)),da),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function bv(n,e,t,s){return new Rv(n,e,t,s)}async function tf(n,e){const t=Q(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let i;return t.mutationQueue.getAllMutationBatches(s).next((r=>(i=r,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((r=>{const a=[],l=[];let u=Y();for(const h of i){a.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of r){l.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(s,u).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:l})))}))}))}function nf(n){const e=Q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Pv(n,e){const t=Q(n),s=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const l=[];e.targetChanges.forEach(((f,m)=>{const y=i.get(m);if(!y)return;l.push(t.Pi.removeMatchingKeys(r,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(r,f.addedDocuments,m))));let S=y.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(m)!==null?S=S.withResumeToken(Ae.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,s)),i=i.insert(m,S),(function(x,k,L){return x.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=Sv?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(y,S,f)&&l.push(t.Pi.updateTargetData(r,S))}));let u=kt(),h=Y();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(r,f))})),l.push(Nv(r,a,e.documentUpdates).next((f=>{u=f.ks,h=f.qs}))),!s.isEqual(F.min())){const f=t.Pi.getLastRemoteSnapshotVersion(r).next((m=>t.Pi.setTargetsMetadata(r,r.currentSequenceNumber,s)));l.push(f)}return R.waitFor(l).next((()=>a.apply(r))).next((()=>t.localDocuments.getLocalViewOfDocuments(r,u,h))).next((()=>u))})).then((r=>(t.Ms=i,r)))}function Nv(n,e,t){let s=Y(),i=Y();return t.forEach((r=>s=s.add(r))),e.getEntries(n,s).next((r=>{let a=kt();return t.forEach(((l,u)=>{const h=r.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),u.isNoDocument()&&u.version.isEqual(F.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):V(va,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)})),{ks:a,qs:i}}))}function Dv(n,e){const t=Q(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let i;return t.Pi.getTargetData(s,e).next((r=>r?(i=r,R.resolve(i)):t.Pi.allocateTargetId(s).next((a=>(i=new _t(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,i).next((()=>i)))))))})).then((s=>{const i=t.Ms.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Co(n,e,t){const s=Q(n),i=s.Ms.get(e),r=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",r,(a=>s.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Vn(a))throw a;V(va,`Failed to update sequence numbers for target ${e}: ${a}`)}s.Ms=s.Ms.remove(e),s.xs.delete(i.target)}function ru(n,e,t){const s=Q(n);let i=F.min(),r=Y();return s.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,h,f){const m=Q(u),y=m.xs.get(f);return y!==void 0?R.resolve(m.Ms.get(y)):m.Pi.getTargetData(h,f)})(s,a,Ze(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{r=u}))})).next((()=>s.Fs.getDocumentsMatchingQuery(a,e,t?i:F.min(),t?r:Y()))).next((l=>(kv(s,TE(e),l),{documents:l,Qs:r})))))}function kv(n,e,t){let s=n.Os.get(e)||F.min();t.forEach(((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)})),n.Os.set(e,s)}class ou{constructor(){this.activeTargetIds=RE()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vv{constructor(){this.Mo=new ou,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ou,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xv{Oo(e){}shutdown(){}}const au="ConnectivityMonitor";class lu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){V(au,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){V(au,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let oi=null;function Ao(){return oi===null?oi=(function(){return 268435456+Math.round(2147483648*Math.random())})():oi++,"0x"+oi.toString(16)}const qr="RestConnection",Ov={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Mv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${i}`,this.Wo=this.databaseId.database===Ri?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Go(e,t,s,i,r){const a=Ao(),l=this.zo(e,t.toUriEncodedString());V(qr,`Sending RPC '${e}' ${a}:`,l,s);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,r);const{host:h}=new URL(l),f=Ps(h);return this.Jo(e,l,u,s,f).then((m=>(V(qr,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw vn(qr,`RPC '${e}' ${a} failed with error: `,m,"url: ",l,"request:",s),m}))}Ho(e,t,s,i,r,a){return this.Go(e,t,s,i,r)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+kn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,r)=>e[r]=i)),s&&s.headers.forEach(((i,r)=>e[r]=i))}zo(e,t){const s=Ov[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class Lv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Re="WebChannelConnection";class Fv extends Mv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,i,r){const a=Ao();return new Promise(((l,u)=>{const h=new md;h.setWithCredentials(!0),h.listenOnce(gd.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case hi.NO_ERROR:const m=h.getResponseJson();V(Re,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),l(m);break;case hi.TIMEOUT:V(Re,`RPC '${e}' ${a} timed out`),u(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case hi.HTTP_ERROR:const y=h.getStatus();if(V(Re,`RPC '${e}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let S=h.getResponseJson();Array.isArray(S)&&(S=S[0]);const b=S?.error;if(b&&b.status&&b.message){const x=(function(L){const q=L.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN})(b.status);u(new O(x,b.message))}else u(new O(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new O(P.UNAVAILABLE,"Connection failed."));break;default:B(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{V(Re,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(i);V(Re,`RPC '${e}' ${a} sending request:`,i),h.send(t,"POST",f,s,15)}))}T_(e,t,s){const i=Ao(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ed(),l=yd(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const f=r.join("");V(Re,`Creating RPC '${e}' stream ${i}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let y=!1,S=!1;const b=new Lv({Yo:k=>{S?V(Re,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(y||(V(Re,`Opening RPC '${e}' stream ${i} transport.`),m.open(),y=!0),V(Re,`RPC '${e}' stream ${i} sending:`,k),m.send(k))},Zo:()=>m.close()}),x=(k,L,q)=>{k.listen(L,(U=>{try{q(U)}catch(Z){setTimeout((()=>{throw Z}),0)}}))};return x(m,is.EventType.OPEN,(()=>{S||(V(Re,`RPC '${e}' stream ${i} transport opened.`),b.o_())})),x(m,is.EventType.CLOSE,(()=>{S||(S=!0,V(Re,`RPC '${e}' stream ${i} transport closed`),b.a_(),this.E_(m))})),x(m,is.EventType.ERROR,(k=>{S||(S=!0,vn(Re,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),b.a_(new O(P.UNAVAILABLE,"The operation could not be completed")))})),x(m,is.EventType.MESSAGE,(k=>{if(!S){const L=k.data[0];ae(!!L,16349);const q=L,U=q?.error||q[0]?.error;if(U){V(Re,`RPC '${e}' stream ${i} received error:`,U);const Z=U.status;let he=(function(g){const E=de[g];if(E!==void 0)return Hd(E)})(Z),oe=U.message;he===void 0&&(he=P.INTERNAL,oe="Unknown error status: "+Z+" with message "+U.message),S=!0,b.a_(new O(he,oe)),m.close()}else V(Re,`RPC '${e}' stream ${i} received:`,L),b.u_(L)}})),x(l,_d.STAT_EVENT,(k=>{k.stat===uo.PROXY?V(Re,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===uo.NOPROXY&&V(Re,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function jr(){return typeof document<"u"?document:null}function sf(n){return new zE(n,!0)}class rf{constructor(e,t,s=1e3,i=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=i,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-s);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const cu="PersistentStream";class Uv{constructor(e,t,s,i,r,a,l,u){this.Mi=e,this.S_=s,this.b_=i,this.connection=r,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rf(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(at(t.toString()),at("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,i])=>{this.D_===t&&this.G_(s,i)}),(s=>{e((()=>{const i=new O(P.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(i)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{s((()=>this.z_(i)))})),this.stream.onMessage((i=>{s((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return V(cu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(V(cu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Bv extends Uv{constructor(e,t,s,i,r,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,i,a),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=YE(this.serializer,e),s=(function(r){if(!("targetChange"in r))return F.min();const a=r.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?fn(a.readTime):F.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=tu(this.serializer),t.addTarget=(function(r,a){let l;const u=a.target;if(l=yo(u)?{documents:XE(r,u)}:{query:JE(r,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=GE(r,a.resumeToken);const h=Io(r,a.expectedCount);h!==null&&(l.expectedCount=h)}else if(a.snapshotVersion.compareTo(F.min())>0){l.readTime=WE(r,a.snapshotVersion.toTimestamp());const h=Io(r,a.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const s=ev(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=tu(this.serializer),t.removeTarget=e,this.q_(t)}}class qv{}class jv extends qv{constructor(e,t,s,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,a])=>this.connection.Go(e,wo(t,s),i,r,a))).catch((r=>{throw r.name==="FirebaseError"?(r.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new O(P.UNKNOWN,r.toString())}))}Ho(e,t,s,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,wo(t,s),i,a,l,r))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class $v{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(at(t),this.aa=!1):V("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const An="RemoteStore";class Hv{constructor(e,t,s,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo((a=>{s.enqueueAndForget((async()=>{Fs(this)&&(V(An,"Restarting streams for network reachability change."),await(async function(u){const h=Q(u);h.Ea.add(4),await Ls(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Zi(h)})(this))}))})),this.Ra=new $v(s,i)}}async function Zi(n){if(Fs(n))for(const e of n.da)await e(!0)}async function Ls(n){for(const e of n.da)await e(!1)}function of(n,e){const t=Q(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ca(t)?wa(t):xn(t).O_()&&Ia(t,e))}function Ta(n,e){const t=Q(n),s=xn(t);t.Ia.delete(e),s.O_()&&af(t,e),t.Ia.size===0&&(s.O_()?s.L_():Fs(t)&&t.Ra.set("Unknown"))}function Ia(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(F.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xn(n).Y_(e)}function af(n,e){n.Va.Ue(e),xn(n).Z_(e)}function wa(n){n.Va=new qE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),xn(n).start(),n.Ra.ua()}function Ca(n){return Fs(n)&&!xn(n).x_()&&n.Ia.size>0}function Fs(n){return Q(n).Ea.size===0}function lf(n){n.Va=void 0}async function zv(n){n.Ra.set("Online")}async function Wv(n){n.Ia.forEach(((e,t)=>{Ia(n,e)}))}async function Gv(n,e){lf(n),Ca(n)?(n.Ra.ha(e),wa(n)):n.Ra.set("Unknown")}async function Kv(n,e,t){if(n.Ra.set("Online"),e instanceof Wd&&e.state===2&&e.cause)try{await(async function(i,r){const a=r.cause;for(const l of r.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.Ia.delete(l),i.Va.removeTarget(l))})(n,e)}catch(s){V(An,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await uu(n,s)}else if(e instanceof pi?n.Va.Ze(e):e instanceof zd?n.Va.st(e):n.Va.tt(e),!t.isEqual(F.min()))try{const s=await nf(n.localStore);t.compareTo(s)>=0&&await(function(r,a){const l=r.Va.Tt(a);return l.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=r.Ia.get(h);f&&r.Ia.set(h,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,h)=>{const f=r.Ia.get(u);if(!f)return;r.Ia.set(u,f.withResumeToken(Ae.EMPTY_BYTE_STRING,f.snapshotVersion)),af(r,u);const m=new _t(f.target,u,h,f.sequenceNumber);Ia(r,m)})),r.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(s){V(An,"Failed to raise snapshot:",s),await uu(n,s)}}async function uu(n,e,t){if(!Vn(e))throw e;n.Ea.add(1),await Ls(n),n.Ra.set("Offline"),t||(t=()=>nf(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{V(An,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Zi(n)}))}async function hu(n,e){const t=Q(n);t.asyncQueue.verifyOperationInProgress(),V(An,"RemoteStore received new credentials");const s=Fs(t);t.Ea.add(3),await Ls(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Zi(t)}async function Qv(n,e){const t=Q(n);e?(t.Ea.delete(2),await Zi(t)):e||(t.Ea.add(2),await Ls(t),t.Ra.set("Unknown"))}function xn(n){return n.ma||(n.ma=(function(t,s,i){const r=Q(t);return r.sa(),new Bv(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)})(n.datastore,n.asyncQueue,{Xo:zv.bind(null,n),t_:Wv.bind(null,n),r_:Gv.bind(null,n),H_:Kv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Ca(n)?wa(n):n.Ra.set("Unknown")):(await n.ma.stop(),lf(n))}))),n.ma}class Aa{constructor(e,t,s,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new wt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,i,r){const a=Date.now()+s,l=new Aa(e,t,a,i,r);return l.start(s),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cf(n,e){if(at("AsyncQueue",`${e}: ${n}`),Vn(n))return new O(P.UNAVAILABLE,`${e}: ${n}`);throw n}class pn{static emptySet(e){return new pn(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||M.comparator(t.key,s.key):(t,s)=>M.comparator(t.key,s.key),this.keyedMap=rs(),this.sortedSet=new ue(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new pn;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class du{constructor(){this.ga=new ue(M.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):B(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Sn{constructor(e,t,s,i,r,a,l,u,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,i,r){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new Sn(e,t,pn.emptySet(t),a,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==s[i].type||!t[i].doc.isEqual(s[i].doc))return!1;return!0}}class Yv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Xv{constructor(){this.queries=fu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const i=Q(t),r=i.queries;i.queries=fu(),r.forEach(((a,l)=>{for(const u of l.Sa)u.onError(s)}))})(this,new O(P.ABORTED,"Firestore shutting down"))}}function fu(){return new en((n=>Od(n)),Ki)}async function uf(n,e){const t=Q(n);let s=3;const i=e.query;let r=t.queries.get(i);r?!r.ba()&&e.Da()&&(s=2):(r=new Yv,s=e.Da()?0:1);try{switch(s){case 0:r.wa=await t.onListen(i,!0);break;case 1:r.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const l=cf(a,`Initialization of query '${an(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,r),r.Sa.push(e),e.va(t.onlineState),r.wa&&e.Fa(r.wa)&&Sa(t)}async function hf(n,e){const t=Q(n),s=e.query;let i=3;const r=t.queries.get(s);if(r){const a=r.Sa.indexOf(e);a>=0&&(r.Sa.splice(a,1),r.Sa.length===0?i=e.Da()?0:1:!r.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function Jv(n,e){const t=Q(n);let s=!1;for(const i of e){const r=i.query,a=t.queries.get(r);if(a){for(const l of a.Sa)l.Fa(i)&&(s=!0);a.wa=i}}s&&Sa(t)}function Zv(n,e,t){const s=Q(n),i=s.queries.get(e);if(i)for(const r of i.Sa)r.onError(t);s.queries.delete(e)}function Sa(n){n.Ca.forEach((e=>{e.next()}))}var So,pu;(pu=So||(So={})).Ma="default",pu.Cache="cache";class df{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new Sn(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Sn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==So.Cache}}class ff{constructor(e){this.key=e}}class pf{constructor(e){this.key=e}}class eT{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Y(),this.mutatedKeys=Y(),this.eu=Md(e),this.tu=new pn(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new du,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,m)=>{const y=i.get(f),S=Qi(this.query,m)?m:null,b=!!y&&this.mutatedKeys.has(y.key),x=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let k=!1;y&&S?y.data.isEqual(S.data)?b!==x&&(s.track({type:3,doc:S}),k=!0):this.su(y,S)||(s.track({type:2,doc:S}),k=!0,(u&&this.eu(S,u)>0||h&&this.eu(S,h)<0)&&(l=!0)):!y&&S?(s.track({type:0,doc:S}),k=!0):y&&!S&&(s.track({type:1,doc:y}),k=!0,(u||h)&&(l=!0)),k&&(S?(a=a.add(S),r=x?r.add(f):r.delete(f)):(a=a.delete(f),r=r.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),r=r.delete(f.key),s.track({type:1,doc:f})}return{tu:a,iu:s,Cs:l,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(S,b){const x=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{Rt:k})}};return x(S)-x(b)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(s),i=i??!1;const l=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,a.length!==0||h?{snapshot:new Sn(this.query,e.tu,r,a,e.mutatedKeys,u===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new du,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Y(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new pf(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new ff(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Y();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Sn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ra="SyncEngine";class tT{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class nT{constructor(e){this.key=e,this.hu=!1}}class sT{constructor(e,t,s,i,r,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new en((l=>Od(l)),Ki),this.Iu=new Map,this.Eu=new Set,this.du=new ue(M.comparator),this.Au=new Map,this.Ru=new _a,this.Vu={},this.mu=new Map,this.fu=Cn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function iT(n,e,t=!0){const s=Ef(n);let i;const r=s.Tu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.lu()):i=await mf(s,e,t,!0),i}async function rT(n,e){const t=Ef(n);await mf(t,e,!0,!1)}async function mf(n,e,t,s){const i=await Dv(n.localStore,Ze(e)),r=i.targetId,a=n.sharedClientState.addLocalQueryTarget(r,t);let l;return s&&(l=await oT(n,e,r,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&of(n.remoteStore,i),l}async function oT(n,e,t,s,i){n.pu=(m,y,S)=>(async function(x,k,L,q){let U=k.view.ru(L);U.Cs&&(U=await ru(x.localStore,k.query,!1).then((({documents:T})=>k.view.ru(T,U))));const Z=q&&q.targetChanges.get(k.targetId),he=q&&q.targetMismatches.get(k.targetId)!=null,oe=k.view.applyChanges(U,x.isPrimaryClient,Z,he);return gu(x,k.targetId,oe.au),oe.snapshot})(n,m,y,S);const r=await ru(n.localStore,e,!0),a=new eT(e,r.Qs),l=a.ru(r.documents),u=Ms.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",i),h=a.applyChanges(l,n.isPrimaryClient,u);gu(n,t,h.au);const f=new tT(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function aT(n,e,t){const s=Q(n),i=s.Tu.get(e),r=s.Iu.get(i.targetId);if(r.length>1)return s.Iu.set(i.targetId,r.filter((a=>!Ki(a,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Co(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),t&&Ta(s.remoteStore,i.targetId),Ro(s,i.targetId)})).catch($i)):(Ro(s,i.targetId),await Co(s.localStore,i.targetId,!0))}async function lT(n,e){const t=Q(n),s=t.Tu.get(e),i=t.Iu.get(s.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Ta(t.remoteStore,s.targetId))}async function gf(n,e){const t=Q(n);try{const s=await Pv(t.localStore,e);e.targetChanges.forEach(((i,r)=>{const a=t.Au.get(r);a&&(ae(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?ae(a.hu,14607):i.removedDocuments.size>0&&(ae(a.hu,42227),a.hu=!1))})),await yf(t,s,e)}catch(s){await $i(s)}}function mu(n,e,t){const s=Q(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const i=[];s.Tu.forEach(((r,a)=>{const l=a.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(a,l){const u=Q(a);u.onlineState=l;let h=!1;u.queries.forEach(((f,m)=>{for(const y of m.Sa)y.va(l)&&(h=!0)})),h&&Sa(u)})(s.eventManager,e),i.length&&s.Pu.H_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function cT(n,e,t){const s=Q(n);s.sharedClientState.updateQueryState(e,"rejected",t);const i=s.Au.get(e),r=i&&i.key;if(r){let a=new ue(M.comparator);a=a.insert(r,Ne.newNoDocument(r,F.min()));const l=Y().add(r),u=new Ji(F.min(),new Map,new ue(W),a,l);await gf(s,u),s.du=s.du.remove(r),s.Au.delete(e),ba(s)}else await Co(s.localStore,e,!1).then((()=>Ro(s,e,t))).catch($i)}function Ro(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||_f(n,s)}))}function _f(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Ta(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),ba(n))}function gu(n,e,t){for(const s of t)s instanceof ff?(n.Ru.addReference(s.key,e),uT(n,s)):s instanceof pf?(V(Ra,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||_f(n,s.key)):B(19791,{wu:s})}function uT(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(V(Ra,"New document in limbo: "+t),n.Eu.add(s),ba(n))}function ba(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new M(ie.fromString(e)),s=n.fu.next();n.Au.set(s,new nT(t)),n.du=n.du.insert(t,s),of(n.remoteStore,new _t(Ze(fa(t.path)),s,"TargetPurposeLimboResolution",Hi.ce))}}async function yf(n,e,t){const s=Q(n),i=[],r=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach(((l,u)=>{a.push(s.pu(u,e,t).then((h=>{if((h||t)&&s.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;s.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){i.push(h);const f=Ea.As(u.targetId,h);r.push(f)}})))})),await Promise.all(a),s.Pu.H_(i),await(async function(u,h){const f=Q(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>R.forEach(h,(y=>R.forEach(y.Es,(S=>f.persistence.referenceDelegate.addReference(m,y.targetId,S))).next((()=>R.forEach(y.ds,(S=>f.persistence.referenceDelegate.removeReference(m,y.targetId,S)))))))))}catch(m){if(!Vn(m))throw m;V(va,"Failed to update sequence numbers: "+m)}for(const m of h){const y=m.targetId;if(!m.fromCache){const S=f.Ms.get(y),b=S.snapshotVersion,x=S.withLastLimboFreeSnapshotVersion(b);f.Ms=f.Ms.insert(y,x)}}})(s.localStore,r))}async function hT(n,e){const t=Q(n);if(!t.currentUser.isEqual(e)){V(Ra,"User change. New user:",e.toKey());const s=await tf(t.localStore,e);t.currentUser=e,(function(r,a){r.mu.forEach((l=>{l.forEach((u=>{u.reject(new O(P.CANCELLED,a))}))})),r.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await yf(t,s.Ls)}}function dT(n,e){const t=Q(n),s=t.Au.get(e);if(s&&s.hu)return Y().add(s.key);{let i=Y();const r=t.Iu.get(e);if(!r)return i;for(const a of r){const l=t.Tu.get(a);i=i.unionWith(l.view.nu)}return i}}function Ef(n){const e=Q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=cT.bind(null,e),e.Pu.H_=Jv.bind(null,e.eventManager),e.Pu.yu=Zv.bind(null,e.eventManager),e}class Vi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return bv(this.persistence,new Av,e.initialUser,this.serializer)}Cu(e){return new ef(ya.mi,this.serializer)}Du(e){return new Vv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Vi.provider={build:()=>new Vi};class fT extends Vi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ae(this.persistence.referenceDelegate instanceof ki,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new uv(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Le.withCacheSize(this.cacheSizeBytes):Le.DEFAULT;return new ef((s=>ki.mi(s,t)),this.serializer)}}class bo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>mu(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=hT.bind(null,this.syncEngine),await Qv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Xv})()}createDatastore(e){const t=sf(e.databaseInfo.databaseId),s=(function(r){return new Fv(r)})(e.databaseInfo);return(function(r,a,l,u){return new jv(r,a,l,u)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,i,r,a,l){return new Hv(s,i,r,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>mu(this.syncEngine,t,0)),(function(){return lu.v()?new lu:new xv})())}createSyncEngine(e,t){return(function(i,r,a,l,u,h,f){const m=new sT(i,r,a,l,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=Q(t);V(An,"RemoteStore shutting down."),s.Ea.add(5),await Ls(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}bo.provider={build:()=>new bo};class vf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):at("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Vt="FirestoreClient";class pT{constructor(e,t,s,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=i,this.user=be.UNAUTHENTICATED,this.clientId=la.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,(async a=>{V(Vt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(s,(a=>(V(Vt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=cf(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function $r(n,e){n.asyncQueue.verifyOperationInProgress(),V(Vt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async i=>{s.isEqual(i)||(await tf(e.localStore,i),s=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function _u(n,e){n.asyncQueue.verifyOperationInProgress();const t=await mT(n);V(Vt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>hu(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,i)=>hu(e.remoteStore,i))),n._onlineComponents=e}async function mT(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Vt,"Using user provided OfflineComponentProvider");try{await $r(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;vn("Error using user provided cache. Falling back to memory cache: "+t),await $r(n,new Vi)}}else V(Vt,"Using default OfflineComponentProvider"),await $r(n,new fT(void 0));return n._offlineComponents}async function gT(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Vt,"Using user provided OnlineComponentProvider"),await _u(n,n._uninitializedComponentsProvider._online)):(V(Vt,"Using default OnlineComponentProvider"),await _u(n,new bo))),n._onlineComponents}async function Tf(n){const e=await gT(n),t=e.eventManager;return t.onListen=iT.bind(null,e.syncEngine),t.onUnlisten=aT.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=lT.bind(null,e.syncEngine),t}function _T(n,e,t={}){const s=new wt;return n.asyncQueue.enqueueAndForget((async()=>(function(r,a,l,u,h){const f=new vf({next:y=>{f.Nu(),a.enqueueAndForget((()=>hf(r,m)));const S=y.docs.has(l);!S&&y.fromCache?h.reject(new O(P.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&y.fromCache&&u&&u.source==="server"?h.reject(new O(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new df(fa(l.path),f,{includeMetadataChanges:!0,qa:!0});return uf(r,m)})(await Tf(n),n.asyncQueue,e,t,s))),s.promise}function yT(n,e,t={}){const s=new wt;return n.asyncQueue.enqueueAndForget((async()=>(function(r,a,l,u,h){const f=new vf({next:y=>{f.Nu(),a.enqueueAndForget((()=>hf(r,m))),y.fromCache&&u.source==="server"?h.reject(new O(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new df(l,f,{includeMetadataChanges:!0,qa:!0});return uf(r,m)})(await Tf(n),n.asyncQueue,e,t,s))),s.promise}function If(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const yu=new Map;const wf="firestore.googleapis.com",Eu=!0;class vu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wf,this.ssl=Eu}else this.host=e.host,this.ssl=e.ssl??Eu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Zd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<lv)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=If(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,i){return s.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class er{constructor(e,t,s,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new ky;switch(s.type){case"firstParty":return new My(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=yu.get(t);s&&(V("ComponentProvider","Removing Datastore"),yu.delete(t),s.terminate())})(this),Promise.resolve()}}function ET(n,e,t,s={}){n=Cs(n,er);const i=Ps(e),r=n._getSettings(),a={...r,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(xu(`https://${l}`),Mu("Firestore",!0)),r.host!==wf&&r.host!==l&&vn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...r,host:l,ssl:i,emulatorOptions:s};if(!Es(u,a)&&(n._setSettings(u),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=be.MOCK_USER;else{h=Ou(s.mockUserToken,n._app?.options.projectId);const m=s.mockUserToken.sub||s.mockUserToken.user_id;if(!m)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new be(m)}n._authCredentials=new Vy(new Td(h,f))}}class tr{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new tr(this.firestore,e,this._query)}}class ke{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ct(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ke(this.firestore,e,this._key)}toJSON(){return{type:ke._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(xs(t,ke._jsonSchema))return new ke(e,s||null,new M(ie.fromString(t.referencePath)))}}ke._jsonSchemaVersion="firestore/documentReference/1.0",ke._jsonSchema={type:pe("string",ke._jsonSchemaVersion),referencePath:pe("string")};class Ct extends tr{constructor(e,t,s){super(e,t,fa(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ke(this.firestore,null,new M(e))}withConverter(e){return new Ct(this.firestore,e,this._path)}}function On(n,e,...t){if(n=xt(n),Id("collection","path",e),n instanceof er){const s=ie.fromString(e,...t);return Vc(s),new Ct(n,null,s)}{if(!(n instanceof ke||n instanceof Ct))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ie.fromString(e,...t));return Vc(s),new Ct(n.firestore,null,s)}}function Pa(n,e,...t){if(n=xt(n),arguments.length===1&&(e=la.newId()),Id("doc","path",e),n instanceof er){const s=ie.fromString(e,...t);return kc(s),new ke(n,null,new M(s))}{if(!(n instanceof ke||n instanceof Ct))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ie.fromString(e,...t));return kc(s),new ke(n.firestore,n instanceof Ct?n.converter:null,new M(s))}}const Tu="AsyncQueue";class Iu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rf(this,"async_queue_retry"),this._c=()=>{const s=jr();s&&V(Tu,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=jr();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=jr();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new wt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Vn(e))throw e;V(Tu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,at("INTERNAL UNHANDLED ERROR: ",wu(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Aa.createAndSchedule(this,e,t,s,(r=>this.hc(r)));return this.tc.push(i),i}uc(){this.nc&&B(47125,{Pc:wu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function wu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Na extends er{constructor(e,t,s,i){super(e,t,s,i),this.type="firestore",this._queue=new Iu,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Iu(e),this._firestoreClient=void 0,await e}}}function vT(n,e){const t=typeof n=="object"?n:Gu(),s=typeof n=="string"?n:Ri,i=$u(t,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=ku("firestore");r&&ET(i,...r)}return i}function Cf(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||TT(n),n._firestoreClient}function TT(n){const e=n._freezeSettings(),t=(function(i,r,a,l){return new nE(i,r,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,If(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new pT(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const r=i?._online.build();return{_offline:i?._offline.build(r),_online:r}})(n._componentsProvider))}class Ye{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ye(Ae.fromBase64String(e))}catch(t){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ye(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ye._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(xs(e,Ye._jsonSchema))return Ye.fromBase64String(e.bytes)}}Ye._jsonSchemaVersion="firestore/bytes/1.0",Ye._jsonSchema={type:pe("string",Ye._jsonSchemaVersion),bytes:pe("string")};class Af{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class At{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:At._jsonSchemaVersion}}static fromJSON(e){if(xs(e,At._jsonSchema))return new At(e.latitude,e.longitude)}}At._jsonSchemaVersion="firestore/geoPoint/1.0",At._jsonSchema={type:pe("string",At._jsonSchemaVersion),latitude:pe("number"),longitude:pe("number")};class St{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:St._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(xs(e,St._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new St(e.vectorValues);throw new O(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}St._jsonSchemaVersion="firestore/vectorValue/1.0",St._jsonSchema={type:pe("string",St._jsonSchemaVersion),vectorValues:pe("object")};const IT=new RegExp("[~\\*/\\[\\]]");function wT(n,e,t){if(e.search(IT)>=0)throw Cu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new Af(...e.split("."))._internalPath}catch{throw Cu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function Cu(n,e,t,s,i){let r=`Function ${e}() called with invalid data`;r+=". ";let a="";return new O(P.INVALID_ARGUMENT,r+n+a)}class Sf{constructor(e,t,s,i,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new ke(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Rf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class CT extends Sf{data(){return super.data()}}function Rf(n,e){return typeof e=="string"?wT(n,e):e instanceof Af?e._internalPath:e._delegate._internalPath}function AT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ST{convertValue(e,t="none"){switch(Dt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Nt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Os(e,((i,r)=>{s[i]=this.convertValue(r,t)})),s}convertVectorValue(e){const t=e.fields?.[po].arrayValue?.values?.map((s=>ce(s.doubleValue)));return new St(t)}convertGeoPoint(e){return new At(ce(e.latitude),ce(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Wi(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Ss(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=ie.fromString(e);ae(Jd(s),9688,{name:e});const i=new Rs(s.get(1),s.get(3)),r=new M(s.popFirst(5));return i.isEqual(t)||at(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class as{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gt extends Sf{constructor(e,t,s,i,r,a){super(e,t,s,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new mi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Rf("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Gt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Gt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gt._jsonSchema={type:pe("string",Gt._jsonSchemaVersion),bundleSource:pe("string","DocumentSnapshot"),bundleName:pe("string"),bundle:pe("string")};class mi extends Gt{data(e={}){return super.data(e)}}class mn{constructor(e,t,s,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new as(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new mi(this._firestore,this._userDataWriter,s.key,s,new as(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,r){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map((l=>{const u=new mi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new as(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>r||l.type!==3)).map((l=>{const u=new mi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new as(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return l.type!==0&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:RT(l.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=mn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=la.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],i=[];return this.docs.forEach((r=>{r._document!==null&&(t.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function RT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:n})}}function Da(n){n=Cs(n,ke);const e=Cs(n.firestore,Na);return _T(Cf(e),n._key).then((t=>bT(e,n,t)))}mn._jsonSchemaVersion="firestore/querySnapshot/1.0",mn._jsonSchema={type:pe("string",mn._jsonSchemaVersion),bundleSource:pe("string","QuerySnapshot"),bundleName:pe("string"),bundle:pe("string")};class bf extends ST{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ye(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ke(this.firestore,null,t)}}function Mn(n){n=Cs(n,tr);const e=Cs(n.firestore,Na),t=Cf(e),s=new bf(e);return AT(n._query),yT(t,n._query).then((i=>new mn(e,s,n,i)))}function bT(n,e,t){const s=t.docs.get(e._key),i=new bf(n);return new Gt(n,i,e._key,s,new as(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){kn=i})(zu),vs(new _n("firestore",((s,{instanceIdentifier:i,options:r})=>{const a=s.getProvider("app").getImmediate(),l=new Na(new xy(s.getProvider("auth-internal")),new Ly(a,s.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rs(h.options.projectId,f)})(a,i),a);return r={useFetchStreams:t,...r},l._setSettings(r),l}),"PUBLIC").setMultipleInstances(!0)),vt(bc,Pc,e),vt(bc,Pc,"esm2020")})();const PT={apiKey:"AIzaSyAnAsDsn0ZKeMxJhUoorJl3rMHwlYEHJT8",authDomain:"dwiheruwaspodo.firebaseapp.com",databaseURL:"https://dwiheruwaspodo.firebaseio.com",projectId:"dwiheruwaspodo",storageBucket:"dwiheruwaspodo.appspot.com",messagingSenderId:"68803774438"},Pf=Wu(PT),NT=Py(Pf),ct=vT(Pf);async function DT(){try{const n=Pa(ct,"bio","data"),e=await Da(n);if(e.exists()){const t=e.data(),s=document.querySelector(".name");s&&t.name&&(s.textContent=t.name,s.title=t.name);const i=document.querySelector(".title");i&&t.role&&(i.textContent=t.role);const r=document.querySelector("address");r&&t.domicile&&t.country?r.textContent=`${t.domicile}, ${t.country}`:r&&t.country&&(r.textContent=t.country);const a=document.querySelector(".about-text");if(a&&t.aboutme){const h=a.querySelectorAll("p"),f=Array.from(h).every(m=>!m.textContent.trim());if(f&&h.length>0)h[0].textContent=t.aboutme;else if(f){const m=document.createElement("p");m.textContent=t.aboutme,a.appendChild(m)}}const l=document.querySelector("[data-contact-cv]");l&&(t.cv?(l.href=t.cv,l.parentElement.parentElement.style.display="flex"):l.parentElement.parentElement.style.display="none");const u=document.querySelector("[data-typeform-container]");u&&t.form?u.innerHTML=`<iframe id="typeform-full" width="100%" height="100%" frameborder="0" allow="camera; microphone; autoplay; encrypted-media;" src="${t.form}"></iframe>`:u&&(u.innerHTML="<p style='padding: 20px;'>Contact form not configured.</p>")}}catch(n){console.error("Error loading Bio:",n),xT(n)}}async function kT(){try{const n=document.querySelector(".service-list");if(!n)return;const e=await Mn(On(ct,"roles"));if(!e.empty){n.innerHTML="";const t=["./assets/images/icon-app.svg","./assets/images/icon-photo.svg","./assets/images/icon-dev.svg","./assets/images/icon-design.svg"];let s=0;e.forEach(i=>{const r=i.data(),a=t[s%t.length];s++;const l=document.createElement("li");l.className="service-item",l.innerHTML=`
            <div class="service-icon-box">
              <img src="${a}" alt="icon" width="40">
            </div>
            <div class="service-content-box">
              <h4 class="h4 service-item-title">${r.role||"Service"}</h4>
              <p class="service-item-text">
                ${r.description||""}
              </p>
            </div>
          `,n.appendChild(l)})}}catch(n){console.error("Error loading Roles:",n)}}async function VT(){try{const n=Pa(ct,"contacts","data"),e=await Da(n);if(e.exists()){const t=e.data(),s=document.querySelector("[data-contact-email]");s&&(s.href=`mailto:${t.email}`,s.textContent=t.email);const i=document.querySelector("[data-contact-phone]");i&&(t.phone&&/[0-9]/.test(t.phone)?i.href=`tel:${t.phone}`:(i.href="#",i.style.pointerEvents="none"),i.textContent=t.phone);const r=document.querySelector(".social-list");r&&(r.innerHTML="",[{key:"github",icon:"logo-github"},{key:"facebook",icon:"logo-facebook"},{key:"twitter",icon:"logo-twitter"},{key:"instagram",icon:"logo-instagram"},{key:"linkedin",icon:"logo-linkedin"},{key:"gitlab",icon:"logo-gitlab"},{key:"repo",icon:"logo-gitlab"},{key:"web_1",icon:"globe-outline"}].forEach(l=>{if(t[l.key]){const u=document.createElement("li");u.className="social-item";const h=document.createElement("a");h.href=t[l.key],h.className="social-link",h.target="_blank";const f=document.createElement("ion-icon");f.name=l.icon,h.appendChild(f),u.appendChild(h),r.appendChild(u)}}))}}catch(n){console.error("Error loading Contacts:",n)}}function xT(n){n.code==="permission-denied"&&console.warn("PERMISSION DENIED: Please update your Firestore Security Rules.")}async function OT(){try{const n=document.querySelector("[data-experience-list]");if(!n)return;const e=await Mn(On(ct,"works"));if(!e.empty){n.innerHTML="";let t=[];e.forEach(i=>{t.push({id:i.id,...i.data()})});const s=i=>{if(!i)return null;let r;return i.toDate&&typeof i.toDate=="function"?r=i.toDate():r=new Date(i),isNaN(r.getTime())?"":r.toLocaleDateString("en-US",{year:"numeric",month:"short"})};t.sort((i,r)=>{const a=i.company?String(i.company).toLowerCase():"",l=i.title?String(i.title).toLowerCase():"",u=a.includes("mekari")||l.includes("mekari"),h=r.company?String(r.company).toLowerCase():"",f=r.title?String(r.title).toLowerCase():"",m=h.includes("mekari")||f.includes("mekari");if(u&&!m)return-1;if(!u&&m)return 1;const y=S=>S?S.seconds?S.seconds:new Date(S).getTime()/1e3:0;return y(r.date_start)-y(i.date_start)}),t.forEach(i=>{const r=document.createElement("li");r.className="timeline-item";let a="";const l=s(i.date_start),u=i.date_end?s(i.date_end):"Present";l?a=`${l}  ${u}`:a=i.period||i.year||"",r.innerHTML=`
          <h4 class="h4 timeline-item-title">${i.title||i.role||"Job Title"}</h4>
          ${i.company?`<span style="display:block; font-weight:500; color: var(--orange-yellow-crayola); margin-bottom: 4px;">${i.company}</span>`:""}
          <span style="display:block; font-size: 14px; color: var(--light-gray); margin-bottom: 10px;">${a}</span>
          <p class="timeline-text">
            ${i.description||""}
          </p>
        `,n.appendChild(r)})}}catch(n){console.error("Error loading Experience:",n)}}async function MT(){try{const n=document.querySelector("[data-education-list]");if(!n)return;const e=await Mn(On(ct,"educations"));if(!e.empty){n.innerHTML="";let t=[];e.forEach(s=>{t.push({id:s.id,...s.data()})}),t.sort((s,i)=>{const r=s.startDate||s.year||s.period||"",a=i.startDate||i.year||i.period||"";return r>a?-1:r<a?1:0}),t.forEach(s=>{const i=document.createElement("li");i.className="timeline-item";let r="";s.startDate&&s.endDate?r=`${s.startDate}  ${s.endDate}`:s.period?r=s.period:s.year&&(r=s.year),i.innerHTML=`
          <h4 class="h4 timeline-item-title">${s.institution||s.school||"School"}</h4>
          <span>${r}</span>
          <p class="timeline-text">
            ${s.description||s.degree||""}
          </p>
        `,n.appendChild(i)})}}catch(n){console.error("Error loading Education:",n)}}async function LT(){try{const n=document.querySelector("[data-skills-list]");if(!n)return;const e=await Mn(On(ct,"skills"));if(!e.empty){n.innerHTML="";let t=[];e.forEach(s=>{t.push({id:s.id,...s.data()})}),t.sort((s,i)=>(i.strength||0)-(s.strength||0)),t.forEach(s=>{const r=(s.strength||0)*10,a=s.skill||"Skill",l=document.createElement("li");l.className="skills-item",l.innerHTML=`
          <div class="title-wrapper">
            <h5 class="h5">${a}</h5>
            <data value="${r}">${r}%</data>
          </div>

          <div class="skill-progress-bg">
            <div class="skill-progress-fill" style="width: ${r}%"></div>
          </div>
        `,n.appendChild(l)})}}catch(n){console.error("Error loading Skills:",n)}}async function FT(){try{const n=document.querySelector("[data-activity-list]");if(!n)return;const e=document.querySelector(".testimonials-title");e&&(e.innerHTML="Projects");const t=Pa(ct,"contacts","data"),s=await Da(t);let i="";if(s.exists()){const l=s.data();if(l.github){const u=l.github.split("/").filter(Boolean);i=u[u.length-1]}}const r="dwiheruwaspodo",a=[];if(i)try{const l=await fetch(`https://api.github.com/users/${i}/repos?sort=updated&per_page=10`);l.ok&&(await l.json()).forEach(h=>{h.fork||a.push({source:"GitHub",icon:"logo-github",name:h.name,url:h.html_url,description:h.description,stars:h.stargazers_count,forks:h.forks_count,updatedAt:new Date(h.updated_at),language:h.language})})}catch(l){console.error("GitHub repos fetch error",l)}if(r)try{const l=await fetch(`https://gitlab.com/api/v4/users?username=${r}`);if(l.ok){const u=await l.json();if(u.length>0){const h=u[0].id,f=await fetch(`https://gitlab.com/api/v4/users/${h}/projects?order_by=last_activity_at&sort=desc&per_page=10&visibility=public`);f.ok&&(await f.json()).forEach(y=>{a.push({source:"GitLab",icon:"logo-gitlab",name:y.name,url:y.web_url,description:y.description,stars:y.star_count,forks:y.forks_count,updatedAt:new Date(y.last_activity_at),language:null})})}}}catch(l){console.error("GitLab repos fetch error",l)}if(n.innerHTML="",a.sort((l,u)=>u.updatedAt-l.updatedAt),a.length===0){n.innerHTML='<li class="testimonials-item"><p style="color:var(--light-gray); padding:20px;">No projects found.</p></li>';return}a.forEach(l=>{const u=l.updatedAt.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),h=document.createElement("li");h.className="testimonials-item",h.innerHTML=`
          <div class="content-card" style="height: 100%; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-start; min-width: 300px; padding: 20px;" data-testimonials-item>
            
            <div style="width: 100%;">
                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom: 10px;">
                    <h4 class="h4 testimonials-item-title" style="font-size: 16px; font-weight: 600; margin:0; word-break:break-all; padding-right:10px;">
                       <a href="${l.url}" target="_blank" style="color:var(--orange-yellow-crayola);">${l.name}</a>
                    </h4>
                    <ion-icon name="${l.icon}" style="font-size: 20px; color: var(--light-gray); flex-shrink:0;"></ion-icon>
                </div>

                <p class="testimonials-text" style="font-size: 14px; margin-bottom: 15px; line-height: 1.5; color: var(--light-gray);">
                  ${l.description||"No description provided."}
                </p>
            </div>

            <div style="display: flex; gap: 15px; align-items: center; font-size: 12px; color: var(--light-gray-70); width: 100%; margin-top: auto;">
               <!-- Language (GitHub only mostly) -->
               ${l.language?`
               <div style="display:flex; align-items:center; gap:4px;">
                  <span style="width:8px; height:8px; border-radius:50%; background:var(--vegas-gold);"></span>
                  <span>${l.language}</span>
               </div>
               `:""}

               <!-- Stars -->
               ${l.stars>0?`
               <div style="display:flex; align-items:center; gap:4px;">
                  <ion-icon name="star-outline"></ion-icon>
                  <span>${l.stars}</span>
               </div>
               `:""}

               <!-- Updated -->
               <div style="margin-left: auto;">
                 ${u}
               </div>
            </div>
          </div>
        `,n.appendChild(h)})}catch(n){console.error("Error loading Projects:",n)}}async function UT(){try{const n=document.querySelector("[data-project-list]");if(!n)return;const e=document.querySelector("[data-modal-container]"),t=document.querySelector("[data-modal-close-btn]"),s=document.querySelector("[data-modal-overlay]"),i=document.querySelector("[data-modal-title]"),r=document.querySelector("[data-modal-category]"),a=document.querySelector("[data-modal-text]"),l=document.querySelector("[data-modal-img]"),u=document.querySelector("[data-modal-img-wrapper]"),h=()=>{e&&e.classList.remove("active"),s&&s.classList.remove("active")};t&&(t.onclick=h),s&&(s.onclick=h);const f=await Mn(On(ct,"works")),m=[];f.forEach(L=>{const q=L.data();q.projects&&Array.isArray(q.projects)&&q.projects.forEach(U=>{m.push({...U,companyLogo:q.logo})})}),n.innerHTML="";const y=new Set(["all"]);m.forEach(L=>{const q=(L.role||"project").toLowerCase();y.add(q);const U=document.createElement("li");U.className="project-item active",U.setAttribute("data-filter-item",""),U.setAttribute("data-category",q);const Z=L.image||L.companyLogo||"./assets/images/project-1.jpg";U.innerHTML=`
          <a href="#">
            <figure class="project-img">
              <div class="project-item-icon-box">
                <ion-icon name="eye-outline"></ion-icon>
              </div>
              <img src="${Z}" alt="${L.name}" loading="lazy">
            </figure>
            <h3 class="project-title">${L.name}</h3>
            <p class="project-category">${L.role||"Project"}</p>
          </a>
        `,U.querySelector("a").addEventListener("click",he=>{he.preventDefault(),i&&(i.textContent=L.name),r&&(r.textContent=L.role||"Project"),a&&(a.innerHTML=L.desc?`<p>${L.desc}</p>`:"<p>No description available.</p>"),l&&Z?(l.src=Z,l.alt=L.name,u&&(u.style.display="block")):u&&(u.style.display="none"),e&&e.classList.add("active"),s&&s.classList.add("active")}),n.appendChild(U)});const S=document.querySelector(".filter-list"),b=document.querySelector(".select-list"),x=document.querySelector("[data-selecct-value]"),k=document.querySelector("[data-select]");S&&b&&(S.innerHTML="",b.innerHTML="",y.forEach(L=>{const q=L.charAt(0).toUpperCase()+L.slice(1),U=document.createElement("li");U.className="filter-item";const Z=document.createElement("button");Z.innerText=q==="All"?"All":q,Z.setAttribute("data-filter-btn",""),L==="all"&&Z.classList.add("active"),Z.addEventListener("click",function(){document.querySelectorAll("[data-filter-btn]").forEach(g=>g.classList.remove("active")),this.classList.add("active"),xi(L)}),U.appendChild(Z),S.appendChild(U);const he=document.createElement("li");he.className="select-item";const oe=document.createElement("button");oe.innerText=q,oe.setAttribute("data-select-item",""),oe.addEventListener("click",function(){x&&(x.innerText=this.innerText),k&&nr(k),xi(L)}),he.appendChild(oe),b.appendChild(he)}))}catch(n){console.error("Error loading Portfolio:",n)}}async function BT(){try{const n=document.querySelector("[data-clients-list]");if(!n)return;const e=await Mn(On(ct,"works")),t=[],s=new Set;if(e.forEach(i=>{const r=i.data(),a=r.company?r.company.trim():"";r.logo&&a&&!s.has(a)&&(t.push(r),s.add(a))}),t.length===0)return;t.sort((i,r)=>{const a=l=>l?l.seconds?l.seconds:new Date(l).getTime()/1e3:0;return a(r.date_start)-a(i.date_start)}),n.innerHTML="",t.forEach(i=>{const r=document.createElement("li");r.className="clients-item";const a=i.url||i.website||"#",l=a!=="#";r.innerHTML=`
          <a href="${a}" ${l?'target="_blank"':'style="pointer-events: none; cursor: default;"'}>
            <img src="${i.logo}" alt="${i.company} logo" style="max-height: 50px; width: auto; /* Ensure reasonable size */">
          </a>
        `,n.appendChild(r)})}catch(n){console.error("Error loading companies:",n)}}async function qT(){await Promise.all([DT(),kT(),VT(),OT(),MT(),LT(),FT(),BT(),UT()])}qT();const nr=function(n){n.classList.toggle("active")},jT=document.querySelector("[data-sidebar]"),Au=document.querySelector("[data-sidebar-btn]");Au&&Au.addEventListener("click",function(){nr(jT)});const Po=document.querySelector("[data-select]"),Su=document.querySelectorAll("[data-select-item]"),Nf=document.querySelector("[data-selecct-value]"),No=document.querySelectorAll("[data-filter-btn]");Po&&Po.addEventListener("click",function(){nr(this)});for(let n=0;n<Su.length;n++)Su[n].addEventListener("click",function(){let e=this.innerText.toLowerCase();Nf.innerText=this.innerText,nr(Po),xi(e)});const xi=function(n){const e=document.querySelectorAll("[data-filter-item]");for(let t=0;t<e.length;t++)n==="all"||n===e[t].dataset.category?e[t].classList.add("active"):e[t].classList.remove("active")};let Hr=No[0];for(let n=0;n<No.length;n++)No[n].addEventListener("click",function(){let e=this.innerText.toLowerCase();Nf.innerText=this.innerText,xi(e),Hr&&Hr.classList.remove("active"),this.classList.add("active"),Hr=this});const ls=document.querySelector("[data-form]"),Ru=document.querySelectorAll("[data-form-input]"),Do=document.querySelector("[data-form-btn]");for(let n=0;n<Ru.length;n++)Ru[n].addEventListener("input",function(){ls.checkValidity()?Do.removeAttribute("disabled"):Do.setAttribute("disabled","")});ls&&ls.addEventListener("submit",n=>{n.preventDefault();const e=new FormData(ls),t={fullname:e.get("fullname"),email:e.get("email"),message:e.get("message"),timestamp:Date.now()},s=Ey(NT,"messages");vy(s,t).then(()=>{alert("Message sent successfully!"),ls.reset(),Do.setAttribute("disabled","")}).catch(i=>{console.error("Error writing to Firebase Database",i),alert("There was an error sending your message. Please try again.")})});const ai=document.querySelectorAll("[data-nav-link]"),li=document.querySelectorAll("[data-page]");for(let n=0;n<ai.length;n++)ai[n].addEventListener("click",function(){for(let e=0;e<li.length;e++)window.scrollTo(0,0),this.innerHTML.toLowerCase()===li[e].dataset.page?(li[e].classList.add("active"),ai[e].classList.add("active")):(li[e].classList.remove("active"),ai[e].classList.remove("active"))});
